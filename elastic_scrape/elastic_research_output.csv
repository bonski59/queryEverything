url,title,mitre_tactic_name,mitre_tactic,mitre_technique_name,mitre_technique,description,type,elastic_query,rule_indices,references,tags
https://www.elastic.co/guide/en/security/7.16/aws-access-secret-in-secrets-manager.html,AWS Access Secret in Secrets Manageredit,['Credential Access'],['TA0006'],['Steal Application Access Token'],['T1528'],"An adversary may attempt to access the secrets in secrets manager to steal certificates, credentials, or other sensitive material",['query'],event.dataset:aws.cloudtrail andevent.provider:secretsmanager.amazonaws.com andevent.action:GetSecretValue,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html', 'http://detectioninthe.cloud/credential_access/access_secret_in_secrets_manager/']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Data Protection']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudtrail-log-created.html,AWS CloudTrail Log Creatededit,['Collection'],['TA0009'],['Data from Cloud Storage Object'],['T1530'],Identifies the creation of an AWS log trail that specifies the settings for delivery of log data.,['query'],event.dataset:aws.cloudtrail andevent.provider:cloudtrail.amazonaws.com and event.action:CreateTrailand event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_CreateTrail.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/create-trail.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudtrail-log-deleted.html,AWS CloudTrail Log Deletededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of an AWS log trail. An adversary may delete trails in an attempt to evade defenses.,['query'],event.dataset:aws.cloudtrail andevent.provider:cloudtrail.amazonaws.com and event.action:DeleteTrailand event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_DeleteTrail.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/delete-trail.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudtrail-log-suspended.html,AWS CloudTrail Log Suspendededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies suspending the recording of AWS API calls and log file delivery for the specified trail. An adversary may suspend trails in an attempt to evade defenses.,['query'],event.dataset:aws.cloudtrail andevent.provider:cloudtrail.amazonaws.com and event.action:StopLoggingand event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_StopLogging.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/stop-logging.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudtrail-log-updated.html,AWS CloudTrail Log Updatededit,"['Impact', 'Collection']","['TA0040', 'TA0009']","['Data Manipulation', 'Data from Cloud Storage Object']","['T1565', 'T1530']",Identifies an update to an AWS log trail setting that specifies the delivery of log files.,['query'],event.dataset:aws.cloudtrail andevent.provider:cloudtrail.amazonaws.com and event.action:UpdateTrailand event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/awscloudtrail/latest/APIReference/API_UpdateTrail.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudtrail/update-trail.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudwatch-alarm-deletion.html,AWS CloudWatch Alarm Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of an AWS CloudWatch alarm. An adversary may delete alarms in an attempt to evade defenses.,['query'],event.dataset:aws.cloudtrail andevent.provider:monitoring.amazonaws.com and event.action:DeleteAlarmsand event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/cloudwatch/delete-alarms.html', 'https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DeleteAlarms.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudwatch-log-group-deletion.html,AWS CloudWatch Log Group Deletionedit,"['Impact', 'Defense Evasion']","['TA0040', 'TA0005']","['Data Destruction', 'Impair Defenses']","['T1485', 'T1562']","Identifies the deletion of a specified AWS CloudWatch log group. When a log group is deleted, all the archived log events associated with the log group are also permanently deleted.",['query'],event.dataset:aws.cloudtrail and event.provider:logs.amazonaws.com andevent.action:DeleteLogGroup and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/delete-log-group.html', 'https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_DeleteLogGroup.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-cloudwatch-log-stream-deletion.html,AWS CloudWatch Log Stream Deletionedit,"['Impact', 'Defense Evasion']","['TA0040', 'TA0005']","['Data Destruction', 'Impair Defenses']","['T1485', 'T1562']","Identifies the deletion of an AWS CloudWatch log stream, which permanently deletes all associated archived log events with the stream.",['query'],event.dataset:aws.cloudtrail and event.provider:logs.amazonaws.com andevent.action:DeleteLogStream and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/delete-log-stream.html', 'https://docs.aws.amazon.com/AmazonCloudWatchLogs/latest/APIReference/API_DeleteLogStream.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-config-service-tampering.html,AWS Config Service Tamperingedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies attempts to delete an AWS Config Service resource. An adversary may tamper with Config services in order to reduce visibility into the security posture of an account and / or its workload instances.,['query'],event.dataset:aws.cloudtrail and event.provider:config.amazonaws.comand event.action:(DeleteConfigRule or DeleteOrganizationConfigRuleor DeleteConfigurationAggregator or DeleteConfigurationRecorder orDeleteConformancePack or DeleteOrganizationConformancePack orDeleteDeliveryChannel or DeleteRemediationConfiguration orDeleteRetentionConfiguration),"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/config/latest/developerguide/how-does-config-work.html', 'https://docs.aws.amazon.com/config/latest/APIReference/API_Operations.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-configuration-recorder-stopped.html,AWS Configuration Recorder Stoppededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies an AWS configuration change to stop recording a designated set of resources.,['query'],event.dataset:aws.cloudtrail and event.provider:config.amazonaws.comand event.action:StopConfigurationRecorder and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/configservice/stop-configuration-recorder.html', 'https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-encryption-disabled.html,AWS EC2 Encryption Disablededit,['Impact'],['TA0040'],['Data Manipulation'],['T1565'],Identifies disabling of Amazon Elastic Block Store (EBS) encryption by default in the current region. Disabling encryption by default does not change the encryption status of your existing volumes.,['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:DisableEbsEncryptionByDefault and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/disable-ebs-encryption-by-default.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Data Protection']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-flow-log-deletion.html,AWS EC2 Flow Log Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of one or more flow logs in AWS Elastic Compute Cloud (EC2). An adversary may delete flow logs in an attempt to evade defenses.,['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:DeleteFlowLogs and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/delete-flow-logs.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteFlowLogs.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-full-network-packet-capture-detected.html,AWS EC2 Full Network Packet Capture Detectededit,"['Exfiltration', 'Collection']","['TA0010', 'TA0009']","['Automated Exfiltration', 'Data Staged']","['T1020', 'T1074']",Identifies potential Traffic Mirroring in an Amazon Elastic Compute Cloud (EC2) instance. Traffic Mirroring is an Amazon VPC feature that you can use to copy network traffic from an Elastic network interface. This feature can potentially be abused to exfiltrate sensitive data from unencrypted internal traffic.,['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:(CreateTrafficMirrorFilter orCreateTrafficMirrorFilterRule or CreateTrafficMirrorSession orCreateTrafficMirrorTarget) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_TrafficMirrorFilter.html', 'https://github.com/easttimor/aws-incident-response']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-network-access-control-list-creation.html,AWS EC2 Network Access Control List Creationedit,['Persistence'],['TA0003'],['External Remote Services'],['T1133'],Identifies the creation of an AWS Elastic Compute Cloud (EC2) network access control list (ACL) or an entry in a network ACL with a specified rule number.,['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:(CreateNetworkAcl or CreateNetworkAclEntry) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/create-network-acl.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAcl.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/create-network-acl-entry.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateNetworkAclEntry.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-network-access-control-list-deletion.html,AWS EC2 Network Access Control List Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of an Amazon Elastic Compute Cloud (EC2) network access control list (ACL) or one of its ingress/egress entries.,['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:(DeleteNetworkAcl or DeleteNetworkAclEntry) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/delete-network-acl.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAcl.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/delete-network-acl-entry.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteNetworkAclEntry.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-snapshot-activity.html,AWS EC2 Snapshot Activityedit,['Exfiltration'],['TA0010'],['Transfer Data to Cloud Account'],['T1537'],"An attempt was made to modify AWS EC2 snapshot attributes. Snapshots are sometimes shared by threat actors in order to exfiltrate bulk data from an EC2 fleet. If the permissions were modified, verify the snapshot was not shared with an unauthorized or unexpected AWS account.",['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:ModifySnapshotAttribute,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/modify-snapshot-attribute.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifySnapshotAttribute.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-ec2-vm-export-failure.html,AWS EC2 VM Export Failureedit,"['Exfiltration', 'Collection']","['TA0010', 'TA0009']","['Transfer Data to Cloud Account', 'Data from Local System']","['T1537', 'T1005']",Identifies an attempt to export an AWS EC2 instance. A virtual machine (VM) export may indicate an attempt to extract or exfiltrate information.,['query'],event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com andevent.action:CreateInstanceExportTask and event.outcome:failure,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/vm-import/latest/userguide/vmexport.html#export-instance'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-efs-file-system-or-mount-deleted.html,AWS EFS File System or Mount Deletededit,['Impact'],['TA0040'],['Data Destruction'],['T1485'],"Detects when a EFS File System or Mount is deleted. An adversary could break any file system using the mount target that is being deleted, which might disrupt instances or applications using those mounts. The mount must be deleted prior to deleting the File System, or the adversary will be unable to delete the File System.",['query'],event.dataset:aws.cloudtrail andevent.provider:elasticfilesystem.amazonaws.com andevent.action:(DeleteMountTarget or DeleteFileSystem) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/efs/latest/ug/API_DeleteFileSystem.html', 'https://docs.aws.amazon.com/efs/latest/ug/API_DeleteMountTarget.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Data Protection']"
https://www.elastic.co/guide/en/security/7.16/aws-elasticache-security-group-created.html,AWS ElastiCache Security Group Creatededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when an ElastiCache security group has been created.,['query'],"event.dataset:aws.cloudtrail andevent.provider:elasticache.amazonaws.com and event.action:""CreateCache Security Group"" and event.outcome:success","['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_CreateCacheSecurityGroup.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-elasticache-security-group-modified-or-deleted.html,AWS ElastiCache Security Group Modified or Deletededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when an ElastiCache security group has been modified or deleted.,['query'],"event.dataset:aws.cloudtrail andevent.provider:elasticache.amazonaws.com and event.action:(""DeleteCache Security Group"" or ""Authorize Cache Security Group Ingress"" or""Revoke Cache Security Group Ingress"" or""AuthorizeCacheSecurityGroupEgress"" or""RevokeCacheSecurityGroupEgress"") and event.outcome:success","['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/Welcome.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-eventbridge-rule-disabled-or-deleted.html,AWS EventBridge Rule Disabled or Deletededit,['Impact'],['TA0040'],[],[],Identifies when a user disabled or deleted an EventBridge rule. This activity can result in an unintended loss of visibility in applications or breaking the flow with other AWS services.,['query'],event.dataset:aws.cloudtrail andevent.provider:eventbridge.amazonaws.com and event.action:(DeleteRuleor DisableRule) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DeleteRule.html', 'https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_DisableRule.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-execution-via-system-manager.html,AWS Execution via System Manageredit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies the execution of commands and scripts via System Manager. Execution methods such as RunShellScript, RunPowerShellScript, and alike can be abused by an authenticated attacker to install a backdoor or to interact with a compromised instance via reverse-shell using system only commands.",['query'],event.dataset:aws.cloudtrail and event.provider:ssm.amazonaws.com andevent.action:SendCommand and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-plugins.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/aws-guardduty-detector-deletion.html,AWS GuardDuty Detector Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies the deletion of an Amazon GuardDuty detector. Upon deletion, GuardDuty stops monitoring the environment and all existing findings are lost.",['query'],event.dataset:aws.cloudtrail andevent.provider:guardduty.amazonaws.com and event.action:DeleteDetectorand event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/guardduty/delete-detector.html', 'https://docs.aws.amazon.com/guardduty/latest/APIReference/API_DeleteDetector.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-assume-role-policy-update.html,AWS IAM Assume Role Policy Updateedit,['Privilege Escalation'],['TA0004'],['Valid Accounts'],['T1078'],Identifies attempts to modify an AWS IAM Assume Role Policy. An adversary may attempt to modify the AssumeRolePolicy of a misconfigured role in order to gain the privileges of that role.,['query'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com andevent.action:UpdateAssumeRolePolicy and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://labs.bishopfox.com/tech-blog/5-privesc-attack-vectors-in-aws'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-brute-force-of-assume-role-policy.html,AWS IAM Brute Force of Assume Role Policyedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],Identifies a high number of failed attempts to assume an AWS Identity and Access Management (IAM) role. IAM roles are used to delegate access to users or services. An adversary may attempt to enumerate IAM roles in order to determine if a role exists before attempting to assume or hijack the discovered role.,['threshold'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.comand event.action:UpdateAssumeRolePolicy andaws.cloudtrail.error_code:MalformedPolicyDocumentException andevent.outcome:failure,"['filebeat-*', 'logs-aws*']","['https://www.praetorian.com/blog/aws-iam-assume-role-vulnerabilities', 'https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-deactivation-of-mfa-device.html,AWS IAM Deactivation of MFA Deviceedit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],"Identifies the deactivation of a specified multi-factor authentication (MFA) device and removes it from association with the user name for which it was originally enabled. In AWS Identity and Access Management (IAM), a device must be deactivated before it can be deleted.",['query'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com andevent.action:(DeactivateMFADevice or DeleteVirtualMFADevice) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/deactivate-mfa-device.html', 'https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeactivateMFADevice.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-group-creation.html,AWS IAM Group Creationedit,['Persistence'],['TA0003'],['Create Account'],['T1136'],Identifies the creation of a group in AWS Identity and Access Management (IAM). Groups specify permissions for multiple users. Any user in a group automatically has the permissions that are assigned to the group.,['query'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com andevent.action:CreateGroup and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/create-group.html', 'https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateGroup.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-group-deletion.html,AWS IAM Group Deletionedit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],Identifies the deletion of a specified AWS Identity and Access Management (IAM) resource group. Deleting a resource group does not delete resources that are members of the group; it only deletes the group structure.,['query'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com andevent.action:DeleteGroup and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/delete-group.html', 'https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteGroup.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-password-recovery-requested.html,AWS IAM Password Recovery Requestededit,['Initial Access'],['TA0001'],['Valid Accounts'],['T1078'],Identifies AWS IAM password recovery requests. An adversary may attempt to gain unauthorized AWS access by abusing password recovery mechanisms.,['query'],event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.comand event.action:PasswordRecoveryRequested and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://www.cadosecurity.com/2020/06/11/an-ongoing-aws-phishing-campaign/'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-iam-user-addition-to-group.html,AWS IAM User Addition to Groupedit,"['Credential Access', 'Persistence']","['TA0006', 'TA0003']",['Account Manipulation'],['T1098'],Identifies the addition of a user to a specified group in AWS Identity and Access Management (IAM).,['query'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com andevent.action:AddUserToGroup and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/IAM/latest/APIReference/API_AddUserToGroup.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-management-console-brute-force-of-root-user-identity.html,AWS Management Console Brute Force of Root User Identityedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],"Identifies a high number of failed authentication attempts to the AWS management console for the Root user identity. An adversary may attempt to brute force the password for the Root user identity, as it has complete access to all services and resources for the AWS account.",['threshold'],event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.comand event.action:ConsoleLogin andaws.cloudtrail.user_identity.type:Root and event.outcome:failure,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-management-console-root-login.html,AWS Management Console Root Loginedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']",Identifies a successful login to the AWS Management Console by the Root user.,['query'],event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.comand event.action:ConsoleLogin andaws.cloudtrail.user_identity.type:Root and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-cluster-creation.html,AWS RDS Cluster Creationedit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']",['External Remote Services'],['T1133'],Identifies the creation of a new Amazon Relational Database Service (RDS) Aurora DB cluster or global database spread across multiple regions.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:(CreateDBCluster or CreateGlobalCluster) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/create-db-cluster.html', 'https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_CreateDBCluster.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/create-global-cluster.html', 'https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_CreateGlobalCluster.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-cluster-deletion.html,AWS RDS Cluster Deletionedit,['Impact'],['TA0040'],['Data Destruction'],['T1485'],Identifies the deletion of an Amazon Relational Database Service (RDS) Aurora database cluster or global database cluster.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:(DeleteDBCluster or DeleteGlobalCluster) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/delete-db-cluster.html', 'https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteDBCluster.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/delete-global-cluster.html', 'https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteGlobalCluster.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-instance-creation.html,AWS RDS Instance Creationedit,['Persistence'],['TA0003'],[],[],Identifies the creation of an Amazon Relational Database Service (RDS) Aurora database instance.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:CreateDBInstance and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_CreateDBInstance.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-instance-cluster-stoppage.html,AWS RDS Instance/Cluster Stoppageedit,['Impact'],['TA0040'],['Service Stop'],['T1489'],Identifies that an Amazon Relational Database Service (RDS) cluster or instance has been stopped.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:(StopDBCluster or StopDBInstance) andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/stop-db-cluster.html', 'https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_StopDBCluster.html', 'https://awscli.amazonaws.com/v2/documentation/api/latest/reference/rds/stop-db-instance.html', 'https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_StopDBInstance.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-security-group-creation.html,AWS RDS Security Group Creationedit,['Persistence'],['TA0003'],['Create Account'],['T1136'],Identifies the creation of an Amazon Relational Database Service (RDS) Security group.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:CreateDBSecurityGroup and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_CreateDBSecurityGroup.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-security-group-deletion.html,AWS RDS Security Group Deletionedit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],Identifies the deletion of an Amazon Relational Database Service (RDS) Security group.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:DeleteDBSecurityGroup and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteDBSecurityGroup.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-snapshot-export.html,AWS RDS Snapshot Exportedit,['Exfiltration'],['TA0010'],[],[],Identifies the export of an Amazon Relational Database Service (RDS) Aurora database snapshot.,['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:StartExportTask and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_StartExportTask.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-rds-snapshot-restored.html,AWS RDS Snapshot Restorededit,['Exfiltration'],['TA0010'],[],[],"Identifies when an attempt was made to restored RDS Snapshot. Snapshots are sometimes shared by threat actors in order to exfiltrate bulk data. If the permissions were modified, verify if the snapshot was shared with an unauthorized or unexpected AWS account.",['query'],event.dataset:aws.cloudtrail and event.provider:rds.amazonaws.com andevent.action:RestoreDBInstanceFromDBSnapshot and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_RestoreDBInstanceFromDBSnapshot.html', 'https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/rds__explore_snapshots/main.py']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-root-login-without-mfa.html,AWS Root Login Without MFAedit,['Privilege Escalation'],['TA0004'],['Valid Accounts'],['T1078'],Identifies attempts to login to AWS as the root user without using multi-factor authentication (MFA). Amazon AWS best practices indicate that the root user should be protected by MFA.,['query'],event.dataset:aws.cloudtrail and event.provider:signin.amazonaws.comand event.action:ConsoleLogin andaws.cloudtrail.user_identity.type:Root andaws.cloudtrail.console_login.additional_eventdata.mfa_used:false andevent.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-route-53-domain-transfer-lock-disabled.html,AWS Route 53 Domain Transfer Lock Disablededit,"['Persistence', 'Credential Access']","['TA0003', 'TA0006']",['Account Manipulation'],['T1098'],Identifies when a transfer lock was removed from a Route 53 domain. It is recommended to refrain from performing this action unless intending to transfer the domain to a different registrar.,['query'],event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.comand event.action:DisableDomainTransferLock and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/Route53/latest/APIReference/API_Operations_Amazon_Route_53.html', 'https://docs.aws.amazon.com/Route53/latest/APIReference/API_domains_DisableDomainTransferLock.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-route-53-domain-transferred-to-another-account.html,AWS Route 53 Domain Transferred to Another Accountedit,"['Persistence', 'Credential Access']","['TA0003', 'TA0006']",['Account Manipulation'],['T1098'],Identifies when a request has been made to transfer a Route 53 domain to another AWS account.,['query'],event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.comand event.action:TransferDomainToAnotherAwsAccount andevent.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/Route53/latest/APIReference/API_Operations_Amazon_Route_53.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-route-table-created.html,AWS Route Table Creatededit,['Persistence'],['TA0003'],[],[],Identifies when an AWS Route Table has been created.,['query'],event.dataset:aws.cloudtrail andevent.provider:cloudtrail.amazonaws.com and event.action:(CreateRouteor CreateRouteTable) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.datadoghq.com/security_platform/default_rules/cloudtrail-aws-route-table-modified/', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRoute.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateRouteTable']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-route-table-modified-or-deleted.html,AWS Route Table Modified or Deletededit,['Persistence'],['TA0003'],[],[],Identifies when an AWS Route Table has been modified or deleted.,['query'],event.dataset:aws.cloudtrail andevent.provider:cloudtrail.amazonaws.com and event.action:(ReplaceRouteor ReplaceRouteTableAssociation or DeleteRouteTable or DeleteRoute orDisassociateRouteTable) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://github.com/easttimor/aws-incident-response#network-routing', 'https://docs.datadoghq.com/security_platform/default_rules/cloudtrail-aws-route-table-modified', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html', 'https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-route53-private-hosted-zone-associated-with-a-vpc.html,AWS Route53 private hosted zone associated with a VPCedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when a Route53 private hosted zone has been associated with VPC.,['query'],event.dataset:aws.cloudtrail and event.provider:route53.amazonaws.comand event.action:AssociateVPCWithHostedZone and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/Route53/latest/APIReference/API_AssociateVPCWithHostedZone.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-s3-bucket-configuration-deletion.html,AWS S3 Bucket Configuration Deletionedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Identifies the deletion of various Amazon Simple Storage Service (S3) bucket configuration components.,['query'],event.dataset:aws.cloudtrail and event.provider:s3.amazonaws.com andevent.action:(DeleteBucketPolicy or DeleteBucketReplication orDeleteBucketCors or DeleteBucketEncryption orDeleteBucketLifecycle) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketPolicy.html', 'https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketReplication.html', 'https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketCors.html', 'https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketEncryption.html', 'https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteBucketLifecycle.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/aws-saml-activity.html,AWS SAML Activityedit,"['Defense Evasion', 'Initial Access']","['TA0005', 'TA0001']","['Use Alternate Authentication Material', 'Valid Accounts']","['T1550', 'T1078']",Identifies when SAML activity has occurred in AWS. An adversary could manipulate SAML to maintain access to the target.,['query'],event.dataset:aws.cloudtrail and event.provider:(iam.amazonaws.com orsts.amazonaws.com) and event.action:(Assumerolewithsaml orUpdateSAMLProvider) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateSAMLProvider.html', 'https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-sts-getsessiontoken-abuse.html,AWS STS GetSessionToken Abuseedit,"['Privilege Escalation', 'Lateral Movement']","['TA0004', 'TA0008']","['Abuse Elevation Control Mechanism', 'Use Alternate Authentication Material']","['T1548', 'T1550']",Identifies the suspicious use of GetSessionToken. Tokens could be created and used by attackers to move laterally and escalate privileges.,['query'],event.dataset:aws.cloudtrail and event.provider:sts.amazonaws.com andevent.action:GetSessionToken andaws.cloudtrail.user_identity.type:IAMUser and event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-security-group-configuration-change-detection.html,AWS Security Group Configuration Change Detectionedit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']",['Impair Defenses'],['T1562'],"Identifies a change to an AWS Security Group Configuration. A security group is like a virtual firewall, and modifying configurations may allow unauthorized access. Threat actors may abuse this to establish persistence, exfiltrate data, or pivot in an AWS environment.",['query'],event.dataset:aws.cloudtrail and event.provider:iam.amazonaws.com andevent.action:(AuthorizeSecurityGroupEgress or CreateSecurityGroup orModifyInstanceAttribute or ModifySecurityGroupRules orRevokeSecurityGroupEgress or RevokeSecurityGroupIngress) andevent.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-security-groups.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-security-token-service-sts-assumerole-usage.html,AWS Security Token Service (STS) AssumeRole Usageedit,"['Privilege Escalation', 'Lateral Movement']","['TA0004', 'TA0008']","['Abuse Elevation Control Mechanism', 'Use Alternate Authentication Material']","['T1548', 'T1550']",Identifies the use of AssumeRole. AssumeRole returns a set of temporary security credentials that can be used to access AWS resources. An adversary could use those credentials to move laterally and escalate privileges.,['query'],event.dataset:aws.cloudtrail and event.provider:sts.amazonaws.com andevent.action:AssumedRole andaws.cloudtrail.user_identity.session_context.session_issuer.type:Roleand event.outcome:success,"['filebeat-*', 'logs-aws*']",['https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html'],"['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/aws-waf-access-control-list-deletion.html,AWS WAF Access Control List Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of a specified AWS Web Application Firewall (WAF) access control list.,['query'],event.dataset:aws.cloudtrail and event.action:DeleteWebACL andevent.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/waf-regional/delete-web-acl.html', 'https://docs.aws.amazon.com/waf/latest/APIReference/API_wafRegional_DeleteWebACL.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/aws-waf-rule-or-rule-group-deletion.html,AWS WAF Rule or Rule Group Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of a specified AWS Web Application Firewall (WAF) rule or rule group.,['query'],event.dataset:aws.cloudtrail and event.action:(DeleteRule orDeleteRuleGroup) and event.outcome:success,"['filebeat-*', 'logs-aws*']","['https://awscli.amazonaws.com/v2/documentation/api/latest/reference/waf/delete-rule-group.html', 'https://docs.aws.amazon.com/waf/latest/APIReference/API_waf_DeleteRuleGroup.html']","['Elastic', 'Cloud', 'AWS', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/abnormally-large-dns-response.html,Abnormally Large DNS Responseedit,['Lateral Movement'],['TA0008'],['Exploitation of Remote Services'],['T1210'],Specially crafted DNS requests can manipulate a known overflow vulnerability in some Windows DNS servers which result in Remote Code Execution (RCE) or a Denial of Service (DoS) from crashing the service.,['query'],event.category:(network or network_traffic) and destination.port:53and (event.dataset:zeek.dns or type:dns or event.type:connection)and network.bytes > 60000,"['packetbeat-*', 'filebeat-*']","['https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/', 'https://msrc-blog.microsoft.com/2020/07/14/july-2020-security-update-cve-2020-1350-vulnerability-in-windows-domain-name-system-dns-server/', 'https://github.com/maxpl0it/CVE-2020-1350-DoS']","['Elastic', 'Network', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/access-of-stored-browser-credentials.html,Access of Stored Browser Credentialsedit,['Credential Access'],['TA0006'],['Credentials from Password Stores'],['T1555'],Identifies the execution of a process with arguments pointing to known browser files that store passwords and cookies. Adversaries may acquire credentials from web browsers by reading files specific to the target browser.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.args : ( ""/Users/*/Library/ApplicationSupport/Google/Chrome/Default/Login Data"",""/Users/*/Library/Application Support/Google/Chrome/Default/Cookies"",""/Users/*/Library/Cookies*"", ""/Users/*/Library/ApplicationSupport/Firefox/Profiles/*.default/cookies.sqlite"",""/Users/*/Library/ApplicationSupport/Firefox/Profiles/*.default/key*.db"",""/Users/*/Library/ApplicationSupport/Firefox/Profiles/*.default/logins.json"", ""Login Data"",""Cookies.binarycookies"", ""key4.db"", ""key3.db"",""logins.json"", ""cookies.sqlite"" )","['auditbeat-*', 'logs-endpoint.events.*']",['https://securelist.com/calisto-trojan-for-macos/86543/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/access-to-keychain-credentials-directories.html,Access to Keychain Credentials Directoriesedit,['Credential Access'],['TA0006'],['Credentials from Password Stores'],['T1555'],"Adversaries may collect the keychain storage data from a system to acquire credentials. Keychains are the built-in way for macOS to keep track of users' passwords and credentials for many services and features such as WiFi passwords, websites, secure notes and certificates.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.args : ( ""/Users/*/Library/Keychains/*"",""/Library/Keychains/*"", ""/Network/Library/Keychains/*"",""System.keychain"", ""login.keychain-db"", ""login.keychain"") and not process.args : (""find-certificate"",""add-trusted-cert"", ""set-keychain-settings"",""delete-certificate"",""/Users/*/Library/Keychains/openvpn.keychain-db"",""show-keychain-info"", ""lock-keychain"",""set-key-partition-list"", ""import"",""find-identity"") and not process.parent.executable :""/Applications/OpenVPN Connect/OpenVPNConnect.app/Contents/MacOS/OpenVPN Connect""","['auditbeat-*', 'logs-endpoint.events.*']","['https://objective-see.com/blog/blog_0x25.html', 'https://securelist.com/calisto-trojan-for-macos/86543/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/adfind-command-activity.html,AdFind Command Activityedit,['Discovery'],['TA0007'],['Permission Groups Discovery'],['T1069'],"This rule detects the Active Directory query tool, AdFind.exe. AdFind has legitimate purposes, but it is frequently leveraged by threat actors to perform post-exploitation Active Directory reconnaissance. The AdFind tool has been observed in Trickbot, Ryuk, Maze, and FIN6 campaigns. For Winlogbeat, this rule requires Sysmon.",['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""AdFind.exe"" or process.pe.original_file_name ==""AdFind.exe"") and process.args : (""objectcategory=computer"",""(objectcategory=computer)"",""objectcategory=person"", ""(objectcategory=person)"",""objectcategory=subnet"", ""(objectcategory=subnet)"",""objectcategory=group"", ""(objectcategory=group)"",""objectcategory=organizationalunit"",""(objectcategory=organizationalunit)"",""objectcategory=attributeschema"", ""(objectcategory=attributeschema)"",""domainlist"", ""dcmodes"", ""adinfo"", ""dclist"", ""computers_pwnotreqd"",""trustdmp"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['http://www.joeware.net/freetools/tools/adfind/', 'https://thedfirreport.com/2020/05/08/adfind-recon/', 'https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html', 'https://www.cybereason.com/blog/dropping-anchor-from-a-trickbot-infection-to-the-discovery-of-the-anchor-malware', 'https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html', 'https://usa.visa.com/dam/VCOM/global/support-legal/documents/fin6-cybercrime-group-expands-threat-To-ecommerce-merchants.pdf']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/adding-hidden-file-attribute-via-attrib.html,Adding Hidden File Attribute via Attribedit,"['Defense Evasion', 'Persistence']","['TA0005', 'TA0003']",['Hide Artifacts'],['T1564'],Adversaries can add the hidden attribute to files to hide them from the user in an attempt to evade detection.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""attrib.exe"" and process.args : ""+h""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/administrator-privileges-assigned-to-an-okta-group.html,Administrator Privileges Assigned to an Okta Groupedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects when an administrator role is assigned to an Okta group. An adversary may attempt to assign administrator privileges to an Okta group in order to assign additional permissions to compromised user accounts and maintain access to their target organization.,['query'],event.dataset:okta.system and event.action:group.privilege.grant,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/administrators-admin-comparison.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/administrator-role-assigned-to-an-okta-user.html,Administrator Role Assigned to an Okta Useredit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when an administrator role is assigned to an Okta user. An adversary may attempt to assign an administrator role to an Okta user in order to assign additional permissions to a user account and maintain access to their targets environment.,['query'],event.dataset:okta.system andevent.action:user.account.privilege.grant,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/administrators-admin-comparison.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Okta', 'SecOps', 'Monitoring', 'Continuous Monitoring']"
https://www.elastic.co/guide/en/security/7.16/adobe-hijack-persistence.html,Adobe Hijack Persistenceedit,['Persistence'],['TA0003'],['Hijack Execution Flow'],['T1574'],Detects writing executable files that will be automatically launched by Adobe on launch.,['eql'],"file where event.type == ""creation"" and file.path : (""?:\\ProgramFiles (x86)\\Adobe\\Acrobat Reader DC\\Reader\\AcroCEF\\RdrCEF.exe"",""?:\\Program Files\\Adobe\\Acrobat ReaderDC\\Reader\\AcroCEF\\RdrCEF.exe"") and not process.name :""msiexec.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/adversary-behavior-detected-elastic-endgame.html,Adversary Behavior - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected an Adversary Behavior. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame and(event.action:rules_engine_event orendgame.event_subtype_full:rules_engine_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/agent-spoofing-mismatched-agent-id.html,Agent Spoofing - Mismatched Agent IDedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],"Detects events which have a mismatch on the expected event agent ID. The status ""agent_id_mismatch"" occurs when the expected agent ID associated with the API key does not match the actual agent ID in an event. This could indicate attempts to spoof events in order to masquerade actual activity to evade detection.",['query'],event.agent_id_status:agent_id_mismatch,"['logs-*', 'metrics-*', 'traces-*']",N/A,"['Elastic', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/agent-spoofing-multiple-hosts-using-same-agent.html,Agent Spoofing - Multiple Hosts Using Same Agentedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],Detects when multiple hosts are using the same agent ID. This could occur in the event of an agent being taken over and used to inject illegitimate documents into an instance as an attempt to spoof events in order to masquerade actual activity to evade detection.,['threshold'],event.agent_id_status:*,"['logs-*', 'metrics-*', 'traces-*']",N/A,"['Elastic', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/anomalous-kernel-module-activity.html,Anomalous Kernel Module Activityedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Looks for unusual kernel module activity. Kernel modules are sometimes used by malware and persistence mechanisms for stealth.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/anomalous-linux-compiler-activity.html,Anomalous Linux Compiler Activityedit,[],[],[],[],Looks for compiler activity by a user context which does not normally run compilers. This can be the result of ad-hoc software changes or unauthorized software deployment. This can also be due to local privilege elevation via locally run exploits or malware activity.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/anomalous-process-for-a-linux-population.html,Anomalous Process For a Linux Populationedit,[],[],[],[],Searches for rare processes running on multiple Linux hosts in an entire fleet or network. This reduces the detection of false positives since automated maintenance processes usually only run occasionally on a single machine but are common to all or many hosts in a fleet.,['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/anomalous-process-for-a-windows-population.html,Anomalous Process For a Windows Populationedit,[],[],[],[],Searches for rare processes running on multiple hosts in an entire fleet or network. This reduces the detection of false positives since automated maintenance processes usually only run occasionally on a single machine but are common to all or many hosts in a fleet.,['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/anomalous-windows-process-creation.html,Anomalous Windows Process Creationedit,[],[],[],[],"Identifies unusual parent-child process relationships that can indicate malware execution or persistence mechanisms. Malicious scripts often call on other applications and processes as part of their exploit payload. For example, when a malicious Office document runs scripts as part of an exploit payload, Excel or Word may start a script interpreter process, which, in turn, runs a script that downloads and executes malware. Another common scenario is Outlook running an unusual process when malware is downloaded in an email. Monitoring and identifying anomalous process relationships is a method of detecting new and emerging malware that is not yet recognized by anti-virus scanners.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/apple-script-execution-followed-by-network-connection.html,Apple Script Execution followed by Network Connectionedit,"['Execution', 'Command and Control']","['TA0002', 'TA0011']","['Command and Scripting Interpreter', 'Ingress Tool Transfer']","['T1059', 'T1105']",Detects execution via the Apple script interpreter (osascript) followed by a network connection from the same process within a short time period. Adversaries may use malicious scripts for execution and command and control.,['eql'],"sequence by host.id, process.entity_id with maxspan=30s [processwhere event.type == ""start"" and process.name == ""osascript""] [networkwhere event.type != ""end"" and process.name == ""osascript"" anddestination.ip != ""::1"" and not cidrmatch(destination.ip,""10.0.0.0/8"", ""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"",""192.0.0.0/24"", ""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"",""192.0.0.10/32"", ""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"",""192.31.196.0/24"", ""192.52.193.0/24"", ""192.168.0.0/16"",""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"", ""192.175.48.0/24"",""198.18.0.0/15"", ""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"",""::1"", ""FE80::/10"", ""FF00::/8"")]","['auditbeat-*', 'logs-endpoint.events.*']","['https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/index.html', 'https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Command and Control', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/apple-scripting-execution-with-administrator-privileges.html,Apple Scripting Execution with Administrator Privilegesedit,"['Privilege Escalation', 'Execution']","['TA0004', 'TA0002']","['Valid Accounts', 'Command and Scripting Interpreter']","['T1078', 'T1059']",Identifies execution of the Apple script interpreter (osascript) without a password prompt and with administrator privileges.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""osascript"" and process.command_line :""osascript*with administrator privileges""","['auditbeat-*', 'logs-endpoint.events.*']",['https://discussions.apple.com/thread/2266150'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Execution', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/application-added-to-google-workspace-domain.html,Application Added to Google Workspace Domainedit,[],[],[],[],Detects when a Google marketplace application is added to the Google Workspace domain. An adversary may add a malicious application to an organizations Google Workspace domain in order to maintain a presence in their targets organization and steal data.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:ADD_APPLICATION,"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/6328701?hl=en#'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-create-okta-api-token.html,Attempt to Create Okta API Tokenedit,['Persistence'],['TA0003'],['Create Account'],['T1136'],Detects attempts to create an Okta API token. An adversary may create an Okta API token to maintain access to an organizations network while they work to achieve their objectives. An attacker may abuse an API token to execute techniques such as creating user accounts or disabling security rules or policies.,['query'],event.dataset:okta.system and event.action:system.api_token.create,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-deactivate-mfa-for-an-okta-user-account.html,Attempt to Deactivate MFA for an Okta User Accountedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects attempts to deactivate multi-factor authentication (MFA) for an Okta user. An adversary may deactivate MFA for an Okta user account in order to weaken the authentication requirements for the account.,['query'],event.dataset:okta.system and event.action:user.mfa.factor.deactivate,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-deactivate-an-okta-application.html,Attempt to Deactivate an Okta Applicationedit,[],[],[],[],"Detects attempts to deactivate an Okta application. An adversary may attempt to modify, deactivate, or delete an Okta application in order to weaken an organizations security controls or disrupt their business operations.",['query'],event.dataset:okta.system andevent.action:application.lifecycle.deactivate,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Apps/Apps_Apps.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-deactivate-an-okta-network-zone.html,Attempt to Deactivate an Okta Network Zoneedit,[],[],[],[],"Detects attempts to deactivate an Okta network zone. Okta network zones can be configured to limit or restrict access to a network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta network zone in order to remove or weaken an organizations security controls.",['query'],event.dataset:okta.system and event.action:zone.deactivate,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-deactivate-an-okta-policy.html,Attempt to Deactivate an Okta Policyedit,[],[],[],[],"Detects attempts to deactivate an Okta policy. An adversary may attempt to deactivate an Okta policy in order to weaken an organizations security controls. For example, an adversary may attempt to deactivate an Okta multi-factor authentication (MFA) policy in order to weaken the authentication requirements for user accounts.",['query'],event.dataset:okta.system and event.action:policy.lifecycle.deactivate,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-deactivate-an-okta-policy-rule.html,Attempt to Deactivate an Okta Policy Ruleedit,[],[],[],[],Detects attempts to deactivate a rule within an Okta policy. An adversary may attempt to deactivate a rule within an Okta policy in order to remove or weaken an organizations security controls.,['query'],event.dataset:okta.system and event.action:policy.rule.deactivate,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-delete-an-okta-application.html,Attempt to Delete an Okta Applicationedit,[],[],[],[],"Detects attempts to delete an Okta application. An adversary may attempt to modify, deactivate, or delete an Okta application in order to weaken an organizations security controls or disrupt their business operations.",['query'],event.dataset:okta.system andevent.action:application.lifecycle.delete,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-delete-an-okta-network-zone.html,Attempt to Delete an Okta Network Zoneedit,[],[],[],[],"Detects attempts to delete an Okta network zone. Okta network zones can be configured to limit or restrict access to a network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta network zone in order to remove or weaken an organizations security controls.",['query'],event.dataset:okta.system and event.action:zone.delete,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-delete-an-okta-policy.html,Attempt to Delete an Okta Policyedit,[],[],[],[],"Detects attempts to delete an Okta policy. An adversary may attempt to delete an Okta policy in order to weaken an organizations security controls. For example, an adversary may attempt to delete an Okta multi-factor authentication (MFA) policy in order to weaken the authentication requirements for user accounts.",['query'],event.dataset:okta.system and event.action:policy.lifecycle.delete,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-delete-an-okta-policy-rule.html,Attempt to Delete an Okta Policy Ruleedit,[],[],[],[],Detects attempts to delete a rule within an Okta policy. An adversary may attempt to delete an Okta policy rule in order to weaken an organizations security controls.,['query'],event.dataset:okta.system and event.action:policy.rule.delete,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-disable-gatekeeper.html,Attempt to Disable Gatekeeperedit,['Defense Evasion'],['TA0005'],['Subvert Trust Controls'],['T1553'],Detects attempts to disable Gatekeeper on macOS. Gatekeeper is a security feature thats designed to ensure that only trusted software is run. Adversaries may attempt to disable Gatekeeper before executing malicious code.,['query'],"event.category:process and event.type:(start or process_started) andprocess.args:(spctl and ""--master-disable"")","['auditbeat-*', 'logs-endpoint.events.*']","['https://support.apple.com/en-us/HT202491', 'https://www.carbonblack.com/blog/tau-threat-intelligence-notification-new-macos-malware-variant-of-shlayer-osx-discovered/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-disable-iptables-or-firewall.html,Attempt to Disable IPTables or Firewalledit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Adversaries may attempt to disable the iptables or firewall service in an attempt to affect how a host is allowed to receive or send network traffic.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:ufw and process.args:(allow or disable or reset) or(((process.name:service and process.args:stop) or(process.name:chkconfig and process.args:off) or(process.name:systemctl and process.args:(disable or stop or kill)))and process.args:(firewalld or ip6tables or iptables)),"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-disable-syslog-service.html,Attempt to Disable Syslog Serviceedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Adversaries may attempt to disable the syslog service in an attempt to an attempt to disrupt event logging and evade detection by security controls.,['query'],"event.category:process and event.type:(start or process_started) and((process.name:service and process.args:stop) or(process.name:chkconfig and process.args:off) or(process.name:systemctl and process.args:(disable or stop or kill)))and process.args:(syslog or rsyslog or ""syslog-ng"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-enable-the-root-account.html,Attempt to Enable the Root Accountedit,['Persistence'],['TA0003'],['Valid Accounts'],['T1078'],"Identifies attempts to enable the root account using the dsenableroot command. This command may be abused by adversaries for persistence, as the root account is disabled by default.",['query'],"event.category:process and event.type:(start or process_started) andprocess.name:dsenableroot and not process.args:""-d""","['auditbeat-*', 'logs-endpoint.events.*']",['https://ss64.com/osx/dsenableroot.html'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-install-root-certificate.html,Attempt to Install Root Certificateedit,['Defense Evasion'],['TA0005'],['Subvert Trust Controls'],['T1553'],"Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to their command and control servers. Root certificates are used in public key cryptography to identify a root certificate authority (CA). When a root certificate is installed, the system or application will trust certificates in the roots chain of trust that have been signed by the root certificate.",['query'],"event.category:process and event.type:(start or process_started) andprocess.name:security and process.args:""add-trusted-cert""","['auditbeat-*', 'logs-endpoint.events.*']",['https://ss64.com/osx/security-cert.html'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-modify-an-okta-application.html,Attempt to Modify an Okta Applicationedit,[],[],[],[],"Detects attempts to modify an Okta application. An adversary may attempt to modify, deactivate, or delete an Okta application in order to weaken an organizations security controls or disrupt their business operations.",['query'],event.dataset:okta.system andevent.action:application.lifecycle.update,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Apps/Apps_Apps.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-modify-an-okta-network-zone.html,Attempt to Modify an Okta Network Zoneedit,[],[],[],[],"Detects attempts to modify an Okta network zone. Okta network zones can be configured to limit or restrict access to a network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta network zone in order to remove or weaken an organizations security controls.",['query'],event.dataset:okta.system and event.action:(zone.update ornetwork_zone.rule.disabled or zone.remove_blacklist),"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-modify-an-okta-policy.html,Attempt to Modify an Okta Policyedit,[],[],[],[],"Detects attempts to modify an Okta policy. An adversary may attempt to modify an Okta policy in order to weaken an organizations security controls. For example, an adversary may attempt to modify an Okta multi-factor authentication (MFA) policy in order to weaken the authentication requirements for user accounts.",['query'],event.dataset:okta.system and event.action:policy.lifecycle.update,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-modify-an-okta-policy-rule.html,Attempt to Modify an Okta Policy Ruleedit,[],[],[],[],Detects attempts to modify a rule within an Okta policy. An adversary may attempt to modify an Okta policy rule in order to weaken an organizations security controls.,['query'],event.dataset:okta.system and event.action:policy.rule.update,"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-mount-smb-share-via-command-line.html,Attempt to Mount SMB Share via Command Lineedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies the execution of macOS built-in commands to mount a Server Message Block (SMB) network share. Adversaries may use valid accounts to interact with a remote network share using SMB.,['eql'],"process where event.type in (""start"", ""process_started"") and (process.name : ""mount_smbfs"" or (process.name : ""open"" andprocess.args : ""smb://*"") or (process.name : ""mount"" andprocess.args : ""smbfs"") or (process.name : ""osascript"" andprocess.command_line : ""osascript*mount volume*smb://*"") )","['auditbeat-*', 'logs-endpoint.events.*']","['https://www.freebsd.org/cgi/man.cgi?mount_smbfs', 'https://ss64.com/osx/mount.html']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-remove-file-quarantine-attribute.html,Attempt to Remove File Quarantine Attributeedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies a potential Gatekeeper bypass. In macOS, when applications or programs are downloaded from the internet, there is a quarantine flag set on the file. This attribute is read by Apples Gatekeeper defense program at execution time. An adversary may disable this attribute to evade defenses.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.args : ""xattr"" and ( (process.args :""com.apple.quarantine"" and process.args : (""-d"", ""-w"")) or(process.args : ""-c"" and process.command_line : (""/bin/bash -c xattr -c *"", ""/bin/zsh -c xattr -c *"",""/bin/sh -c xattr -c *"" ) ) )","['auditbeat-*', 'logs-endpoint.events.*']","['https://www.trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html', 'https://ss64.com/osx/xattr.html']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-reset-mfa-factors-for-an-okta-user-account.html,Attempt to Reset MFA Factors for an Okta User Accountedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects attempts to reset an Okta users enrolled multi-factor authentication (MFA) factors. An adversary may attempt to reset the MFA factors for an Okta users account in order to register new MFA factors and abuse the account to blend in with normal activity in the victims environment.,['query'],event.dataset:okta.system and event.action:user.mfa.factor.reset_all,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-revoke-okta-api-token.html,Attempt to Revoke Okta API Tokenedit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],Identifies attempts to revoke an Okta API token. An adversary may attempt to revoke or delete an Okta API token to disrupt an organizations business operations.,['query'],event.dataset:okta.system and event.action:system.api_token.revoke,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/attempt-to-unload-elastic-endpoint-security-kernel-extension.html,Attempt to Unload Elastic Endpoint Security Kernel Extensionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies attempts to unload the Elastic Endpoint Security kernel extension via the kextunload command.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:kextunload andprocess.args:(""/System/Library/Extensions/EndpointSecurity.kext"" or""EndpointSecurity.kext"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/attempted-bypass-of-okta-mfa.html,Attempted Bypass of Okta MFAedit,['Credential Access'],['TA0006'],['Two-Factor Authentication Interception'],['T1111'],Detects attempts to bypass Okta multi-factor authentication (MFA). An adversary may attempt to bypass the Okta MFA policies configured for an organization in order to obtain unauthorized access to an application.,['query'],event.dataset:okta.system and event.action:user.mfa.attempt_bypass,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/attempts-to-brute-force-a-microsoft-365-user-account.html,Attempts to Brute Force a Microsoft 365 User Accountedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],Identifies attempts to brute force a Microsoft 365 user account. An adversary may attempt a brute force attack to obtain unauthorized access to user accounts.,['threshold'],event.dataset:o365.audit and event.provider:(AzureActiveDirectory orExchange) and event.category:authentication andevent.action:(UserLoginFailed orPasswordLogonInitialAuthUsingPassword) and noto365.audit.LogonError:(UserAccountNotFound orEntitlementGrantsNotFound or UserStrongAuthEnrollmentRequired orUserStrongAuthClientAuthNRequired or InvalidReplyTo) andevent.outcome:failure,"['filebeat-*', 'logs-o365*']",['https://blueteamblog.com/7-ways-to-monitor-your-office-365-logs-using-siem'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/attempts-to-brute-force-an-okta-user-account.html,Attempts to Brute Force an Okta User Accountedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],Identifies when an Okta user account is locked out 3 times within a 3 hour window. An adversary may attempt a brute force or password spraying attack to obtain unauthorized access to user accounts. The default Okta authentication policy ensures that a user account is locked out after 10 failed authentication attempts.,['threshold'],event.dataset:okta.system and event.action:user.account.lock,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/auditd-login-attempt-at-forbidden-time.html,Auditd Login Attempt at Forbidden Timeedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']",Identifies that a login attempt occurred at a forbidden time.,['query'],"event.module:auditd and event.action:""attempted-log-in-during-unusual-hour-to""",['auditbeat-*'],['https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_time/pam_time.c#L666'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/auditd-login-from-forbidden-location.html,Auditd Login from Forbidden Locationedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']",Identifies that a login attempt has happened from a forbidden location.,['query'],"event.module:auditd and event.action:""attempted-log-in-from-unusual-place-to""",['auditbeat-*'],['https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_access/pam_access.c#L412'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/auditd-max-failed-login-attempts.html,Auditd Max Failed Login Attemptsedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']",Identifies that the maximum number of failed login attempts has been reached for a user.,['query'],"event.module:auditd and event.action:""failed-log-in-too-many-times-to""",['auditbeat-*'],['https://github.com/linux-pam/linux-pam/blob/0adbaeb273da1d45213134aa271e95987103281c/modules/pam_faillock/pam_faillock.c#L574'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/auditd-max-login-sessions.html,Auditd Max Login Sessionsedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']",Identifies that the maximum number login sessions has been reached for a user.,['query'],"event.module:auditd and event.action:""opened-too-many-sessions-to""",['auditbeat-*'],['https://github.com/linux-pam/linux-pam/blob/70c32cc6fca51338f92afa58eb75b1107a5c2430/modules/pam_limits/pam_limits.c#L1007'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/authorization-plugin-modification.html,Authorization Plugin Modificationedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],"Authorization plugins are used to extend the authorization services API and implement mechanisms that are not natively supported by the OS, such as multi-factor authentication with third party software. Adversaries may abuse this feature to persist and/or collect clear text credentials as they traverse the registered plugins during user logon.",['query'],event.category:file and not event.type:deletion andfile.path:(/Library/Security/SecurityAgentPlugins/* and not /Library/Security/SecurityAgentPlugins/TeamViewerAuthPlugin.bundle/Contents/*),"['auditbeat-*', 'logs-endpoint.events.*']","['https://developer.apple.com/documentation/security/authorization_plug-ins', 'https://www.xorrior.com/persistent-credential-theft/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/azure-active-directory-high-risk-sign-in.html,Azure Active Directory High Risk Sign-inedit,['Initial Access'],['TA0001'],['Valid Accounts'],['T1078'],"Identifies high risk Azure Active Directory (AD) sign-ins by leveraging Microsofts Identity Protection machine learning and heuristics. Identity Protection categorizes risk into three tiers: low, medium, and high. While Microsoft does not provide specific details about how risk is calculated, each level brings higher confidence that the user or sign-in is compromised.",['query'],event.dataset:azure.signinlogs and(azure.signinlogs.properties.risk_level_during_signin:high orazure.signinlogs.properties.risk_level_aggregated:high) andevent.outcome:(success or Success),"['filebeat-*', 'logs-azure*']","['https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-risk', 'https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/overview-identity-protection', 'https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-investigate-risk']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-active-directory-powershell-sign-in.html,Azure Active Directory PowerShell Sign-inedit,['Initial Access'],['TA0001'],['Valid Accounts'],['T1078'],"Identifies a sign-in using the Azure Active Directory PowerShell module. PowerShell for Azure Active Directory allows for managing settings from the command line, which is intended for users who are members of an admin role.",['query'],"event.dataset:azure.signinlogs andazure.signinlogs.properties.app_display_name:""Azure Active DirectoryPowerShell"" andazure.signinlogs.properties.token_issuer_type:AzureAD andevent.outcome:(success or Success)","['filebeat-*', 'logs-azure*']","['https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/', 'https://docs.microsoft.com/en-us/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-application-credential-modification.html,Azure Application Credential Modificationedit,['Defense Evasion'],['TA0005'],['Use Alternate Authentication Material'],['T1550'],Identifies when a new credential is added to an application in Azure. An application may use a certificate or secret string to prove its identity when requesting a token. Multiple certificates and secrets can be added for an application and an adversary may abuse this by creating an additional authentication method to evade defenses or persist in an environment.,['query'],"event.dataset:azure.auditlogs andazure.auditlogs.operation_name:""Update application - Certificates andsecrets management"" and event.outcome:(success or Success)","['filebeat-*', 'logs-azure*']",['https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-automation-account-created.html,Azure Automation Account Creatededit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']",Identifies when an Azure Automation account is created. Azure Automation accounts can be used to automate management tasks and orchestrate actions across systems. An adversary may create an Automation account in order to maintain persistence in their targets environment.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor', 'https://github.com/hausec/PowerZure', 'https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a', 'https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-automation-runbook-created-or-modified.html,Azure Automation Runbook Created or Modifiededit,[],[],[],[],Identifies when an Azure Automation runbook is created or modified. An adversary may create or modify an Azure Automation runbook to execute malicious code and maintain persistence in their targets environment.,['query'],"event.dataset:azure.activitylogs andazure.activitylogs.operation_name: (""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE"" or""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE"" or""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION"" )and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor', 'https://github.com/hausec/PowerZure', 'https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a', 'https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/azure-automation-runbook-deleted.html,Azure Automation Runbook Deletededit,[],[],[],[],Identifies when an Azure Automation runbook is deleted. An adversary may delete an Azure Automation runbook in order to disrupt their targets automated business operations or to remove a malicious runbook that was used for persistence.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor', 'https://github.com/hausec/PowerZure', 'https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a', 'https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/azure-automation-webhook-created.html,Azure Automation Webhook Creatededit,[],[],[],[],Identifies when an Azure Automation webhook is created. Azure Automation runbooks can be configured to execute via a webhook. A webhook uses a custom URL passed to Azure Automation along with a data payload specific to the runbook. An adversary may create a webhook in order to trigger a runbook that contains malicious code.,['query'],"event.dataset:azure.activitylogs andazure.activitylogs.operation_name: (""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION"" or""MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE"" ) andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor', 'https://github.com/hausec/PowerZure', 'https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a', 'https://www.ciraltos.com/webhooks-and-azure-automation-runbooks/']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/azure-blob-container-access-level-modification.html,Azure Blob Container Access Level Modificationedit,"['Discovery', 'Initial Access']","['TA0007', 'TA0001']","['Cloud Service Discovery', 'Exploit Public-Facing Application']","['T1526', 'T1190']","Identifies changes to container access levels in Azure. Anonymous public read access to containers and blobs in Azure is a way to share data broadly, but can present a security risk if access to sensitive data is not managed judiciously.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/azure-blob-permissions-modification.html,Azure Blob Permissions Modificationedit,['Defense Evasion'],['TA0005'],['File and Directory Permissions Modification'],['T1222'],"Identifies when the Azure role-based access control (Azure RBAC) permissions are modified for an Azure Blob. An adversary may modify the permissions on a blob to weaken their targets security controls or an administrator may inadvertently modify the permissions, which could lead to data exposure or loss.",['query'],"event.dataset:azure.activitylogs andazure.activitylogs.operation_name:( ""MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MANAGEOWNERSHIP/ACTION"" or ""MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/BLOBS/MODIFYPERMISSIONS/ACTION"") and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-command-execution-on-virtual-machine.html,Azure Command Execution on Virtual Machineedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],"Identifies command execution on a virtual machine (VM) in Azure. A Virtual Machine Contributor role lets you manage virtual machines, but not access them, nor access the virtual network or storage account theyre connected to. However, commands can be run via PowerShell on the VM, which execute as System. Other roles, such as certain Administrator roles may be able to execute commands on a VM as well.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://adsecurity.org/?p=4277', 'https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a', 'https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-contributor']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/azure-conditional-access-policy-modified.html,Azure Conditional Access Policy Modifiededit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies when an Azure Conditional Access policy is modified. Azure Conditional Access policies control access to resources via if-then statements. For example, if a user wants to access a resource, then they must complete an action such as using multi-factor authentication to access it. An adversary may modify a Conditional Access policy in order to weaken their targets security controls.",['query'],"event.dataset:(azure.activitylogs or azure.auditlogs) and (azure.activitylogs.operation_name:""Update policy"" orazure.auditlogs.operation_name:""Update policy"" ) andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/azure-diagnostic-settings-deletion.html,Azure Diagnostic Settings Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies the deletion of diagnostic settings in Azure, which send platform logs and metrics to different destinations. An adversary may delete diagnostic settings in an attempt to evade defenses.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-settings'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/azure-event-hub-authorization-rule-created-or-updated.html,Azure Event Hub Authorization Rule Created or Updatededit,"['Collection', 'Exfiltration']","['TA0009', 'TA0010']","['Data from Cloud Storage Object', 'Transfer Data to Cloud Account']","['T1530', 'T1537']","Identifies when an Event Hub Authorization Rule is created or updated in Azure. An authorization rule is associated with specific rights, and carries a pair of cryptographic keys. When you create an Event Hubs namespace, a policy rule named RootManageSharedAccessKey is created for the namespace. This has manage permissions for the entire namespace and its recommended that you treat this rule like an administrative root account and dont use it in your application.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/event-hubs/authorize-access-shared-access-signature'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/azure-event-hub-deletion.html,Azure Event Hub Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies an Event Hub deletion in Azure. An Event Hub is an event processing service that ingests and processes large volumes of events and data. An adversary may delete an Event Hub in an attempt to evade detection.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about', 'https://azure.microsoft.com/en-in/services/event-hubs/', 'https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/azure-external-guest-user-invitation.html,Azure External Guest User Invitationedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']","Identifies an invitation to an external user in Azure Active Directory (AD). Azure AD is extended to include collaboration, allowing you to invite people from outside your organization to be guest users in your cloud account. Unless there is a business need to provision guest access, it is best practice avoid creating guest users. Guest users could potentially be overlooked indefinitely leading to a potential vulnerability.",['query'],"event.dataset:azure.auditlogs andazure.auditlogs.operation_name:""Invite external user"" andazure.auditlogs.properties.target_resources.*.display_name:guest andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/governance/policy/samples/cis-azure-1-1-0'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-firewall-policy-deletion.html,Azure Firewall Policy Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of a firewall policy in Azure. An adversary may delete a firewall policy in an attempt to evade defenses and/or to eliminate barriers in carrying out their initiative.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/azure-frontdoor-web-application-firewall-waf-policy-deleted.html,Azure Frontdoor Web Application Firewall (WAF) Policy Deletededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies the deletion of a Frontdoor Web Application Firewall (WAF) Policy in Azure. An adversary may delete a Frontdoor Web Application Firewall (WAF) Policy in an attempt to evade defenses and/or to eliminate barriers in carrying out their initiative.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.NETWORK/FRONTDOORWEBAPPLICATIONFIREWALLPOLICIES/DELETE""and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#networking'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/azure-full-network-packet-capture-detected.html,Azure Full Network Packet Capture Detectededit,['Credential Access'],['TA0006'],['Network Sniffing'],['T1040'],Identifies potential full network packet capture in Azure. Packet Capture is an Azure Network Watcher feature that can be used to inspect network traffic. This feature can potentially be abused to read sensitive data from unencrypted internal traffic.,['query'],"event.dataset:azure.activitylogs andazure.activitylogs.operation_name: (""MICROSOFT.NETWORK/*/STARTPACKETCAPTURE/ACTION"" or""MICROSOFT.NETWORK/*/VPNCONNECTIONS/STARTPACKETCAPTURE/ACTION"" or""MICROSOFT.NETWORK/*/PACKETCAPTURES/WRITE"" ) andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/azure-global-administrator-role-addition-to-pim-user.html,Azure Global Administrator Role Addition to PIM Useredit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies an Azure Active Directory (AD) Global Administrator role addition to a Privileged Identity Management (PIM) user account. PIM is a service that enables you to manage, control, and monitor access to important resources in an organization. Users who are assigned to the Global administrator role can read and modify any administrative setting in your Azure AD organization.",['query'],"event.dataset:azure.auditlogs andazure.auditlogs.properties.category:RoleManagement andazure.auditlogs.operation_name:(""Add eligible member to role in PIMcompleted (permanent)"" or ""Addmember to role in PIM completed (timebound)"") andazure.auditlogs.properties.target_resources.*.display_name:""GlobalAdministrator"" and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-assign-admin-roles'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-key-vault-modified.html,Azure Key Vault Modifiededit,['Credential Access'],['TA0006'],['Unsecured Credentials'],['T1552'],"Identifies modifications to a Key Vault in Azure. The Key Vault is a service that safeguards encryption keys and secrets like certificates, connection strings, and passwords. Because this data is sensitive and business critical, access to key vaults should be secured to allow only authorized applications and users.",['query'],"event.dataset:azure.activitylogs andazure.activitylogs.operation_name:""MICROSOFT.KEYVAULT/VAULTS/WRITE""and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts', 'https://docs.microsoft.com/en-us/azure/key-vault/general/secure-your-key-vault']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Data Protection']"
https://www.elastic.co/guide/en/security/7.16/azure-kubernetes-events-deleted.html,Azure Kubernetes Events Deletededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies when Events are deleted in Azure Kubernetes. Kubernetes events are objects that log any state changes. Example events are a container creation, an image pull, or a pod scheduling on a node.  An adversary may delete events in Azure Kubernetes in an attempt to evade detection.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE""and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/azure-kubernetes-pods-deleted.html,Azure Kubernetes Pods Deletededit,['Impact'],['TA0040'],[],[],Identifies the deletion of Azure Kubernetes Pods. Adversary may delete a kubernetes pod to disrupt the normal behavior of the environment.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Asset Visibility']"
https://www.elastic.co/guide/en/security/7.16/azure-network-watcher-deletion.html,Azure Network Watcher Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies the deletion of a Network Watcher in Azure. Network Watchers are used to monitor, diagnose, view metrics, and enable or disable logs for resources in an Azure virtual network. An adversary may delete a Network Watcher in an attempt to evade defenses.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE"" and event.outcome:(Successor success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/azure-privilege-identity-management-role-modified.html,Azure Privilege Identity Management Role Modifiededit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']","Azure Active Directory (AD) Privileged Identity Management (PIM) is a service that enables you to manage, control, and monitor access to important resources in an organization. PIM can be used to manage the built-in Azure resource roles such as Global Administrator and Application Administrator. An adversary may add a user to a PIM role in order to maintain persistence in their targets environment or modify a PIM role to weaken their targets security controls.",['query'],"event.dataset:azure.auditlogs andazure.auditlogs.operation_name:""Update role setting in PIM"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']","['https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-resource-roles-assign-roles', 'https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-resource-group-deletion.html,Azure Resource Group Deletionedit,"['Impact', 'Defense Evasion']","['TA0040', 'TA0005']","['Data Destruction', 'Impair Defenses']","['T1485', 'T1562']","Identifies the deletion of a resource group in Azure, which includes all resources within the group. Deletion is permanent and irreversible. An adversary may delete a resource group in an attempt to evade defenses or intentionally destroy data.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/azure-service-principal-addition.html,Azure Service Principal Additionedit,['Defense Evasion'],['TA0005'],['Use Alternate Authentication Material'],['T1550'],"Identifies when a new service principal is added in Azure. An application, hosted service, or automated tool that accesses or modifies resources needs an identity created. This identity is known as a service principal. For security reasons, its always recommended to use service principals with automated tools rather than allowing them to log in with a user identity.",['query'],"event.dataset:azure.auditlogs and azure.auditlogs.operation_name:""Addservice principal"" and event.outcome:(success or Success)","['filebeat-*', 'logs-azure*']","['https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/', 'https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal']","['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-service-principal-credentials-added.html,Azure Service Principal Credentials Addededit,['Impact'],['TA0040'],['Resource Hijacking'],['T1496'],"Identifies when new Service Principal credentials have been added in Azure. In most organizations, credentials will be added to service principals infrequently. Hijacking an application (by adding a rogue secret or certificate) with granted permissions will allow the attacker to access data that is normally protected by MFA requirements.",['query'],"event.dataset:azure.auditlogs and azure.auditlogs.operation_name:""Addservice principal credentials."" and event.outcome:(success or Success)","['filebeat-*', 'logs-azure*']",['https://www.fireeye.com/content/dam/collateral/en/wp-m-unc2452.pdf'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-storage-account-key-regenerated.html,Azure Storage Account Key Regeneratededit,['Credential Access'],['TA0006'],['Steal Application Access Token'],['T1528'],Identifies a rotation to storage account access keys in Azure. Regenerating access keys can affect any applications or Azure services that are dependent on the storage account key. Adversaries may regenerate a key as a means of acquiring credentials to access systems and resources.,['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:""MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/azure-virtual-network-device-modified-or-deleted.html,Azure Virtual Network Device Modified or Deletededit,['Impact'],['TA0040'],[],[],"Identifies when a virtual network device is being modified or deleted. This can be a network virtual appliance, virtual hub, or virtual router.",['query'],"event.dataset:azure.activitylogs and azure.activitylogs.operation_name:(""MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE"" or""MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE"" or""MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE"" or""MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION"" or""MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE""or""MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE"" or""MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE"" or""MICROSOFT.NETWORK/VIRTUALHUBS/DELETE"" or""MICROSOFT.NETWORK/VIRTUALHUBS/WRITE"" or""MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE"" or""MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE"") and event.outcome:(Successor success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Network Security']"
https://www.elastic.co/guide/en/security/7.16/base16-or-base32-encoding-decoding-activity.html,Base16 or Base32 Encoding/Decoding Activityedit,['Defense Evasion'],['TA0005'],['Deobfuscate/Decode Files or Information'],['T1140'],Adversaries may encode/decode data in an attempt to evade detection by host- or network-based security controls.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:(base16 or base32 or base32plain or base32hex),"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/bash-shell-profile-modification.html,Bash Shell Profile Modificationedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"Both ~/.bash_profile and ~/.bashrc are files containing shell commands that are run when Bash is invoked. These files are executed in a users context, either interactively or non-interactively, when a user logs in so that their environment is set correctly. Adversaries may abuse this to establish persistence by executing malicious content triggered by a users shell.",['query'],event.category:file and event.type:change and process.name:(* andnot (sudo or vim orzsh or env ornano or bash orTerminal or xpcproxy orlogin or cat orcp or launchctl orjava)) and not process.executable:(/Applications/* or/private/var/folders/* or /usr/local/*) andfile.path:(/private/etc/rc.local or /etc/rc.local or/home/*/.profile or /home/*/.profile1 or/home/*/.bash_profile or /home/*/.bash_profile1 or/home/*/.bashrc or /Users/*/.bash_profile or/Users/*/.zshenv),"['logs-endpoint.events.*', 'auditbeat-*']",['https://www.anomali.com/blog/pulling-linux-rabbit-rabbot-malware-out-of-a-hat'],"['Elastic', 'Host', 'macOS', 'Linux', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/bypass-uac-via-event-viewer.html,Bypass UAC via Event Vieweredit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies User Account Control (UAC) bypass via eventvwr.exe. Attackers bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""eventvwr.exe"" and not process.executable :(""?:\\Windows\\SysWOW64\\mmc.exe"",""?:\\Windows\\System32\\mmc.exe"",""?:\\Windows\\SysWOW64\\WerFault.exe"",""?:\\Windows\\System32\\WerFault.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/clearing-windows-event-logs.html,Clearing Windows Event Logsedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Identifies attempts to clear or disable Windows event log stores using Windows wevetutil command. This is often done by attackers in an attempt to evade detection or destroy forensic evidence on a system.,['eql'],"process where event.type in (""process_started"", ""start"") and(process.name : ""wevtutil.exe"" or process.pe.original_file_name ==""wevtutil.exe"") and process.args : (""/e:false"", ""cl"", ""clear-log"")or process.name : (""powershell.exe"", ""pwsh.exe"",""powershell_ise.exe"") and process.args : ""Clear-EventLog""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/cobalt-strike-command-and-control-beacon.html,Cobalt Strike Command and Control Beaconedit,['Command and Control'],['TA0011'],['Application Layer Protocol'],['T1071'],Cobalt Strike is a threat emulation platform commonly modified and used by adversaries to conduct network attack and exploitation campaigns. This rule detects a network activity algorithm leveraged by Cobalt Strike implant beacons for command and control.,['query'],event.category:(network OR network_traffic) AND type:(tls OR http) ANDnetwork.transport:tcp ANDdestination.domain:/[a-z]{3}.stage.[0-9]{8}\..*/,"['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['https://blog.morphisec.com/fin7-attacks-restaurant-industry', 'https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html']","['Elastic', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/command-execution-via-solarwinds-process.html,Command Execution via SolarWinds Processedit,"['Execution', 'Initial Access']","['TA0002', 'TA0001']","['Command and Scripting Interpreter', 'Supply Chain Compromise']","['T1059', 'T1195']",A suspicious SolarWinds child process (Cmd.exe or Powershell.exe) was detected.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name: (""cmd.exe"", ""powershell.exe"") and process.parent.name: (""ConfigurationWizard*.exe"", ""NetflowDatabaseMaintenance*.exe"",""NetFlowService*.exe"", ""SolarWinds.Administration*.exe"",""SolarWinds.Collector.Service*.exe"", ""SolarwindsDiagnostics*.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html', 'https://github.com/fireeye/sunburst_countermeasures/blob/main/rules/SUNBURST/hxioc/SOLARWINDS%20SUSPICIOUS%20FILEWRITES%20(METHODOLOGY).ioc']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/command-prompt-network-connection.html,Command Prompt Network Connectionedit,"['Execution', 'Command and Control']","['TA0002', 'TA0011']","['Command and Scripting Interpreter', 'Ingress Tool Transfer']","['T1059', 'T1105']",Identifies cmd.exe making a network connection. Adversaries could abuse cmd.exe to download or execute malware from a remote URL.,['eql'],"sequence by process.entity_id [process where process.name :""cmd.exe"" and event.type == ""start""] [network where process.name :""cmd.exe"" and not cidrmatch(destination.ip, ""10.0.0.0/8"",""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"",""192.0.2.0/24"", ""192.31.196.0/24"", ""192.52.193.0/24"",""192.168.0.0/16"", ""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"", ""198.18.0.0/15"",""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"",""FE80::/10"", ""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/command-shell-activity-started-via-rundll32.html,Command Shell Activity Started via RunDLL32edit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],"Identifies command shell activity started via RunDLL32, which is commonly abused by attackers to host malicious code.",['eql'],"process where event.type == ""start"" and process.name : (""cmd.exe"",""powershell.exe"") and process.parent.name : ""rundll32.exe"" andprocess.parent.command_line != null and /* common FPs can be addedhere */ not process.parent.args :(""C:\\Windows\\System32\\SHELL32.dll,RunAsNewUser_RunDLL"",""C:\\WINDOWS\\*.tmp,zzzzInvokeManagedCustomActionOutOfProc"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/component-object-model-hijacking.html,Component Object Model Hijackingedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],Identifies Component Object Model (COM) hijacking via registry modification. Adversaries may establish persistence by executing malicious content triggered by hijacked references to COM objects.,['eql'],"registry where /* uncomment once length is stablelength(bytes_written_string) > 0 and */ (registry.path :""HK*}\\InprocServer32\\"" and registry.data.strings: (""scrobj.dll"",""C:\\*\\scrobj.dll"") and not registry.path :""*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*"") or /* in generalCOM Registry changes on Users Hive is less noisy and worth alerting */(registry.path : (""HKEY_USERS\\*Classes\\*\\InprocServer32\\"",""HKEY_USERS\\*Classes\\*\\LocalServer32\\"",""HKEY_USERS\\*Classes\\*\\DelegateExecute\\"",""HKEY_USERS\\*Classes\\*\\TreatAs\\"",""HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\"") and /* notnecessary but good for filtering privileged installations */user.domain != ""NT AUTHORITY"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/conhost-spawned-by-suspicious-parent-process.html,Conhost Spawned By Suspicious Parent Processedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],"Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""conhost.exe"" and process.parent.name :(""svchost.exe"", ""lsass.exe"", ""services.exe"", ""smss.exe"",""winlogon.exe"", ""explorer.exe"",""dllhost.exe"", ""rundll32.exe"", ""regsvr32.exe"", ""userinit.exe"",""wininit.exe"", ""spoolsv.exe"", ""wermgr.exe"",""csrss.exe"", ""ctfmon.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.fireeye.com/blog/threat-research/2017/08/monitoring-windows-console-activity-part-one.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/connection-to-commonly-abused-free-ssl-certificate-providers.html,Connection to Commonly Abused Free SSL Certificate Providersedit,['Command and Control'],['TA0011'],['Encrypted Channel'],['T1573'],Identifies unusual processes connecting to domains using known free SSL certificates. Adversaries may employ a known encryption algorithm to conceal command and control traffic.,['eql'],"network where network.protocol == ""dns"" and /* Add new free SSLcertificate provider domains here */ dns.question.name :(""*letsencrypt.org"", ""*.sslforfree.com"", ""*.zerossl.com"",""*.freessl.org"") and /* Native Windows process paths that areunlikely to have network connections to domains secured using free SSLcertificates */ process.executable :(""C:\\Windows\\System32\\*.exe"",""C:\\Windows\\System\\*.exe"",""C:\\Windows\\SysWOW64\\*.exe"",""C:\\Windows\\Microsoft.NET\\Framework*\\*.exe"",""C:\\Windows\\explorer.exe"",""C:\\Windows\\notepad.exe"") and /* Insert noisy false positiveshere */ not process.name : (""svchost.exe"", ""MicrosoftEdge*.exe"",""msedge.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/connection-to-commonly-abused-web-services.html,Connection to Commonly Abused Web Servicesedit,"['Command and Control', 'Exfiltration']","['TA0011', 'TA0010']","['Web Service', 'Exfiltration Over Web Service']","['T1102', 'T1567']",Adversaries may implement command and control communications that use common web services in order to hide their activity. This attack technique is typically targeted to an organization and uses web services common to the victim network which allows the adversary to blend into legitimate traffic. activity. These popular services are typically targeted since they have most likely been used before a compromise and allow adversaries to blend in the network.,['eql'],"network where network.protocol == ""dns"" and process.name != nulland user.id not in (""S-1-5-18"", ""S-1-5-19"", ""S-1-5-20"") and /* Addnew WebSvc domains here */ dns.question.name : (""raw.githubusercontent.*"", ""*.pastebin.*"",""*drive.google.*"", ""*docs.live.*"",""*api.dropboxapi.*"", ""*dropboxusercontent.*"",""*onedrive.*"", ""*4shared.*"", ""*.file.io"",""*filebin.net"", ""*slack-files.com"", ""*ghostbin.*"",""*ngrok.*"", ""*portmap.*"", ""*serveo.net"",""*localtunnel.me"", ""*pagekite.me"", ""*localxpose.io"",""*notabug.org"", ""rawcdn.githack.*"",""paste.nrecom.net"", ""zerobin.net"", ""controlc.com"",""requestbin.net"" ) and /* Insert noisy false positives here */not process.executable : ( ""?:\\Program Files\\*.exe"",""?:\\Program Files (x86)\\*.exe"",""?:\\Windows\\System32\\WWAHost.exe"",""?:\\Windows\\System32\\smartscreen.exe"",""?:\\Windows\\System32\\MicrosoftEdgeCP.exe"",""?:\\ProgramData\\Microsoft\\WindowsDefender\\Platform\\*\\MsMpEng.exe"", ""?:\\Users\\*\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe"",""?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe"",""?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe"",""?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe"",""?:\\Windows\\system32\\mobsync.exe"",""?:\\Windows\\SysWOW64\\mobsync.exe"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/connection-to-external-network-via-telnet.html,Connection to External Network via Telnetedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to publicly routable IP addresses.,['eql'],"sequence by process.entity_id [process where process.name ==""telnet"" and event.type == ""start""] [network where process.name ==""telnet"" and not cidrmatch(destination.ip, ""10.0.0.0/8"",""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"",""192.0.2.0/24"", ""192.31.196.0/24"", ""192.52.193.0/24"",""192.168.0.0/16"", ""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"", ""198.18.0.0/15"",""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"",""FE80::/10"", ""FF00::/8"")]","['auditbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/connection-to-internal-network-via-telnet.html,Connection to Internal Network via Telnetedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to non-publicly routable IP addresses.,['eql'],"sequence by process.entity_id [process where process.name ==""telnet"" and event.type == ""start""] [network where process.name ==""telnet"" and cidrmatch(destination.ip, ""10.0.0.0/8"",""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"",""192.0.2.0/24"", ""192.31.196.0/24"", ""192.52.193.0/24"",""192.168.0.0/16"", ""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"", ""198.18.0.0/15"",""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"",""FE80::/10"", ""FF00::/8"")]","['auditbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/control-panel-process-with-unusual-arguments.html,Control Panel Process with Unusual Argumentsedit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies unusual instances of Control Panel with suspicious keywords or paths in the process command line value. Adversaries may abuse Control.exe to proxy execution of malicious code.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.executable : (""?:\\Windows\\SysWOW64\\control.exe"",""?:\\Windows\\System32\\control.exe"") and process.command_line :(""*.jpg*"", ""*.png*"", ""*.gif*"",""*.bmp*"", ""*.jpeg*"", ""*.TIFF*"",""*.inf*"", ""*.dat*"", ""*.cpl:*/*"",""*../../..*"", ""*/AppData/Local/*"",""*:\\Users\\Public\\*"", ""*\\AppData\\Local\\*"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://www.joesandbox.com/analysis/476188/1/html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/creation-of-hidden-files-and-directories.html,Creation of Hidden Files and Directoriesedit,"['Defense Evasion', 'Persistence']","['TA0005', 'TA0003']",['Hide Artifacts'],['T1564'],"Users can mark specific files as hidden simply by putting a ""."" as the first character in the file or folder name. Adversaries can use this to their advantage to hide files and folders on the system for persistence and defense evasion. This rule looks for hidden files or folders in common writable directories.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.working_directory in (""/tmp"", ""/var/tmp"", ""/dev/shm"") andprocess.args regex~ """"""\.[a-z0-9_\-][a-z0-9_\-\.]{1,254}"""""" and notprocess.name in (""ls"", ""find"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/creation-of-hidden-launch-agent-or-daemon.html,Creation of Hidden Launch Agent or Daemonedit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']","['Create or Modify System Process', 'Hide Artifacts']","['T1543', 'T1564']",Identifies the creation of a hidden launch agent or daemon. An adversary may establish persistence by installing a new launch agent or daemon which executes at login.,['eql'],"file where event.type != ""deletion"" and file.path : (""/System/Library/LaunchAgents/.*.plist"",""/Library/LaunchAgents/.*.plist"",""/Users/*/Library/LaunchAgents/.*.plist"",""/System/Library/LaunchDaemons/.*.plist"",""/Library/LaunchDaemons/.*.plist"" )","['auditbeat-*', 'logs-endpoint.events.*']",['https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/creation-of-hidden-login-item-via-apple-script.html,Creation of Hidden Login Item via Apple Scriptedit,"['Persistence', 'Execution']","['TA0003', 'TA0002']","['Boot or Logon Autostart Execution', 'Command and Scripting Interpreter']","['T1547', 'T1059']",Identifies the execution of osascript to create a hidden login item. This may indicate an attempt to persist a malicious program while concealing its presence.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""osascript"" and process.command_line :""osascript*login item*hidden:true*""","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/creation-of-a-hidden-local-user-account.html,Creation of a Hidden Local User Accountedit,['Persistence'],['TA0003'],['Create Account'],['T1136'],Identifies the creation of a hidden local user account by appending the dollar sign to the account name. This is sometimes done by attackers to increase access to a system and avoid appearing in the results of accounts listing using the net users command.,['eql'],"registry where registry.path :""HKLM\\SAM\\SAM\\Domains\\Account\\Users\\Names\\*$\\""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://web.archive.org/web/20230329153858/https://blog.menasec.net/2019/02/threat-hunting-6-hiding-in-plain-sights_8.html', 'https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/tree/master/2020/2020.12.15.Lazarus_Campaign']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/creation-or-modification-of-domain-backup-dpapi-private-key.html,Creation or Modification of Domain Backup DPAPI private keyedit,['Credential Access'],['TA0006'],['Unsecured Credentials'],['T1552'],Identifies the creation or modification of Domain Backup private keys. Adversaries may extract the Data Protection API (DPAPI) domain backup key from a Domain Controller (DC) to be able to decrypt any domain user master key file.,['eql'],"file where event.type != ""deletion"" and file.name :(""ntds_capi_*.pfx"", ""ntds_capi_*.pvk"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/', 'https://www.harmj0y.net/blog/redteaming/operational-guidance-for-offensive-user-dpapi-abuse/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/creation-or-modification-of-root-certificate.html,Creation or Modification of Root Certificateedit,['Defense Evasion'],['TA0005'],['Subvert Trust Controls'],['T1553'],Identifies the creation or modification of a local trusted root certificate in Windows. The install of a malicious root certificate would allow an attacker the ability to masquerade malicious files as valid signed components from any entity (e.g. Microsoft). It could also allow an attacker to decrypt SSL traffic.,['eql'],"registry where event.type in (""creation"", ""change"") andregistry.path : ( ""HKLM\\Software\\Microsoft\\SystemCertificates\\Root\\Certificates\\*\\Blob"", ""HKLM\\Software\\Microsoft\\SystemCertificates\\AuthRoot\\Certificates\\*\\Blob"", ""HKLM\\Software\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates\\*\\Blob"", ""HKLM\\Software\\Policies\\Microsoft\\SystemCertificates\\AuthRoot\\Certificates\\*\\Blob"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec', 'https://www.ired.team/offensive-security/persistence/t1130-install-root-certificate']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/creation-or-modification-of-a-new-gpo-scheduled-task-or-service.html,Creation or Modification of a new GPO Scheduled Task or Serviceedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],"Detects the creation or modification of a new Group Policy based scheduled task or service. These methods are used for legitimate system administration, but can also be abused by an attacker with domain admin permissions to execute a malicious payload remotely on all or a subset of the domain joined machines.",['eql'],"file where event.type != ""deletion"" and file.path : (""?:\\Windows\\SYSVOL\\domain\\Policies\\*\\MACHINE\\Preferences\\ScheduledTasks\\ScheduledTasks.xml"", ""?:\\Windows\\SYSVOL\\domain\\Policies\\*\\MACHINE\\Preferences\\Preferences\\Services\\Services.xml"") andnot process.name : ""dfsrs.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/credential-acquisition-via-registry-hive-dumping.html,Credential Acquisition via Registry Hive Dumpingedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies attempts to export a registry hive which may contain credentials using the Windows reg.exe tool.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.pe.original_file_name == ""reg.exe"" and process.args :(""save"", ""export"") and process.args : (""hklm\\sam"", ""hklm\\security"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://medium.com/threatpunter/detecting-attempts-to-steal-passwords-from-the-registry-7512674487f8'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/credential-dumping-detected-elastic-endgame.html,Credential Dumping - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected Credential Dumping. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and (event.action:cred_theft_event orendgame.event_subtype_full:cred_theft_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/credential-dumping-prevented-elastic-endgame.html,Credential Dumping - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented Credential Dumping. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and (event.action:cred_theft_event orendgame.event_subtype_full:cred_theft_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/credential-manipulation-detected-elastic-endgame.html,Credential Manipulation - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected Credential Manipulation. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and(event.action:token_manipulation_event orendgame.event_subtype_full:token_manipulation_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/credential-manipulation-prevented-elastic-endgame.html,Credential Manipulation - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented Credential Manipulation. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and(event.action:token_manipulation_event orendgame.event_subtype_full:token_manipulation_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/cyberark-privileged-access-security-error.html,CyberArk Privileged Access Security Erroredit,"['Privilege Escalation', 'Initial Access']","['TA0004', 'TA0001']",['Valid Accounts'],['T1078'],Identifies the occurrence of a CyberArk Privileged Access Security (PAS) error level audit event. The event.code correlates to the CyberArk Vault Audit Action Code.,['query'],event.dataset:cyberarkpas.audit and event.type:error,"['filebeat-*', 'logs-cyberarkpas.audit*']",['https://docs.cyberark.com/Product-Doc/OnlineHelp/PAS/Latest/en/Content/PASREF/Vault%20Audit%20Action%20Codes.htm?tocpath=Administration%7CReferences%7C'],"['Elastic', 'cyberarkpas', 'SecOps', 'Log Auditing', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/cyberark-privileged-access-security-recommended-monitor.html,CyberArk Privileged Access Security Recommended Monitoredit,"['Privilege Escalation', 'Initial Access']","['TA0004', 'TA0001']",['Valid Accounts'],['T1078'],Identifies the occurrence of a CyberArk Privileged Access Security (PAS) non-error level audit event which is recommended for monitoring by the vendor. The event.code correlates to the CyberArk Vault Audit Action Code.,['query'],event.dataset:cyberarkpas.audit and event.code:(4 or 22 or 24 or 31or 38 or 57 or 60 or 130 or 295 or 300 or 302 or 308 or319 or 344 or 346 or 359 or 361 or 378 or 380 or 411) and notevent.type:error,"['filebeat-*', 'logs-cyberarkpas.audit*']",['https://docs.cyberark.com/Product-Doc/OnlineHelp/PAS/Latest/en/Content/PASREF/Vault%20Audit%20Action%20Codes.htm?tocpath=Administration%7CReferences%7C'],"['Elastic', 'cyberarkpas', 'SecOps', 'Log Auditing', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/dns-activity-to-the-internet.html,DNS Activity to the Internetedit,['Command and Control'],['TA0011'],[],[],"This rule detects when an internal network client sends DNS traffic directly to the Internet. This is atypical behavior for a managed network and can be indicative of malware, exfiltration, command and control, or simply misconfiguration. This DNS activity also impacts your organizations ability to provide enterprise monitoring and logging of DNS, and it opens your network to a variety of abuses and malicious communications.",['query'],"event.category:(network or network_traffic) and (event.type:connectionor type:dns) and (destination.port:53 or event.dataset:zeek.dns) andsource.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or ""::1""or ""FE80::/10"" or ""FF00::/8"" )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['https://www.us-cert.gov/ncas/alerts/TA15-240A', 'https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-81-2.pdf', 'https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml']","['Elastic', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/dns-tunneling.html,DNS Tunnelingedit,[],[],[],[],"A machine learning job detected unusually large numbers of DNS queries for a single top-level DNS domain, which is often used for DNS tunneling. DNS tunneling can be used for command-and-control, persistence, or data exfiltration activity. For example, dnscat tends to generate many DNS questions for a top-level domain as it uses the DNS protocol to tunnel data.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/dns-over-https-enabled-via-registry.html,DNS-over-HTTPS Enabled via Registryedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies when a user enables DNS-over-HTTPS. This can be used to hide internet activity or be used to hide the process of exfiltrating data. With this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors.",['eql'],"registry where event.type in (""creation"", ""change"") and(registry.path :""*\\SOFTWARE\\Policies\\Microsoft\\Edge\\BuiltInDnsClientEnabled"" andregistry.data.strings : ""1"") or (registry.path :""*\\SOFTWARE\\Google\\Chrome\\DnsOverHttpsMode"" andregistry.data.strings : ""secure"") or (registry.path :""*\\SOFTWARE\\Policies\\Mozilla\\Firefox\\DNSOverHTTPS"" andregistry.data.strings : ""1"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.tenforums.com/tutorials/151318-how-enable-disable-dns-over-https-doh-microsoft-edge.html', 'https://chromeenterprise.google/policies/?policy=DnsOverHttpsMode']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/default-cobalt-strike-team-server-certificate.html,Default Cobalt Strike Team Server Certificateedit,['Command and Control'],['TA0011'],['Application Layer Protocol'],['T1071'],This rule detects the use of the default Cobalt Strike Team Server TLS certificate. Cobalt Strike is software for Adversary Simulations and Red Team Operations which are security assessments that replicate the tactics and techniques of an advanced adversary in a network. Modifications to the Packetbeat configuration can be made to include MD5 and SHA256 hashing algorithms (the default is SHA1). See the References section for additional information on module configuration.,['query'],event.category:(network or network_traffic) and(tls.server.hash.md5:950098276A495286EB2A2556FBAB6D83 ortls.server.hash.sha1:6ECE5ECE4192683D2D84E25B0BA7E04F9CB7EB7C or tls.server.hash.sha256:87F2085C32B6A2CC709B365F55873E207A9CAA10BFFECF2FD16D3CF9D94D390C),"['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['https://attack.mitre.org/software/S0154/', 'https://www.cobaltstrike.com/help-setup-collaboration', '/guide/en/beats/packetbeat/current/configuration-tls.html', '/guide/en/beats/filebeat/7.9/filebeat-module-suricata.html', '/guide/en/beats/filebeat/7.9/filebeat-module-zeek.html']","['Command and Control', 'Post-Execution', 'Threat Detection', 'Elastic', 'Network', 'Host']"
https://www.elastic.co/guide/en/security/7.16/delete-volume-usn-journal-with-fsutil.html,Delete Volume USN Journal with Fsutiledit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Identifies use of the fsutil.exe to delete the volume USNJRNL. This technique is used by attackers to eliminate evidence of files created during post-exploitation activities.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""fsutil.exe"" or process.pe.original_file_name ==""fsutil.exe"") and process.args : ""deletejournal"" and process.args :""usn""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/deleting-backup-catalogs-with-wbadmin.html,Deleting Backup Catalogs with Wbadminedit,['Impact'],['TA0040'],['Inhibit System Recovery'],['T1490'],Identifies use of the wbadmin.exe to delete the backup catalog. Ransomware and other malware may do this to prevent system recovery.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""wbadmin.exe"" or process.pe.original_file_name ==""WBADMIN.EXE"") and process.args : ""catalog"" and process.args :""delete""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/direct-outbound-smb-connection.html,Direct Outbound SMB Connectionedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies unexpected processes making network connections over port 445. Windows File Sharing is typically implemented over Server Message Block (SMB), which communicates between hosts using port 445. When legitimate, these network connections are established by the kernel. Processes making 445/tcp connections may be port scanners, exploits, or suspicious user-level processes moving laterally.",['eql'],"sequence by process.entity_id [process where event.type == ""start""and process.pid != 4] [network where destination.port == 445 andprocess.pid != 4 and not cidrmatch(destination.ip, ""127.0.0.1"",""::1"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/disable-windows-event-and-security-logs-using-built-in-tools.html,Disable Windows Event and Security Logs Using Built-in Toolsedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],"Identifies attempts to disable EventLog via the logman Windows utility, PowerShell, or auditpol. This is often done by attackers in an attempt to evade detection on a system.",['eql'],"process where event.type in (""start"", ""process_started"") and((process.name:""logman.exe"" or process.pe.original_file_name ==""Logman.exe"") and process.args : ""EventLog-*"" and process.args :(""stop"", ""delete"")) or ((process.name : (""pwsh.exe"",""powershell.exe"", ""powershell_ise.exe"") orprocess.pe.original_file_name in (""pwsh.exe"", ""powershell.exe"",""powershell_ise.exe"")) and process.args : ""Set-Service"" andprocess.args: ""EventLog"" and process.args : ""Disabled"") or((process.name:""auditpol.exe"" or process.pe.original_file_name ==""AUDITPOL.EXE"") and process.args : ""/success:disable"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/logman'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/disable-windows-firewall-rules-via-netsh.html,Disable Windows Firewall Rules via Netshedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies use of the netsh.exe to disable or weaken the local firewall. Attackers will use this command line tool to disable the firewall during troubleshooting or to enable network mobility.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""netsh.exe"" and (process.args : ""disable"" andprocess.args : ""firewall"" and process.args : ""set"") or (process.args: ""advfirewall"" and process.args : ""off"" and process.args : ""state"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/disabling-user-account-control-via-registry-modification.html,Disabling User Account Control via Registry Modificationedit,"['Privilege Escalation', 'Defense Evasion']","['TA0004', 'TA0005']","['Abuse Elevation Control Mechanism', 'Abuse Elevation Control Mechanism']","['T1548', 'T1548']","User Account Control (UAC) can help mitigate the impact of malware on Windows hosts. With UAC, apps and tasks always run in the security context of a non-administrator account, unless an administrator specifically authorizes administrator-level access to the system. This rule identifies registry value changes to bypass User Access Control (UAC) protection.",['eql'],"registry where event.type == ""change"" and registry.path : (""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA"", ""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ConsentPromptBehaviorAdmin"", ""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecureDesktop"" ) and registry.data.strings : ""0""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.greyhathacker.net/?p=796', 'https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings', 'https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-overview']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/disabling-windows-defender-security-settings-via-powershell.html,Disabling Windows Defender Security Settings via PowerShelledit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies use of the Set-MpPreference PowerShell command to disable or weaken certain Windows Defender settings.,['eql'],"process where event.type == ""start"" and (process.name :(""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"") orprocess.pe.original_file_name in (""powershell.exe"", ""pwsh.dll"",""powershell_ise.exe"")) and process.args : ""Set-MpPreference"" andprocess.args : (""-Disable*"", ""Disabled"", ""NeverSend"", ""-Exclusion*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2019-ps'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/domain-added-to-google-workspace-trusted-domains.html,Domain Added to Google Workspace Trusted Domainsedit,[],[],[],[],Detects when a domain is added to the list of trusted Google Workspace domains. An adversary may add a trusted domain in order to collect and exfiltrate data from their targets organization with less restrictive security controls.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:ADD_TRUSTED_DOMAINS,"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/6160020?hl=en'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/dumping-account-hashes-via-built-in-commands.html,Dumping Account Hashes via Built-In Commandsedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies the execution of macOS built-in commands used to dump user account hashes. Adversaries may attempt to dump credentials to obtain account login information in the form of a hash. These hashes can be cracked or leveraged for lateral movement.,['query'],"event.category:process and event.type:start andprocess.name:(defaults or mkpassdb) and process.args:(ShadowHashDataor ""-dump"")","['auditbeat-*', 'logs-endpoint.events.*']","['https://apple.stackexchange.com/questions/186893/os-x-10-9-where-are-password-hashes-stored', 'https://www.unix.com/man-page/osx/8/mkpassdb/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/dumping-of-keychain-content-via-security-command.html,Dumping of Keychain Content via Security Commandedit,['Credential Access'],['TA0006'],['Credentials from Password Stores'],['T1555'],"Adversaries may dump the content of the keychain storage data from a system to acquire credentials. Keychains are the built-in way for macOS to keep track of users' passwords and credentials for many services and features, including Wi-Fi and website passwords, secure notes, certificates, and Kerberos.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.args : ""dump-keychain"" and process.args : ""-d""","['auditbeat-*', 'logs-endpoint.events.*']",['https://ss64.com/osx/security.html'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/eggshell-backdoor-execution.html,EggShell Backdoor Executionedit,[],[],[],[],Identifies the execution of and EggShell Backdoor. EggShell is a known post exploitation tool for macOS and Linux.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:espl and process.args:eyJkZWJ1ZyI6*,"['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/neoneggplant/EggShell'],"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/emond-rules-creation-or-modification.html,Emond Rules Creation or Modificationedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"Identifies the creation or modification of the Event Monitor Daemon (emond) rules. Adversaries may abuse this service by writing a rule to execute commands when a defined event occurs, such as system start up or user authentication.",['eql'],"file where event.type != ""deletion"" and file.path :(""/private/etc/emond.d/rules/*.plist"", ""/etc/emon.d/rules/*.plist"")","['auditbeat-*', 'logs-endpoint.events.*']",['https://www.xorrior.com/emond-persistence/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/enable-host-network-discovery-via-netsh.html,Enable Host Network Discovery via Netshedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies use of the netsh.exe program to enable host discovery via the network. Attackers can use this command-line tool to weaken the host firewall settings.,['eql'],"process where event.type == ""start"" and process.name : ""netsh.exe"" andprocess.args : (""firewall"", ""advfirewall"") and process.args :""group=Network Discovery"" and process.args : ""enable=Yes""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/encoded-executable-stored-in-the-registry.html,Encoded Executable Stored in the Registryedit,['Defense Evasion'],['TA0005'],['Deobfuscate/Decode Files or Information'],['T1140'],Identifies registry write modifications to hide an encoded portable executable. This could be indicative of adversary defense evasion by avoiding the storing of malicious content directly on disk.,['eql'],"registry where /* update here with encoding combinations */registry.data.strings : ""TVqQAAMAAAAEAAAA*""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/encrypting-files-with-winrar-or-7z.html,Encrypting Files with WinRar or 7zedit,['Collection'],['TA0009'],['Archive Collected Data'],['T1560'],Identifies use of WinRar or 7z to create an encrypted files. Adversaries will often compress and encrypt data in preparation for exfiltration.,['eql'],"process where event.type in (""start"", ""process_started"") and((process.name:""rar.exe"" or process.code_signature.subject_name ==""win.rar GmbH"" or process.pe.original_file_name == ""Command lineRAR"") and process.args == ""a"" and process.args : (""-hp*"", ""-p*"",""-dw"", ""-tb"", ""-ta"", ""/hp*"", ""/p*"", ""/dw"", ""/tb"", ""/ta"")) or(process.pe.original_file_name in (""7z.exe"", ""7za.exe"") andprocess.args == ""a"" and process.args : (""-p*"", ""-sdel"")) /*uncomment if noisy for backup software related FPs */ /* notprocess.parent.executable : (""C:\\Program Files\\*.exe"", ""C:\\ProgramFiles (x86)\\*.exe"") */","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://www.welivesecurity.com/2020/12/02/turla-crutch-keeping-back-door-open/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Collection']"
https://www.elastic.co/guide/en/security/7.16/endpoint-security.html,Endpoint Securityedit,[],[],[],[],Generates a detection alert each time an Elastic Endpoint Security alert is received. Enabling this rule allows you to immediately begin investigating your Endpoint alerts.,['query'],event.kind:alert and event.module:(endpoint and not endgame),['logs-endpoint.alerts-*'],N/A,"['Elastic', 'Endpoint Security']"
https://www.elastic.co/guide/en/security/7.16/enumeration-command-spawned-via-wmiprvse.html,Enumeration Command Spawned via WMIPrvSEedit,"['Execution', 'Discovery']","['TA0002', 'TA0007']","['Windows Management Instrumentation', 'Software Discovery']","['T1047', 'T1518']",Identifies native Windows host and network enumeration commands spawned by the Windows Management Instrumentation Provider Service (WMIPrvSE).,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name: ( ""arp.exe"", ""dsquery.exe"", ""dsget.exe"",""gpresult.exe"", ""hostname.exe"", ""ipconfig.exe"",""nbtstat.exe"", ""net.exe"", ""net1.exe"", ""netsh.exe"",""netstat.exe"", ""nltest.exe"", ""ping.exe"", ""qprocess.exe"",""quser.exe"", ""qwinsta.exe"", ""reg.exe"", ""sc.exe"",""systeminfo.exe"", ""tasklist.exe"", ""tracert.exe"",""whoami.exe"" ) and process.parent.name:""wmiprvse.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/enumeration-of-administrator-accounts.html,Enumeration of Administrator Accountsedit,['Discovery'],['TA0007'],['Permission Groups Discovery'],['T1069'],Identifies instances of lower privilege accounts enumerating Administrator accounts or groups using built-in Windows tools.,['eql'],"process where event.type in (""start"", ""process_started"") and(((process.name : ""net.exe"" or process.pe.original_file_name ==""net.exe"") or ((process.name : ""net1.exe"" orprocess.pe.original_file_name == ""net1.exe"") and notprocess.parent.name : ""net.exe"")) and process.args : (""group"",""user"", ""localgroup"") and process.args : (""admin"", ""Domain Admins"",""Remote Desktop Users"", ""Enterprise Admins"", ""OrganizationManagement"") and not process.args : ""/add"") or((process.name : ""wmic.exe"" or process.pe.original_file_name ==""wmic.exe"") and process.args : (""group"", ""useraccount""))","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/enumeration-of-kernel-modules.html,Enumeration of Kernel Modulesedit,['Discovery'],['TA0007'],['System Information Discovery'],['T1082'],Loadable Kernel Modules (or LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This identifies attempts to enumerate information about a kernel module.,['query'],event.category:process and event.type:(start or process_started) andprocess.args:(kmod and list and sudo or sudo and (depmod or lsmod ormodinfo)),"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/enumeration-of-users-or-groups-via-built-in-commands.html,Enumeration of Users or Groups via Built-in Commandsedit,['Discovery'],['TA0007'],['Permission Groups Discovery'],['T1069'],Identifies the execution of macOS built-in commands related to account or group enumeration.,['eql'],"process where event.type in (""start"", ""process_started"") and notprocess.parent.executable :(""/Applications/NoMAD.app/Contents/MacOS/NoMAD"",""/Applications/ZoomPresence.app/Contents/MacOS/ZoomPresence"",""/Applications/Sourcetree.app/Contents/MacOS/Sourcetree"",""/Library/Application Support/JAMF/Jamf.app/Contents/MacOS/JamfDaemon.app/Contents/MacOS/JamfDaemon"", ""/usr/local/jamf/bin/jamf"" )and process.name : (""ldapsearch"", ""dsmemberutil"") or(process.name : ""dscl"" and process.args : (""read"", ""-read"",""list"", ""-list"", ""ls"", ""search"", ""-search"") and process.args :(""/Active Directory/*"", ""/Users*"", ""/Groups*""))","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/executable-file-creation-with-multiple-extensions.html,Executable File Creation with Multiple Extensionsedit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']","['Masquerading', 'User Execution']","['T1036', 'T1204']",Masquerading can allow an adversary to evade defenses and better blend in with the environment. One way it occurs is when the name or location of a file is manipulated as a means of tricking a user into executing what they think is a benign file type but is actually executable code.,['eql'],"file where event.type == ""creation"" and file.extension : ""exe"" andfile.name regex~ """""".*\.(vbs|vbe|bat|js|cmd|wsh|ps1|pdf|docx?|xlsx?|pptx?|txt|rtf|gif|jpg|png|bmp|hta|txt|img|iso)\.exe""""""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/execution-from-unusual-directory-command-line.html,Execution from Unusual Directory - Command Lineedit,[],[],[],[],Identifies process execution from suspicious default Windows directories. This may be abused by adversaries to hide malware in trusted paths.,['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.name : (""wscript.exe"", ""cscript.exe"",""rundll32.exe"", ""regsvr32.exe"",""cmstp.exe"", ""RegAsm.exe"",""installutil.exe"", ""mshta.exe"",""RegSvcs.exe"", ""powershell.exe"",""pwsh.exe"", ""cmd.exe"") and /*add suspicious execution paths here */ process.args :(""C:\\PerfLogs\\*"", ""C:\\Users\\Public\\*"",""C:\\Users\\Default\\*"", ""C:\\Windows\\Tasks\\*"",""C:\\Intel\\*"", ""C:\\AMD\\Temp\\*"",""C:\\Windows\\AppReadiness\\*"",""C:\\Windows\\ServiceState\\*"",""C:\\Windows\\security\\*"",""C:\\Windows\\IdentityCRL\\*"",""C:\\Windows\\Branding\\*"", ""C:\\Windows\\csc\\*"",""C:\\Windows\\DigitalLocker\\*"", ""C:\\Windows\\en-US\\*"", ""C:\\Windows\\wlansvc\\*"",""C:\\Windows\\Prefetch\\*"", ""C:\\Windows\\Fonts\\*"",""C:\\Windows\\diagnostics\\*"",""C:\\Windows\\TAPI\\*"", ""C:\\Windows\\INF\\*"",""C:\\Windows\\System32\\Speech\\*"",""C:\\windows\\tracing\\*"", ""c:\\windows\\IME\\*"",""c:\\Windows\\Performance\\*"",""c:\\windows\\intel\\*"", ""c:\\windows\\ms\\*"",""C:\\Windows\\dot3svc\\*"",""C:\\Windows\\ServiceProfiles\\*"",""C:\\Windows\\panther\\*"",""C:\\Windows\\RemotePackages\\*"",""C:\\Windows\\OCR\\*"", ""C:\\Windows\\appcompat\\*"",""C:\\Windows\\apppatch\\*"",""C:\\Windows\\addins\\*"", ""C:\\Windows\\Setup\\*"",""C:\\Windows\\Help\\*"", ""C:\\Windows\\SKB\\*"",""C:\\Windows\\Vss\\*"", ""C:\\Windows\\Web\\*"",""C:\\Windows\\servicing\\*"",""C:\\Windows\\CbsTemp\\*"", ""C:\\Windows\\Logs\\*"",""C:\\Windows\\WaaS\\*"", ""C:\\Windows\\twain_32\\*"",""C:\\Windows\\ShellExperiences\\*"",""C:\\Windows\\ShellComponents\\*"",""C:\\Windows\\PLA\\*"", ""C:\\Windows\\Migration\\*"",""C:\\Windows\\debug\\*"", ""C:\\Windows\\Cursors\\*"",""C:\\Windows\\Containers\\*"",""C:\\Windows\\Boot\\*"", ""C:\\Windows\\bcastdvr\\*"",""C:\\Windows\\assembly\\*"",""C:\\Windows\\TextInput\\*"",""C:\\Windows\\security\\*"",""C:\\Windows\\schemas\\*"",""C:\\Windows\\SchCache\\*"",""C:\\Windows\\Resources\\*"",""C:\\Windows\\rescache\\*"",""C:\\Windows\\Provisioning\\*"",""C:\\Windows\\PrintDialog\\*"",""C:\\Windows\\PolicyDefinitions\\*"",""C:\\Windows\\media\\*"",""C:\\Windows\\Globalization\\*"",""C:\\Windows\\L2Schemas\\*"",""C:\\Windows\\LiveKernelReports\\*"",""C:\\Windows\\ModemLogs\\*"",""C:\\Windows\\ImmersiveControlPanel\\*"",""C:\\$Recycle.Bin\\*"") and not process.parent.executable : (""C:\\WINDOWS\\System32\\DriverStore\\FileRepository\\*\\igfxCUIService*.exe"",""C:\\Windows\\System32\\spacedeskService.exe"",""C:\\Program Files\\Dell\\SupportAssistAgent\\SRE\\SRE.exe"") and not(process.name : ""rundll32.exe"" and process.args : (""uxtheme.dll,#64"",""PRINTUI.DLL,PrintUIEntry""))","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-of-com-object-via-xwizard.html,Execution of COM object via Xwizardedit,['Execution'],['TA0002'],['Inter-Process Communication'],['T1559'],Windows Component Object Model (COM) is an inter-process communication (IPC) component of the native Windows application programming interface (API) that enables interaction between software objects or executable code. Xwizard can be used to run a COM object created in registry to evade defensive counter measures.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.pe.original_file_name : ""xwizard.exe"" and ( (process.args: ""RunWizard"" and process.args : ""{*}"") or (process.executable !=null and not process.executable :(""C:\\Windows\\SysWOW64\\xwizard.exe"",""C:\\Windows\\System32\\xwizard.exe"") ) )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://lolbas-project.github.io/lolbas/Binaries/Xwizard/', 'http://www.hexacorn.com/blog/2017/07/31/the-wizard-of-x-oppa-plugx-style/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-of-file-written-or-modified-by-microsoft-office.html,Execution of File Written or Modified by Microsoft Officeedit,"['Execution', 'Initial Access']","['TA0002', 'TA0001']",['Phishing'],['T1566'],Identifies an executable created by a Microsoft Office application and subsequently executed. These processes are often launched via scripts inside documents or during exploitation of Microsoft Office applications.,['eql'],"sequence with maxspan=2h [file where event.type != ""deletion"" andfile.extension : ""exe"" and (process.name : ""WINWORD.EXE"" orprocess.name : ""EXCEL.EXE"" or process.name : ""OUTLOOK.EXE"" orprocess.name : ""POWERPNT.EXE"" or process.name : ""eqnedt32.exe""or process.name : ""fltldr.exe"" or process.name :""MSPUB.EXE"" or process.name : ""MSACCESS.EXE"") ] by host.id,file.path [process where event.type in (""start"", ""process_started"")]by host.id, process.executable","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-of-file-written-or-modified-by-pdf-reader.html,Execution of File Written or Modified by PDF Readeredit,"['Execution', 'Initial Access']","['TA0002', 'TA0001']",['Phishing'],['T1566'],Identifies a suspicious file that was written by a PDF reader application and subsequently executed. These processes are often launched via exploitation of PDF applications.,['eql'],"sequence with maxspan=2h [file where event.type != ""deletion"" andfile.extension : ""exe"" and (process.name : ""AcroRd32.exe"" orprocess.name : ""rdrcef.exe"" or process.name :""FoxitPhantomPDF.exe"" or process.name : ""FoxitReader.exe"") andnot (file.name : ""FoxitPhantomPDF.exe"" or file.name :""FoxitPhantomPDFUpdater.exe"" or file.name :""FoxitReader.exe"" or file.name : ""FoxitReaderUpdater.exe"" orfile.name : ""AcroRd32.exe"" or file.name : ""rdrcef.exe"") ]by host.id, file.path [process where event.type in (""start"",""process_started"")] by host.id, process.executable","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-of-persistent-suspicious-program.html,Execution of Persistent Suspicious Programedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],"Identifies execution of suspicious persistent programs (scripts, rundll32, etc.) by looking at process lineage and command line usage.",['eql'],"/* userinit followed by explorer followed by early child process ofexplorer (unlikely to be launched interactively) within 1m */ sequenceby host.id, user.name with maxspan=1m [process where event.type in(""start"", ""process_started"") and process.name : ""userinit.exe"" andprocess.parent.name : ""winlogon.exe""] [process where event.type in(""start"", ""process_started"") and process.name : ""explorer.exe""][process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""explorer.exe"" and /* add suspicious programshere */ process.pe.original_file_name in (""cscript.exe"",""wscript.exe"", ""PowerShell.EXE"",""MSHTA.EXE"", ""RUNDLL32.EXE"",""REGSVR32.EXE"", ""RegAsm.exe"",""MSBuild.exe"", ""InstallUtil.exe"")and /* add potential suspicious paths here */ process.args :(""C:\\Users\\*"", ""C:\\ProgramData\\*"", ""C:\\Windows\\Temp\\*"",""C:\\Windows\\Tasks\\*"", ""C:\\PerfLogs\\*"", ""C:\\Intel\\*"") ]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/execution-via-electron-child-process-node.js-module.html,Execution via Electron Child Process Node.js Moduleedit,"['Execution', 'Defense Evasion']","['TA0002', 'TA0005']","['Command and Scripting Interpreter', 'Abuse Elevation Control Mechanism']","['T1059', 'T1548']",Identifies attempts to execute a child process from within the context of an Electron application using the child_process Node.js module. Adversaries may abuse this technique to inherit permissions from parent processes.,['query'],"event.category:process and event.type:(start or process_started) andprocess.args:(""-e"" and const*require*child_process*)","['auditbeat-*', 'logs-endpoint.events.*']","['https://www.matthewslipper.com/2019/09/22/everything-you-wanted-electron-child-process.html', 'https://www.trustedsec.com/blog/macos-injection-via-third-party-frameworks/', 'https://nodejs.org/api/child_process.html']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-via-mssql-xp_cmdshell-stored-procedure.html,Execution via MSSQL xp_cmdshell Stored Procedureedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],"Identifies execution via MSSQL xp_cmdshell stored procedure. Malicious users may attempt to elevate their privileges by using xp_cmdshell, which is disabled by default, thus, its important to review the context of its use.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""cmd.exe"" and process.parent.name : ""sqlservr.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-via-tsclient-mountpoint.html,Execution via TSClient Mountpointedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies execution from the Remote Desktop Protocol (RDP) shared mountpoint tsclient on the target host. This may indicate a lateral movement attempt.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.executable : ""\\Device\\Mup\\tsclient\\*.exe""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://posts.specterops.io/revisiting-remote-desktop-lateral-movement-8fb905cb46c3'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/execution-via-local-sxs-shared-module.html,Execution via local SxS Shared Moduleedit,['Execution'],['TA0002'],['Shared Modules'],['T1129'],"Identifies the creation, change, or deletion of a DLL module within a Windows SxS local folder. Adversaries may abuse shared modules to execute malicious payloads by instructing the Windows module loader to load DLLs from arbitrary local paths.",['eql'],"file where file.extension : ""dll"" and file.path :""C:\\*\\*.exe.local\\*.dll""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-redirection'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/execution-with-explicit-credentials-via-scripting.html,Execution with Explicit Credentials via Scriptingedit,"['Privilege Escalation', 'Execution']","['TA0004', 'TA0002']","['Valid Accounts', 'Command and Scripting Interpreter']","['T1078', 'T1059']","Identifies execution of the security_authtrampoline process via a scripting interpreter. This occurs when programs use AuthorizationExecute-WithPrivileges from the Security.framework to run another program with root privileges. It should not be run by itself, as this is a sign of execution with explicit logon credentials.",['query'],"event.category:process and event.type:(start or process_started) andprocess.name:""security_authtrampoline"" andprocess.parent.name:(osascript or com.apple.automator.runner or sh orbash or dash or zsh or python* or perl* or php* or ruby or pwsh)","['auditbeat-*', 'logs-endpoint.events.*']","['https://objectivebythesea.com/v2/talks/OBTS_v2_Thomas.pdf', 'https://www.manpagez.com/man/8/security_authtrampoline/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Execution', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/exploit-detected-elastic-endgame.html,Exploit - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected an Exploit. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and (event.action:exploit_event orendgame.event_subtype_full:exploit_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/exploit-prevented-elastic-endgame.html,Exploit - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented an Exploit. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and (event.action:exploit_event orendgame.event_subtype_full:exploit_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/exporting-exchange-mailbox-via-powershell.html,Exporting Exchange Mailbox via PowerShelledit,['Collection'],['TA0009'],['Email Collection'],['T1114'],"Identifies the use of the Exchange PowerShell cmdlet, New-MailBoxExportRequest, to export the contents of a primary mailbox or archive to a .pst file. Adversaries may target user email to collect sensitive information.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name: (""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"") andprocess.args : ""New-MailboxExportRequest*""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/', 'https://docs.microsoft.com/en-us/powershell/module/exchange/new-mailboxexportrequest?view=exchange-ps']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Collection']"
https://www.elastic.co/guide/en/security/7.16/external-alerts.html,External Alertsedit,[],[],[],[],Generates a detection alert for each external alert written to the configured indices. Enabling this rule allows you to immediately begin investigating external alerts in the app.,['query'],event.kind:alert and not event.module:(endgame or endpoint),"['apm--transaction', 'traces-apm*', 'auditbeat-*', 'filebeat-*', 'logs-*', 'packetbeat-*', 'winlogbeat-*']",N/A,"['Elastic', 'Network', 'Windows', 'APM', 'macOS', 'Linux']"
https://www.elastic.co/guide/en/security/7.16/external-ip-lookup-from-non-browser-process.html,External IP Lookup from Non-Browser Processedit,['Discovery'],['TA0007'],['System Network Configuration Discovery'],['T1016'],"Identifies domains commonly used by adversaries for post-exploitation IP lookups. It is common for adversaries to test for Internet access and acquire their external IP address after they have gained access to a system. Among others, this has been observed in campaigns leveraging the information stealer, Trickbot.",['eql'],"network where network.protocol == ""dns"" and process.name != nulland user.id not in (""S-1-5-19"", ""S-1-5-20"") and event.action ==""lookup_requested"" and /* Add new external IP lookup services here*/ dns.question.name : ( ""*api.ipify.org"",""*freegeoip.app"", ""*checkip.amazonaws.com"",""*checkip.dyndns.org"", ""*freegeoip.app"",""*icanhazip.com"", ""*ifconfig.*"", ""*ipecho.net"",""*ipgeoapi.com"", ""*ipinfo.io"", ""*ip.anysrc.net"",""*myexternalip.com"", ""*myipaddress.com"",""*showipaddress.com"", ""*whatismyipaddress.com"",""*wtfismyip.com"", ""*ipapi.co"", ""*ip-lookup.net"",""*ipstack.com"" ) and /* Insert noisy false positives here */not process.executable : ( ""?:\\Program Files\\*.exe"",""?:\\Program Files (x86)\\*.exe"",""?:\\Windows\\System32\\WWAHost.exe"",""?:\\Windows\\System32\\smartscreen.exe"",""?:\\Windows\\System32\\MicrosoftEdgeCP.exe"",""?:\\ProgramData\\Microsoft\\WindowsDefender\\Platform\\*\\MsMpEng.exe"", ""?:\\Users\\*\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe"",""?:\\Users\\*\\AppData\\Local\\Programs\\Fiddler\\Fiddler.exe"",""?:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe"",""?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://community.jisc.ac.uk/blogs/csirt/article/trickbot-analysis-and-mitigation', 'https://www.cybereason.com/blog/dropping-anchor-from-a-trickbot-infection-to-the-discovery-of-the-anchor-malware']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/file-deletion-via-shred.html,File Deletion via Shrededit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Malware or other files dropped or created on a system by an adversary may leave traces behind as to what was done within a network and how. Adversaries may remove these files over the course of an intrusion to keep their footprint low or remove them at the end as part of the post-intrusion cleanup process.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:shred and process.args:(""-u"" or ""--remove"" or ""-z"" or ""--zero"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/file-permission-modification-in-writable-directory.html,File Permission Modification in Writable Directoryedit,['Defense Evasion'],['TA0005'],['File and Directory Permissions Modification'],['T1222'],Identifies file permission modifications in common writable directories by a non-root user. Adversaries often drop files or payloads into a writable directory and change permissions prior to execution.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:(chmod or chown or chattr or chgrp) andprocess.working_directory:(/tmp or /var/tmp or /dev/shm) and notuser.name:root,"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/file-and-directory-discovery.html,File and Directory Discoveryedit,['Discovery'],['TA0007'],['File and Directory Discovery'],['T1083'],Enumeration of files and directories using built-in tools. Adversaries may use the information discovered to plan follow-on activity.,['eql'],"sequence by agent.id, user.name with maxspan=1m [process whereevent.type in (""start"", ""process_started"") and ((process.name :""cmd.exe"" or process.pe.original_file_name == ""Cmd.Exe"") andprocess.args : ""dir"") or process.name : ""tree.com""] [process whereevent.type in (""start"", ""process_started"") and ((process.name :""cmd.exe"" or process.pe.original_file_name == ""Cmd.Exe"") andprocess.args : ""dir"") or process.name : ""tree.com""] [process whereevent.type in (""start"", ""process_started"") and ((process.name :""cmd.exe"" or process.pe.original_file_name == ""Cmd.Exe"") andprocess.args : ""dir"") or process.name : ""tree.com""]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/finder-sync-plugin-registered-and-enabled.html,Finder Sync Plugin Registered and Enablededit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],Finder Sync plugins enable users to extend Finders functionality by modifying the user interface. Adversaries may abuse this feature by adding a rogue Finder Plugin to repeatedly execute malicious payloads for persistence.,['eql'],"sequence by host.id, user.id with maxspan = 5s [process whereevent.type in (""start"", ""process_started"") and process.name :""pluginkit"" and process.args : ""-a""] [process where event.type in(""start"", ""process_started"") and process.name : ""pluginkit"" andprocess.args : ""-e"" and process.args : ""use"" and process.args : ""-i""and not process.args : (""com.google.GoogleDrive.FinderSyncAPIExtension"",""com.google.drivefs.findersync"", ""com.boxcryptor.osx.Rednif"",""com.adobe.accmac.ACCFinderSync"",""com.microsoft.OneDrive.FinderSync"",""com.insynchq.Insync.Insync-Finder-Integration"",""com.box.desktop.findersyncext"" ) ]","['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/specterops/presentations/raw/master/Leo%20Pitt/Hey_Im_Still_in_Here_Modern_macOS_Persistence_SO-CON2020.pdf'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/gcp-firewall-rule-creation.html,GCP Firewall Rule Creationedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a firewall rule is created in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may create a new firewall rule in order to weaken their targets security controls and allow more permissive ingress or egress traffic flows for their benefit.,['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:v*.compute.firewalls.insert,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/vpc/docs/firewalls'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/gcp-firewall-rule-deletion.html,GCP Firewall Rule Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a firewall rule is deleted in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may delete a firewall rule in order to weaken their targets security controls.,['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:v*.compute.firewalls.delete,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/vpc/docs/firewalls'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/gcp-firewall-rule-modification.html,GCP Firewall Rule Modificationedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a firewall rule is modified in Google Cloud Platform (GCP). Virtual Private Cloud (VPC) firewall rules can be configured to allow or deny connections to or from virtual machine (VM) instances. An adversary may modify a firewall rule in order to weaken their targets security controls.,['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:v*.compute.firewalls.patch,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/vpc/docs/firewalls'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/gcp-iam-custom-role-creation.html,GCP IAM Custom Role Creationedit,"['Initial Access', 'Persistence']","['TA0001', 'TA0003']","['Valid Accounts', 'Valid Accounts']","['T1078', 'T1078']","Identifies an Identity and Access Management (IAM) custom role creation in Google Cloud Platform (GCP). Custom roles are user-defined, and allow for the bundling of one or more supported permissions to meet specific needs. Custom roles will not be updated automatically and could lead to privilege creep if not carefully scrutinized.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.CreateRole and event.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/iam/docs/understanding-custom-roles'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-iam-role-deletion.html,GCP IAM Role Deletionedit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],Identifies an Identity and Access Management (IAM) role deletion in Google Cloud Platform (GCP). A role contains a set of permissions that allows you to perform specific actions on Google Cloud resources. An adversary may delete an IAM role to inhibit access to accounts utilized by legitimate users.,['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.DeleteRole and event.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/iam/docs/understanding-roles'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-iam-service-account-key-deletion.html,GCP IAM Service Account Key Deletionedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies the deletion of an Identity and Access Management (IAM) service account key in Google Cloud Platform (GCP). Each service account is associated with two sets of public/private RSA key pairs that are used to authenticate. If a key is deleted, the application will no longer be able to access Google Cloud resources using that key. A security best practice is to rotate your service account keys regularly.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.DeleteServiceAccountKey andevent.outcome:success,"['filebeat-*', 'logs-gcp*']","['https://cloud.google.com/iam/docs/service-accounts', 'https://cloud.google.com/iam/docs/creating-managing-service-account-keys']","['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-kubernetes-rolebindings-created-or-patched.html,GCP Kubernetes Rolebindings Created or Patchededit,['Privilege Escalation'],['TA0004'],[],[],"Identifies the creation or patching of potential malicious rolebinding. You can assign these roles to Kubernetes subjects (users, groups, or service accounts) with role bindings and cluster role bindings.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:(io.k8s.authorization.rbac.v*.clusterrolebindings.createor io.k8s.authorization.rbac.v*.rolebindings.create orio.k8s.authorization.rbac.v*.clusterrolebindings.patch orio.k8s.authorization.rbac.v*.rolebindings.patch) andevent.outcome:success,"['filebeat-*', 'logs-gcp*']","['https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging', 'https://unofficial-kubernetes.readthedocs.io/en/latest/admin/authorization/rbac/', 'https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control']","['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/gcp-logging-bucket-deletion.html,GCP Logging Bucket Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies a Logging bucket deletion in Google Cloud Platform (GCP). Log buckets are containers that store and organize log data. A deleted bucket stays in a pending state for 7 days, and Logging continues to route logs to the bucket during that time. To stop routing logs to a deleted bucket, the log sinks can be deleted that have the bucket as a destination, or the filter for the sinks can be modified to stop routing logs to the deleted bucket. An adversary may delete a log bucket to evade detection.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.logging.v*.ConfigServiceV*.DeleteBucket andevent.outcome:success,"['filebeat-*', 'logs-gcp*']","['https://cloud.google.com/logging/docs/buckets', 'https://cloud.google.com/logging/docs/storage']","['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-logging-sink-deletion.html,GCP Logging Sink Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies a Logging sink deletion in Google Cloud Platform (GCP). Every time a log entry arrives, Logging compares the log entry to the sinks in that resource. Each sink whose filter matches the log entry writes a copy of the log entry to the sinks export destination. An adversary may delete a Logging sink to evade detection.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.logging.v*.ConfigServiceV*.DeleteSink andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/logging/docs/export'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-logging-sink-modification.html,GCP Logging Sink Modificationedit,['Exfiltration'],['TA0010'],['Transfer Data to Cloud Account'],['T1537'],Identifies a modification to a Logging sink in Google Cloud Platform (GCP). Logging compares the log entry to the sinks in that resource. Each sink whose filter matches the log entry writes a copy of the log entry to the sinks export destination. An adversary may update a Logging sink to exfiltrate logs to a different export destination.,['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.logging.v*.ConfigServiceV*.UpdateSink andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/logging/docs/export#how_sinks_work'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-pub-sub-subscription-creation.html,GCP Pub/Sub Subscription Creationedit,['Collection'],['TA0009'],['Data from Cloud Storage Object'],['T1530'],"Identifies the creation of a subscription in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship (Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A subscription is a named resource representing the stream of messages to be delivered to the subscribing application.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.pubsub.v*.Subscriber.CreateSubscription andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/pubsub/docs/overview'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-pub-sub-subscription-deletion.html,GCP Pub/Sub Subscription Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies the deletion of a subscription in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship (Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A subscription is a named resource representing the stream of messages to be delivered to the subscribing application.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.pubsub.v*.Subscriber.DeleteSubscription andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/pubsub/docs/overview'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-pub-sub-topic-creation.html,GCP Pub/Sub Topic Creationedit,['Collection'],['TA0009'],['Data from Cloud Storage Object'],['T1530'],"Identifies the creation of a topic in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship (Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A topic is used to forward messages from publishers to subscribers.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.pubsub.v*.Publisher.CreateTopic andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/pubsub/docs/admin'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-pub-sub-topic-deletion.html,GCP Pub/Sub Topic Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies the deletion of a topic in Google Cloud Platform (GCP). In GCP, the publisher-subscriber relationship (Pub/Sub) is an asynchronous messaging service that decouples event-producing and event-processing services. A publisher application creates and sends messages to a topic. Deleting a topic can interrupt message flow in the Pub/Sub pipeline.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.pubsub.v*.Publisher.DeleteTopic andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/pubsub/docs/overview'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Log Auditing']"
https://www.elastic.co/guide/en/security/7.16/gcp-service-account-creation.html,GCP Service Account Creationedit,['Persistence'],['TA0003'],['Create Account'],['T1136'],"Identifies when a new service account is created in Google Cloud Platform (GCP). A service account is a special type of account used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts to make authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity users through domain-wide delegation. If service accounts are not tracked and managed properly, they can present a security risk. An adversary may create a new service account to use during their operations in order to avoid using a standard user account and attempt to evade detection.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.CreateServiceAccount andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/iam/docs/service-accounts'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-service-account-deletion.html,GCP Service Account Deletionedit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],"Identifies when a service account is deleted in Google Cloud Platform (GCP). A service account is a special type of account used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts to make authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity users through domain-wide delegation. An adversary may delete a service account in order to disrupt their targets business operations.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.DeleteServiceAccount andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/iam/docs/service-accounts'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-service-account-disabled.html,GCP Service Account Disablededit,['Impact'],['TA0040'],['Account Access Removal'],['T1531'],"Identifies when a service account is disabled in Google Cloud Platform (GCP). A service account is a special type of account used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts to make authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity users through domain-wide delegation. An adversary may disable a service account in order to disrupt to disrupt their targets business operations.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.DisableServiceAccount andevent.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/iam/docs/service-accounts'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-service-account-key-creation.html,GCP Service Account Key Creationedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies when a new key is created for a service account in Google Cloud Platform (GCP). A service account is a special type of account used by an application or a virtual machine (VM) instance, not a person. Applications use service accounts to make authorized API calls, authorized as either the service account itself, or as G Suite or Cloud Identity users through domain-wide delegation. If private keys are not tracked and managed properly, they can present a security risk. An adversary may create a new key for a service account in order to attempt to abuse the permissions assigned to that account and evade detection.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:google.iam.admin.v*.CreateServiceAccountKey andevent.outcome:success,"['filebeat-*', 'logs-gcp*']","['https://cloud.google.com/iam/docs/service-accounts', 'https://cloud.google.com/iam/docs/creating-managing-service-account-keys']","['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-storage-bucket-configuration-modification.html,GCP Storage Bucket Configuration Modificationedit,[],[],[],[],Identifies when the configuration is modified for a storage bucket in Google Cloud Platform (GCP). An adversary may modify the configuration of a storage bucket in order to weaken the security controls of their targets environment.,['query'],"event.dataset:(googlecloud.audit or gcp.audit) andevent.action:""storage.buckets.update"" and event.outcome:success","['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/storage/docs/key-terms#buckets'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-storage-bucket-deletion.html,GCP Storage Bucket Deletionedit,['Impact'],['TA0040'],['Data Destruction'],['T1485'],Identifies when a Google Cloud Platform (GCP) storage bucket is deleted. An adversary may delete a storage bucket in order to disrupt their targets business operations.,['query'],"event.dataset:(googlecloud.audit or gcp.audit) andevent.action:""storage.buckets.delete""","['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/storage/docs/key-terms#buckets'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/gcp-storage-bucket-permissions-modification.html,GCP Storage Bucket Permissions Modificationedit,['Defense Evasion'],['TA0005'],['File and Directory Permissions Modification'],['T1222'],"Identifies when the Identity and Access Management (IAM) permissions are modified for a Google Cloud Platform (GCP) storage bucket. An adversary may modify the permissions on a storage bucket to weaken their targets security controls or an administrator may inadvertently modify the permissions, which could lead to data exposure or loss.",['query'],"event.dataset:(googlecloud.audit or gcp.audit) andevent.action:""storage.setIamPermissions"" and event.outcome:success","['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/storage/docs/access-control/iam-permissions'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/gcp-virtual-private-cloud-network-deletion.html,GCP Virtual Private Cloud Network Deletionedit,[],[],[],[],"Identifies when a Virtual Private Cloud (VPC) network is deleted in Google Cloud Platform (GCP). A VPC network is a virtual version of a physical network within a GCP project. Each VPC network has its own subnets, routes, and firewall, as well as other elements. An adversary may delete a VPC network in order to disrupt their targets network and business operations.",['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:v*.compute.networks.delete and event.outcome:success,"['filebeat-*', 'logs-gcp*']",['https://cloud.google.com/vpc/docs/vpc'],"['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/gcp-virtual-private-cloud-route-creation.html,GCP Virtual Private Cloud Route Creationedit,[],[],[],[],Identifies when a Virtual Private Cloud (VPC) route is created in Google Cloud Platform (GCP). Google Cloud routes define the paths that network traffic takes from a virtual machine (VM) instance to other destinations. These destinations can be inside a Google VPC network or outside it. An adversary may create a route in order to impact the flow of network traffic in their targets cloud environment.,['query'],"event.dataset:(googlecloud.audit or gcp.audit) andevent.action:(v*.compute.routes.insert or""beta.compute.routes.insert"")","['filebeat-*', 'logs-gcp*']","['https://cloud.google.com/vpc/docs/routes', 'https://cloud.google.com/vpc/docs/using-routes']","['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/gcp-virtual-private-cloud-route-deletion.html,GCP Virtual Private Cloud Route Deletionedit,[],[],[],[],Identifies when a Virtual Private Cloud (VPC) route is deleted in Google Cloud Platform (GCP). Google Cloud routes define the paths that network traffic takes from a virtual machine (VM) instance to other destinations. These destinations can be inside a Google VPC network or outside it. An adversary may delete a route in order to impact the flow of network traffic in their targets cloud environment.,['query'],event.dataset:(googlecloud.audit or gcp.audit) andevent.action:v*.compute.routes.delete and event.outcome:success,"['filebeat-*', 'logs-gcp*']","['https://cloud.google.com/vpc/docs/routes', 'https://cloud.google.com/vpc/docs/using-routes']","['Elastic', 'Cloud', 'GCP', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-api-access-granted-via-domain-wide-delegation-of-authority.html,Google Workspace API Access Granted via Domain-Wide Delegation of Authorityedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects when a domain-wide delegation of authority is granted to a service account. Domain-wide delegation can be configured to grant third-party and internal applications to access the data of Google Workspace users. An adversary may configure domain-wide delegation to maintain access to their targets data.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:AUTHORIZE_API_CLIENT_ACCESS,"['filebeat-*', 'logs-google_workspace*']",['https://developers.google.com/admin-sdk/directory/v1/guides/delegation'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-admin-role-assigned-to-a-user.html,Google Workspace Admin Role Assigned to a Useredit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects when an admin role is assigned to a Google Workspace user. An adversary may assign an admin role to a user in order to elevate the permissions of another user account and persist in their targets environment.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:ASSIGN_ROLE,"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/172176?hl=en'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-admin-role-deletion.html,Google Workspace Admin Role Deletionedit,[],[],[],[],Detects when a custom admin role is deleted. An adversary may delete a custom admin role in order to impact the permissions or capabilities of system administrators.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:DELETE_ROLE,"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/2406043?hl=en'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-custom-admin-role-created.html,Google Workspace Custom Admin Role Creatededit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects when a custom admin role is created in Google Workspace. An adversary may create a custom admin role in order to elevate the permissions of other user accounts and persist in their targets environment.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:CREATE_ROLE,"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/2406043?hl=en'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-mfa-enforcement-disabled.html,Google Workspace MFA Enforcement Disablededit,[],[],[],[],Detects when multi-factor authentication (MFA) enforcement is disabled for Google Workspace users. An adversary may disable MFA enforcement in order to weaken an organizations security controls.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:ENFORCE_STRONG_AUTHENTICATION and(gsuite.admin.new_value:false orgoogle_workspace.admin.new_value:false),"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/9176657?hl=en#'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-password-policy-modified.html,Google Workspace Password Policy Modifiededit,[],[],[],[],Detects when a Google Workspace password policy is modified. An adversary may attempt to modify a password policy in order to weaken an organizations security controls.,['query'],"event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:(CHANGE_APPLICATION_SETTING orCREATE_APPLICATION_SETTING) and gsuite.admin.setting.name:(""Password Management - Enforce strong password"" or ""PasswordManagement - Password reset frequency"" or ""Password Management -Enable password reuse"" or ""Password Management - Enforce passwordpolicy at next login"" or ""Password Management - Minimum passwordlength"" or ""Password Management - Maximum password length"" ) orgoogle_workspace.admin.setting.name:( ""Password Management -Enforce strong password"" or ""Password Management - Password resetfrequency"" or ""Password Management - Enable password reuse"" or""Password Management - Enforce password policy at next login"" or""Password Management - Minimum password length"" or ""PasswordManagement - Maximum password length"" )","['filebeat-*', 'logs-google_workspace*']",N/A,"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/google-workspace-role-modified.html,Google Workspace Role Modifiededit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Detects when a custom admin role or its permissions are modified. An adversary may modify a custom admin role in order to elevate the permissions of other user accounts and persist in their targets environment.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:(ADD_PRIVILEGE or UPDATE_ROLE),"['filebeat-*', 'logs-google_workspace*']",['https://support.google.com/a/answer/2406043?hl=en'],"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/halfbaked-command-and-control-beacon.html,Halfbaked Command and Control Beaconedit,['Command and Control'],['TA0011'],['Application Layer Protocol'],['T1071'],Halfbaked is a malware family used to establish persistence in a contested network. This rule detects a network activity algorithm leveraged by Halfbaked implant beacons for command and control.,['query'],"event.category:(network OR network_traffic) AND network.protocol:httpAND network.transport:tcp ANDurl.full:/http:\/\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}\/cd/AND destination.port:(53 OR 80 OR 8080 OR 443)","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html', 'https://attack.mitre.org/software/S0151/']","['Elastic', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/high-number-of-okta-user-password-reset-or-unlock-attempts.html,High Number of Okta User Password Reset or Unlock Attemptsedit,"['Defense Evasion', 'Persistence', 'Initial Access']","['TA0005', 'TA0003', 'TA0001']","['Valid Accounts', 'Valid Accounts', 'Valid Accounts']","['T1078', 'T1078', 'T1078']",Identifies a high number of Okta user password reset or account unlock attempts. An adversary may attempt to obtain unauthorized access to Okta user accounts using these methods and attempt to blend in with normal activity in their targets environment and evade detection.,['threshold'],event.dataset:okta.system andevent.action:(system.email.account_unlock.sent_message orsystem.email.password_reset.sent_message orsystem.sms.send_account_unlock_message orsystem.sms.send_password_reset_message orsystem.voice.send_account_unlock_call orsystem.voice.send_password_reset_call oruser.account.unlock_token),"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/high-number-of-process-and-or-service-terminations.html,High Number of Process and/or Service Terminationsedit,['Impact'],['TA0040'],['Service Stop'],['T1489'],"This rule identifies a high number (10) of process terminations (stop, delete, or suspend) from the same host within a short time period.",['threshold'],"event.category:process and event.type:start and process.name:(net.exeor sc.exe or taskkill.exe) and process.args:(stop or pause or deleteor ""/PID"" or ""/IM"" or ""/T"" or ""/F"" or ""/t"" or ""/f"" or ""/im"" or ""/pid"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/hosts-file-modified.html,Hosts File Modifiededit,['Impact'],['TA0040'],['Data Manipulation'],['T1565'],"The hosts file on endpoints is used to control manual IP address to hostname resolutions. The hosts file is the first point of lookup for DNS hostname resolution so if adversaries can modify the endpoint hosts file, they can route traffic to malicious infrastructure. This rule detects modifications to the hosts file on Microsoft Windows, Linux (Ubuntu or RHEL) and macOS systems.",['eql'],"any where /* file events for creation; file change events are notcaptured by some of the included sources for linux and so maymiss this, which is the purpose of the process + command line argslogic below */ ( event.category == ""file"" and event.type in(""change"", ""creation"") and file.path : (""/private/etc/hosts"",""/etc/hosts"", ""?:\\Windows\\System32\\drivers\\etc\\hosts"") ) or/* process events for change targeting linux only */ (event.category == ""process"" and event.type in (""start"") andprocess.name in (""nano"", ""vim"", ""vi"", ""emacs"", ""echo"", ""sed"") andprocess.args : (""/etc/hosts"") )","['auditbeat-*', 'winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['/guide/en/beats/auditbeat/current/auditbeat-reference-yml.html'],"['Elastic', 'Host', 'Linux', 'Windows', 'macOS', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/hping-process-activity.html,Hping Process Activityedit,[],[],[],[],"Hping ran on a Linux host. Hping is a FOSS command-line packet analyzer and has the ability to construct network packets for a wide variety of network security testing applications, including scanning and firewall auditing.",['query'],event.category:process and event.type:(start or process_started) andprocess.name:(hping or hping2 or hping3),"['auditbeat-*', 'logs-endpoint.events.*']",['https://en.wikipedia.org/wiki/Hping'],"['Elastic', 'Host', 'Linux', 'Threat Detection']"
https://www.elastic.co/guide/en/security/7.16/iis-http-logging-disabled.html,IIS HTTP Logging Disablededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when Internet Information Services (IIS) HTTP Logging is disabled on a server. An attacker with IIS server access via a webshell or other mechanism can disable HTTP Logging as an effective anti-forensics measure.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""appcmd.exe"" or process.pe.original_file_name ==""appcmd.exe"") and process.args : ""/dontLog*:*True"" and notprocess.parent.name : ""iissetup.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/ipsec-nat-traversal-port-activity.html,IPSEC NAT Traversal Port Activityedit,['Command and Control'],['TA0011'],[],[],"This rule detects events that could be describing IPSEC NAT Traversal traffic. IPSEC is a VPN technology that allows one system to talk to another using encrypted tunnels. NAT Traversal enables these tunnels to communicate over the Internet where one of the sides is behind a NAT router gateway. This may be common on your network, but this technique is also used by threat actors to avoid detection.",['query'],event.category:(network or network_traffic) and network.transport:udpand destination.port:4500,"['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/image-file-execution-options-injection.html,Image File Execution Options Injectionedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"The Debugger and SilentProcessExit registry keys can allow an adversary to intercept the execution of files, causing a different process to be executed. This functionality can be abused by an adversary to establish persistence.",['eql'],"registry where length(registry.data.strings) > 0 and registry.path :(""HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image FileExecution Options\\*.exe\\Debugger"",""HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\WindowsNT\\CurrentVersion\\Image File Execution Options\\*\\Debugger"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess"",""HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\WindowsNT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess"") and /*add FPs here */ not registry.data.strings regex~ (""""""C:\\ProgramFiles( \(x86\))?\\ThinKiosk\\thinkiosk\.exe"""""","""""".*\\PSAppDeployToolkit\\.*"""""")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/imageload-via-windows-update-auto-update-client.html,ImageLoad via Windows Update Auto Update Clientedit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies abuse of the Windows Update Auto Update Client (wuauclt.exe) to load an arbitrary DLL. This behavior is used as a defense evasion technique to blend-in malicious activity with legitimate Windows software.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.pe.original_file_name == ""wuauclt.exe"" or process.name :""wuauclt.exe"") and /* necessary windows update client args to loada dll */ process.args : ""/RunHandlerComServer"" and process.args :""/UpdateDeploymentProvider"" and /* common paths writeable by astandard user where the target DLL can be placed */ process.args :(""C:\\Users\\*.dll"", ""C:\\ProgramData\\*.dll"",""C:\\Windows\\Temp\\*.dll"", ""C:\\Windows\\Tasks\\*.dll"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://dtm.uk/wuauclt/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/inbound-connection-to-an-unsecure-elasticsearch-node.html,Inbound Connection to an Unsecure Elasticsearch Nodeedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],"Identifies Elasticsearch nodes that do not have Transport Layer Security (TLS), and/or lack authentication, and are accepting inbound network connections over the default Elasticsearch port.",['query'],"event.category:network_traffic AND network.protocol:http AND status:OKAND destination.port:9200 AND network.direction:inbound AND NOThttp.response.headers.content-type:""image/x-icon"" AND NOT_exists_:http.request.headers.authorization","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['/guide/en/elasticsearch/reference/current/configuring-security.html', '/guide/en/beats/packetbeat/current/packetbeat-http-options.html#_send_all_headers']","['Elastic', 'Network', 'Threat Detection', 'Initial Access', 'Host']"
https://www.elastic.co/guide/en/security/7.16/incoming-dcom-lateral-movement-via-mshta.html,Incoming DCOM Lateral Movement via MSHTAedit,"['Lateral Movement', 'Defense Evasion']","['TA0008', 'TA0005']","['Remote Services', 'Signed Binary Proxy Execution']","['T1021', 'T1218']","Identifies the use of Distributed Component Object Model (DCOM) to execute commands from a remote host, which are launched via the HTA Application COM Object. This behavior may indicate an attacker abusing a DCOM application to move laterally while attempting to evading detection.",['eql'],"sequence with maxspan=1m [process where event.type in (""start"",""process_started"") and process.name : ""mshta.exe"" andprocess.args : ""-Embedding"" ] by host.id, process.entity_id[network where event.type == ""start"" and process.name : ""mshta.exe""and network.direction : (""incoming"", ""ingress"") andnetwork.transport == ""tcp"" and source.port > 49151 anddestination.port > 49151 and not source.address in (""127.0.0.1"",""::1"") ] by host.id, process.entity_id","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://codewhitesec.blogspot.com/2018/07/lethalhta.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/incoming-dcom-lateral-movement-with-mmc.html,Incoming DCOM Lateral Movement with MMCedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies the use of Distributed Component Object Model (DCOM) to run commands from a remote host, which are launched via the MMC20 Application COM Object. This behavior may indicate an attacker abusing a DCOM application to move laterally.",['eql'],"sequence by host.id with maxspan=1m [network where event.type ==""start"" and process.name : ""mmc.exe"" and source.port >= 49152 anddestination.port >= 49152 and source.address not in (""127.0.0.1"",""::1"") and network.direction : (""incoming"", ""ingress"") andnetwork.transport == ""tcp"" ] by process.entity_id [process whereevent.type in (""start"", ""process_started"") and process.parent.name :""mmc.exe"" ] by process.parent.entity_id","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/incoming-dcom-lateral-movement-with-shellbrowserwindow-or-shellwindows.html,Incoming DCOM Lateral Movement with ShellBrowserWindow or ShellWindowsedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies use of Distributed Component Object Model (DCOM) to run commands from a remote host, which are launched via the ShellBrowserWindow or ShellWindows Application COM Object. This behavior may indicate an attacker abusing a DCOM application to stealthily move laterally.",['eql'],"sequence by host.id with maxspan=5s [network where event.type ==""start"" and process.name : ""explorer.exe"" and network.direction :(""incoming"", ""ingress"") and network.transport == ""tcp"" andsource.port > 49151 and destination.port > 49151 and notsource.address in (""127.0.0.1"", ""::1"") ] by process.entity_id[process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""explorer.exe"" ] by process.parent.entity_id","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://enigma0x3.net/2017/01/23/lateral-movement-via-dcom-round-2/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/incoming-execution-via-powershell-remoting.html,Incoming Execution via PowerShell Remotingedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies remote execution via Windows PowerShell remoting. Windows PowerShell remoting allows for running any Windows PowerShell command on one or more remote computers. This could be an indication of lateral movement.,['eql'],"sequence by host.id with maxspan = 30s [network wherenetwork.direction : (""incoming"", ""ingress"") and destination.port in(5985, 5986) and network.protocol == ""http"" and source.address !=""127.0.0.1"" and source.address != ""::1"" ] [process whereevent.type == ""start"" and process.parent.name : ""wsmprovhost.exe"" andnot process.name : ""conhost.exe""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/incoming-execution-via-winrm-remote-shell.html,Incoming Execution via WinRM Remote Shelledit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies remote execution via Windows Remote Management (WinRM) remote shell on a target host. This could be an indication of lateral movement.,['eql'],"sequence by host.id with maxspan=30s [network where process.pid ==4 and network.direction : (""incoming"", ""ingress"") anddestination.port in (5985, 5986) and network.protocol == ""http"" andnot source.address in (""::1"", ""127.0.0.1"") ] [process whereevent.type == ""start"" and process.parent.name : ""winrshost.exe"" andnot process.name : ""conhost.exe""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/installutil-process-making-network-connections.html,InstallUtil Process Making Network Connectionsedit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies InstallUtil.exe making outbound network connections. This may indicate adversarial activity as InstallUtil is often leveraged by adversaries to execute code and evade detection.,['eql'],"/* the benefit of doing this as an eql sequence vs kql is this willlimit to alerting only on the first network connection */ sequence byprocess.entity_id [process where event.type in (""start"",""process_started"") and process.name : ""installutil.exe""] [networkwhere process.name : ""installutil.exe"" and network.direction :(""outgoing"", ""egress"")]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/installation-of-custom-shim-databases.html,Installation of Custom Shim Databasesedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],Identifies the installation of custom Application Compatibility Shim databases. This Windows functionality has been abused by attackers to stealthily gain persistence and arbitrary code execution in legitimate Windows processes.,['eql'],"sequence by process.entity_id with maxspan = 5m [process whereevent.type in (""start"", ""process_started"") and not (process.name :""sdbinst.exe"" and process.parent.name : ""msiexec.exe"")] [registrywhere event.type in (""creation"", ""change"") and registry.path :""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\AppCompatFlags\\Custom\\*.sdb""]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/installation-of-security-support-provider.html,Installation of Security Support Provideredit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies registry modifications related to the Windows Security Support Provider (SSP) configuration. Adversaries may abuse this to establish persistence in an environment.,['eql'],"registry where registry.path :(""HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Security Packages*"",""HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\SecurityPackages*"") and not process.executable :(""C:\\Windows\\System32\\msiexec.exe"",""C:\\Windows\\SysWOW64\\msiexec.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/interactive-terminal-spawned-via-perl.html,Interactive Terminal Spawned via Perledit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies when a terminal (tty) is spawned via Perl. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:perl and process.args:(""exec \""/bin/sh\"";"" or ""exec\""/bin/dash\"";"" or ""exec \""/bin/bash\"";"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/interactive-terminal-spawned-via-python.html,Interactive Terminal Spawned via Pythonedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies when a terminal (tty) is spawned via Python. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:python and process.args:(""import pty;pty.spawn(\""/bin/sh\"")"" or ""import pty;pty.spawn(\""/bin/dash\"")"" or ""import pty;pty.spawn(\""/bin/bash\"")"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/kerberos-cached-credentials-dumping.html,Kerberos Cached Credentials Dumpingedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies the use of the Kerberos credential cache (kcc) utility to dump locally cached Kerberos tickets.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:kcc and process.args:copy_cred_cache,"['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/EmpireProject/EmPyre/blob/master/lib/modules/collection/osx/kerberosdump.py', 'https://opensource.apple.com/source/Heimdal/Heimdal-323.12/kuser/kcc-commands.in.auto.html']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/kerberos-traffic-from-unusual-process.html,Kerberos Traffic from Unusual Processedit,['Credential Access'],['TA0006'],['Steal or Forge Kerberos Tickets'],['T1558'],"Identifies network connections to the standard Kerberos port from an unusual process. On Windows, the only process that normally performs Kerberos traffic from a domain joined host is lsass.exe.",['eql'],"network where event.type == ""start"" and network.direction :(""outgoing"", ""egress"") and destination.port == 88 and source.port >=49152 and process.executable != ""C:\\Windows\\System32\\lsass.exe""and destination.address !=""127.0.0.1"" and destination.address !=""::1""and /* insert False Positives here */ not process.name in(""swi_fc.exe"", ""fsIPcam.exe"", ""IPCamera.exe"", ""MicrosoftEdgeCP.exe"",""MicrosoftEdge.exe"", ""iexplore.exe"", ""chrome.exe"", ""msedge.exe"",""opera.exe"", ""firefox.exe"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/kernel-module-removal.html,Kernel Module Removaledit,"['Defense Evasion', 'Persistence']","['TA0005', 'TA0003']","['Impair Defenses', 'Boot or Logon Autostart Execution']","['T1562', 'T1547']",Kernel modules are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This rule identifies attempts to remove a kernel module.,['query'],"event.category:process and event.type:(start or process_started) andprocess.args:((rmmod and sudo) or (modprobe and sudo and (""--remove""or ""-r"")))","['auditbeat-*', 'logs-endpoint.events.*']",['http://man7.org/linux/man-pages/man8/modprobe.8.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/keychain-password-retrieval-via-command-line.html,Keychain Password Retrieval via Command Lineedit,['Credential Access'],['TA0006'],['Credentials from Password Stores'],['T1555'],"Adversaries may collect keychain storage data from a system to in order to acquire credentials. Keychains are the built-in way for macOS to keep track of users' passwords and credentials for many services and features, including Wi-Fi and website passwords, secure notes, certificates, and Kerberos.",['eql'],"process where event.type == ""start"" and process.name : ""security"" andprocess.args : ""-wa"" and process.args : (""find-generic-password"",""find-internet-password"") and process.args : (""Chrome*"", ""Chromium"",""Opera"", ""Safari*"", ""Brave"", ""Microsoft Edge"", ""Edge"", ""Firefox*"") andnot process.parent.executable : ""/Applications/Keeper PasswordManager.app/Contents/Frameworks/Keeper Password ManagerHelper*/Contents/MacOS/Keeper Password Manager Helper*""","['auditbeat-*', 'logs-endpoint.events.*']","['https://www.netmeister.org/blog/keychain-passwords.html', 'https://github.com/priyankchheda/chrome_password_grabber/blob/master/chrome.py', 'https://ss64.com/osx/security.html', 'https://www.intezer.com/blog/research/operation-electrorat-attacker-creates-fake-companies-to-drain-your-crypto-wallets/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/lsass-memory-dump-creation.html,LSASS Memory Dump Creationedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies the creation of a Local Security Authority Subsystem Service (lsass.exe) default memory dump. This may indicate a credential access attempt via trusted system utilities such as Task Manager (taskmgr.exe) and SQL Dumper (sqldumper.exe) or known pentesting tools such as Dumpert and AndrewSpecial.,['eql'],"file where file.name : (""lsass*.dmp"", ""dumpert.dmp"", ""Andrew.dmp"",""SQLDmpr*.mdmp"", ""Coredump.dmp"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://github.com/outflanknl/Dumpert', 'https://github.com/hoangprod/AndrewSpecial']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/lateral-movement-via-startup-folder.html,Lateral Movement via Startup Folderedit,"['Lateral Movement', 'Persistence']","['TA0008', 'TA0003']","['Remote Services', 'Boot or Logon Autostart Execution']","['T1021', 'T1547']",Identifies suspicious file creations in the startup folder of a remote system. An adversary could abuse this to move laterally by dropping a malicious script or executable that will be executed after a reboot or user logon.,['eql'],"file where event.type in (""creation"", ""change"") and /* via RDPTSClient mounted share or SMB */ (process.name : ""mstsc.exe"" orprocess.pid == 4) and file.path : ""C:\\*\\Microsoft\\Windows\\StartMenu\\Programs\\Startup\\*""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://www.mdsec.co.uk/2017/06/rdpinception/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/lateral-tool-transfer.html,Lateral Tool Transferedit,['Lateral Movement'],['TA0008'],['Lateral Tool Transfer'],['T1570'],Identifies the creation or change of a Windows executable file over network shares. Adversaries may transfer tools or other files between systems in a compromised environment.,['eql'],"sequence by host.id with maxspan=30s [network where event.type ==""start"" and process.pid == 4 and destination.port == 445 andnetwork.direction : (""incoming"", ""ingress"") and network.transport ==""tcp"" and source.address != ""127.0.0.1"" and source.address != ""::1""] by process.entity_id /* add more executable extensions here ifthey are not noisy in your environment */ [file where event.type in(""creation"", ""change"") and process.pid == 4 and file.extension :(""exe"", ""dll"", ""bat"", ""cmd"")] by process.entity_id","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/launch-agent-creation-or-modification-and-immediate-loading.html,Launch Agent Creation or Modification and Immediate Loadingedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],An adversary can establish persistence by installing a new launch agent that executes at login by using launchd or launchctl to load a plist into the appropriate directories.,['eql'],"sequence by host.id with maxspan=1m [file where event.type !=""deletion"" and file.path : (""/System/Library/LaunchAgents/*"",""/Library/LaunchAgents/*"", ""/Users/*/Library/LaunchAgents/*"") ][process where event.type in (""start"", ""process_started"") andprocess.name == ""launchctl"" and process.args == ""load""]","['auditbeat-*', 'logs-endpoint.events.*']",['https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/launchdaemon-creation-or-modification-and-immediate-loading.html,LaunchDaemon Creation or Modification and Immediate Loadingedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],Adversaries may create or modify launch daemons to repeatedly execute malicious payloads as part of persistence.,['eql'],"sequence by host.id with maxspan=1m [file where event.type !=""deletion"" and file.path in (""/System/Library/LaunchDaemons/*"", ""/Library/LaunchDaemons/*"")] [process where event.type in (""start"",""process_started"") and process.name == ""launchctl"" and process.args ==""load""]","['auditbeat-*', 'logs-endpoint.events.*']",['https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/local-scheduled-task-creation.html,Local Scheduled Task Creationedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],"A scheduled task can be used by an adversary to establish persistence, move laterally, and/or escalate privileges.",['eql'],"sequence with maxspan=1m [process where event.type != ""end"" and((process.name : (""cmd.exe"", ""wscript.exe"", ""rundll32.exe"",""regsvr32.exe"", ""wmic.exe"", ""mshta.exe"",""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"", ""WmiPrvSe.exe"",""wsmprovhost.exe"", ""winrshost.exe"") orprocess.pe.original_file_name : (""cmd.exe"", ""wscript.exe"",""rundll32.exe"", ""regsvr32.exe"", ""wmic.exe"", ""mshta.exe"",""powershell.exe"", ""pwsh.dll"", ""powershell_ise.exe"", ""WmiPrvSe.exe"",""wsmprovhost.exe"",""winrshost.exe"")) or process.code_signature.trusted == false)] byprocess.entity_id [process where event.type == ""start"" and(process.name : ""schtasks.exe"" or process.pe.original_file_name ==""schtasks.exe"") and process.args : (""/create"", ""-create"") andprocess.args : (""/RU"", ""/SC"", ""/TN"", ""/TR"", ""/F"", ""/XML"") and /*exclude SYSTEM SIDs - look for task creations by non-SYSTEM user */not user.id : (""S-1-5-18"", ""S-1-5-19"", ""S-1-5-20"")] byprocess.parent.entity_id","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/mfa-disabled-for-google-workspace-organization.html,MFA Disabled for Google Workspace Organizationedit,[],[],[],[],Detects when multi-factor authentication (MFA) is disabled for a Google Workspace organization. An adversary may attempt to modify a password policy in order to weaken an organizations security controls.,['query'],event.dataset:(gsuite.admin or google_workspace.admin) andevent.provider:admin and event.category:iam andevent.action:(ENFORCE_STRONG_AUTHENTICATION orALLOW_STRONG_AUTHENTICATION) and (gsuite.admin.new_value:false orgoogle_workspace.admin.new_value:false),"['filebeat-*', 'logs-google_workspace*']",N/A,"['Elastic', 'Cloud', 'Google Workspace', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/malware-detected-elastic-endgame.html,Malware - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected Malware. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and(event.action:file_classification_event orendgame.event_subtype_full:file_classification_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/malware-prevented-elastic-endgame.html,Malware - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented Malware. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and(event.action:file_classification_event orendgame.event_subtype_full:file_classification_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-anti-phish-policy-deletion.html,Microsoft 365 Exchange Anti-Phish Policy Deletionedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies the deletion of an anti-phishing policy in Microsoft 365. By default, Microsoft 365 includes built-in features that help protect users from phishing attacks. Anti-phishing polices increase this protection by refining settings to better detect and prevent attacks.",['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""Remove-AntiPhishPolicy"" andevent.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-antiphishpolicy?view=exchange-ps', 'https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/set-up-anti-phishing-policies?view=o365-worldwide']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-anti-phish-rule-modification.html,Microsoft 365 Exchange Anti-Phish Rule Modificationedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies the modification of an anti-phishing rule in Microsoft 365. By default, Microsoft 365 includes built-in features that help protect users from phishing attacks. Anti-phishing rules increase this protection by refining settings to better detect and prevent attacks.",['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:(""Remove-AntiPhishRule"" or""Disable-AntiPhishRule"") and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-antiphishrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/disable-antiphishrule?view=exchange-ps']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-dkim-signing-configuration-disabled.html,Microsoft 365 Exchange DKIM Signing Configuration Disablededit,[],[],[],[],"Identifies when a DomainKeys Identified Mail (DKIM) signing configuration is disabled in Microsoft 365. With DKIM in Microsoft 365, messages that are sent from Exchange Online will be cryptographically signed. This will allow the receiving email system to validate that the messages were generated by a server that the organization authorized and not being spoofed.",['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""Set-DkimSigningConfig"" ando365.audit.Parameters.Enabled:False and event.outcome:success","['filebeat-*', 'logs-o365*']",['https://docs.microsoft.com/en-us/powershell/module/exchange/set-dkimsigningconfig?view=exchange-ps'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Data Protection']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-dlp-policy-removed.html,Microsoft 365 Exchange DLP Policy Removededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a Data Loss Prevention (DLP) policy is removed in Microsoft 365. An adversary may remove a DLP policy to evade existing DLP monitoring.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""Remove-DlpPolicy"" andevent.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-dlppolicy?view=exchange-ps', 'https://docs.microsoft.com/en-us/microsoft-365/compliance/data-loss-prevention-policies?view=o365-worldwide']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-malware-filter-policy-deletion.html,Microsoft 365 Exchange Malware Filter Policy Deletionedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a malware filter policy has been deleted in Microsoft 365. A malware filter policy is used to alert administrators that an internal user sent a message that contained malware. This may indicate an account or machine compromise that would need to be investigated. Deletion of a malware filter policy may be done to evade detection.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""Remove-MalwareFilterPolicy"" andevent.outcome:success","['filebeat-*', 'logs-o365*']",['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-malwarefilterpolicy?view=exchange-ps'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-malware-filter-rule-modification.html,Microsoft 365 Exchange Malware Filter Rule Modificationedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a malware filter rule has been deleted or disabled in Microsoft 365. An adversary or insider threat may want to modify a malware filter rule to evade detection.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:(""Remove-MalwareFilterRule"" or""Disable-MalwareFilterRule"") and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-malwarefilterrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/disable-malwarefilterrule?view=exchange-ps']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-management-group-role-assignment.html,Microsoft 365 Exchange Management Group Role Assignmentedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when a new role is assigned to a management group in Microsoft 365. An adversary may attempt to add a role in order to maintain persistence in an environment.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""New-ManagementRoleAssignment"" andevent.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/new-managementroleassignment?view=exchange-ps', 'https://docs.microsoft.com/en-us/microsoft-365/admin/add-users/about-admin-roles?view=o365-worldwide']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-safe-attachment-rule-disabled.html,Microsoft 365 Exchange Safe Attachment Rule Disablededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies when a safe attachment rule is disabled in Microsoft 365. Safe attachment rules can extend malware protections to include routing all messages and attachments without a known malware signature to a special hypervisor environment. An adversary or insider threat may disable a safe attachment rule to exfiltrate data or evade defenses.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""Disable-SafeAttachmentRule"" andevent.outcome:success","['filebeat-*', 'logs-o365*']",['https://docs.microsoft.com/en-us/powershell/module/exchange/disable-safeattachmentrule?view=exchange-ps'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-safe-link-policy-disabled.html,Microsoft 365 Exchange Safe Link Policy Disablededit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies when a Safe Link policy is disabled in Microsoft 365. Safe Link policies for Office applications extend phishing protection to documents that contain hyperlinks, even after they have been delivered to a user.",['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""Disable-SafeLinksRule"" andevent.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/disable-safelinksrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/atp-safe-links?view=o365-worldwide']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-transport-rule-creation.html,Microsoft 365 Exchange Transport Rule Creationedit,['Exfiltration'],['TA0010'],['Transfer Data to Cloud Account'],['T1537'],Identifies a transport rule creation in Microsoft 365. Exchange Online mail transport rules should be set to not forward email to domains outside of your organization as a best practice. An adversary may create transport rules to exfiltrate data.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""New-TransportRule"" andevent.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/new-transportrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/mail-flow-rules']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-exchange-transport-rule-modification.html,Microsoft 365 Exchange Transport Rule Modificationedit,['Exfiltration'],['TA0010'],['Transfer Data to Cloud Account'],['T1537'],Identifies when a transport rule has been disabled or deleted in Microsoft 365. Mail flow rules (also known as transport rules) are used to identify and take action on messages that flow through your organization. An adversary or insider threat may modify a transport rule to exfiltrate data or evade defenses.,['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:(""Remove-TransportRule"" or""Disable-TransportRule"") and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-transportrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/disable-transportrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/mail-flow-rules']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-new-inbox-rule-created.html,Microsoft 365 New Inbox Rule Creatededit,['Collection'],['TA0009'],['Email Collection'],['T1114'],"Identifies when a new Inbox rule is created in Microsoft 365. Inbox rules process messages in the Inbox based on conditions and take actions, such as moving a message to a specified folder or deleting a message. Adequate permissions are required on the mailbox to create an Inbox rule.",['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:""New-InboxRule"" andevent.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/responding-to-a-compromised-email-account?view=o365-worldwide', 'https://docs.microsoft.com/en-us/powershell/module/exchange/new-inboxrule?view=exchange-ps', 'https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/detect-and-remediate-outlook-rules-forms-attack?view=o365-worldwide']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-potential-ransomware-activity.html,Microsoft 365 Potential ransomware activityedit,['Impact'],['TA0040'],['Data Encrypted for Impact'],['T1486'],Identifies when Microsoft Cloud App Security reported when a user uploads files to the cloud that might be infected with ransomware.,['query'],"event.dataset:o365.audit and event.provider:SecurityComplianceCenterand event.category:web and event.action:""Potential ransomwareactivity"" and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy', 'https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-teams-custom-application-interaction-allowed.html,Microsoft 365 Teams Custom Application Interaction Allowededit,[],[],[],[],"Identifies when custom applications are allowed in Microsoft Teams. If an organization requires applications other than those available in the Teams app store, custom applications can be developed as packages and uploaded. An adversary may abuse this behavior to establish persistence in an environment.",['query'],"event.dataset:o365.audit and event.provider:MicrosoftTeams andevent.category:web and event.action:TeamsTenantSettingChanged ando365.audit.Name:""Allow sideloading and interaction of custom apps"" ando365.audit.NewValue:True and event.outcome:success","['filebeat-*', 'logs-o365*']",['https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/deploy-and-publish/apps-upload'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-teams-external-access-enabled.html,Microsoft 365 Teams External Access Enablededit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when external access is enabled in Microsoft Teams. External access lets Teams and Skype for Business users communicate with other users that are outside their organization. An adversary may enable external access or add an allowed domain to exfiltrate data or maintain persistence in an environment.,['query'],"event.dataset:o365.audit and event.provider:(SkypeForBusiness orMicrosoftTeams) and event.category:web and event.action:""Set-CsTenantFederationConfiguration"" ando365.audit.Parameters.AllowFederatedUsers:True andevent.outcome:success","['filebeat-*', 'logs-o365*']",['https://docs.microsoft.com/en-us/microsoftteams/manage-external-access'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-teams-guest-access-enabled.html,Microsoft 365 Teams Guest Access Enablededit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when guest access is enabled in Microsoft Teams. Guest access in Teams allows people outside the organization to access teams and channels. An adversary may enable guest access to maintain persistence in an environment.,['query'],"event.dataset:o365.audit and event.provider:(SkypeForBusiness orMicrosoftTeams) and event.category:web and event.action:""Set-CsTeamsClientConfiguration"" ando365.audit.Parameters.AllowGuestUser:True and event.outcome:success","['filebeat-*', 'logs-o365*']",['https://docs.microsoft.com/en-us/powershell/module/skype/get-csteamsclientconfiguration?view=skype-ps'],"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-unusual-volume-of-file-deletion.html,Microsoft 365 Unusual Volume of File Deletionedit,['Impact'],['TA0040'],['Data Destruction'],['T1485'],Identifies that a user has deleted an unusually large volume of files  as reported by Microsoft Cloud App Security.,['query'],"event.dataset:o365.audit and event.provider:SecurityComplianceCenterand event.category:web and event.action:""Unusual volume of filedeletion"" and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy', 'https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-365-user-restricted-from-sending-email.html,Microsoft 365 User Restricted from Sending Emailedit,['Initial Access'],['TA0001'],['Valid Accounts'],['T1078'],Identifies when a user has been restricted from sending email due to exceeding sending limits of the service policies per the Security Compliance Center.,['query'],"event.dataset:o365.audit and event.provider:SecurityComplianceCenterand event.category:web and event.action:""User restricted from sendingemail"" and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy', 'https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/microsoft-build-engine-loading-windows-credential-libraries.html,Microsoft Build Engine Loading Windows Credential Librariesedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],"An instance of MSBuild, the Microsoft Build Engine, loaded DLLs (dynamically linked libraries) responsible for Windows credential management. This technique is sometimes used for credential dumping.",['eql'],"sequence by process.entity_id [process where event.type == ""start""and (process.name : ""MSBuild.exe"" or process.pe.original_file_name ==""MSBuild.exe"")] [library where dll.name : (""vaultcli.dll"",""SAMLib.DLL"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-build-engine-started-an-unusual-process.html,Microsoft Build Engine Started an Unusual Processedit,['Defense Evasion'],['TA0005'],['Obfuscated Files or Information'],['T1027'],"An instance of MSBuild, the Microsoft Build Engine, started a PowerShell script or the Visual C# Command Line Compiler. This technique is sometimes used to deploy a malicious payload using the Build Engine.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""MSBuild.exe"" and process.name : (""csc.exe"",""iexplore.exe"", ""powershell.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://blog.talosintelligence.com/2020/02/building-bypass-with-msbuild.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/microsoft-build-engine-started-by-a-script-process.html,Microsoft Build Engine Started by a Script Processedit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']",['Trusted Developer Utilities Proxy Execution'],['T1127'],"An instance of MSBuild, the Microsoft Build Engine, was started by a script or the Windows command interpreter. This behavior is unusual and is sometimes used by malicious payloads.",['eql'],"process where event.type == ""start"" and (process.name :""MSBuild.exe"" or process.pe.original_file_name == ""MSBuild.exe"") andprocess.parent.name : (""cmd.exe"", ""powershell.exe"", ""pwsh.exe"",""powershell_ise.exe"", ""cscript.exe"", ""wscript.exe"", ""mshta.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/microsoft-build-engine-started-by-a-system-process.html,Microsoft Build Engine Started by a System Processedit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']",['Trusted Developer Utilities Proxy Execution'],['T1127'],"An instance of MSBuild, the Microsoft Build Engine, was started by Explorer or the WMI (Windows Management Instrumentation) subsystem. This behavior is unusual and is sometimes used by malicious payloads.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""MSBuild.exe"" and process.parent.name :(""explorer.exe"", ""wmiprvse.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/microsoft-build-engine-started-by-an-office-application.html,Microsoft Build Engine Started by an Office Applicationedit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']",['Trusted Developer Utilities Proxy Execution'],['T1127'],"An instance of MSBuild, the Microsoft Build Engine, was started by Excel or Word. This is unusual behavior for the Build Engine and could have been caused by an Excel or Word document executing a malicious script payload.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""MSBuild.exe"" and process.parent.name :(""eqnedt32.exe"", ""excel.exe"",""fltldr.exe"", ""msaccess.exe"",""mspub.exe"", ""outlook.exe"",""powerpnt.exe"", ""winword.exe"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://blog.talosintelligence.com/2020/02/building-bypass-with-msbuild.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/microsoft-build-engine-using-an-alternate-name.html,Microsoft Build Engine Using an Alternate Nameedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],"An instance of MSBuild, the Microsoft Build Engine, was started after being renamed. This is uncommon behavior and may indicate an attempt to run unnoticed or undetected.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.pe.original_file_name == ""MSBuild.exe"" and not process.name: ""MSBuild.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/microsoft-exchange-server-um-spawning-suspicious-processes.html,Microsoft Exchange Server UM Spawning Suspicious Processesedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],Identifies suspicious processes being spawned by the Microsoft Exchange Server Unified Messaging (UM) service. This activity has been observed exploiting CVE-2021-26857.,['eql'],"process where event.type == ""start"" and process.parent.name :(""UMService.exe"", ""UMWorkerProcess.exe"") and not process.name :(""werfault.exe"", ""wermgr.exe"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers', 'https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-exchange-server-um-writing-suspicious-files.html,Microsoft Exchange Server UM Writing Suspicious Filesedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],Identifies suspicious files being written by the Microsoft Exchange Server Unified Messaging (UM) service. This activity has been observed exploiting CVE-2021-26858.,['eql'],"file where event.type == ""creation"" and process.name :(""UMWorkerProcess.exe"", ""umservice.exe"") and file.extension :(""php"", ""jsp"", ""js"", ""aspx"", ""asmx"", ""asax"", ""cfm"", ""shtml"") and (file.path : ""?:\\inetpub\\wwwroot\\aspnet_client\\*"" or(file.path : ""?:\\*\\Microsoft\\ExchangeServer*\\FrontEnd\\HttpProxy\\owa\\auth\\*"" and not (file.path: ""?:\\*\\Microsoft\\ExchangeServer*\\FrontEnd\\HttpProxy\\owa\\auth\\version\\*"" orfile.name : (""errorFE.aspx"", ""expiredpassword.aspx"", ""frowny.aspx"",""GetIdToken.htm"", ""logoff.aspx"", ""logon.aspx"",""OutlookCN.aspx"", ""RedirSuiteServiceProxy.aspx"", ""signout.aspx""))) or(file.path : ""?:\\*\\Microsoft\\ExchangeServer*\\FrontEnd\\HttpProxy\\ecp\\auth\\*"" and not file.name :""TimeoutLogoff.aspx"") )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers', 'https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-exchange-worker-spawning-suspicious-processes.html,Microsoft Exchange Worker Spawning Suspicious Processesedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],Identifies suspicious processes being spawned by the Microsoft Exchange Server worker process (w3wp). This activity may indicate exploitation activity or access to an existing web shell backdoor.,['eql'],"process where event.type == ""start"" and process.parent.name :""w3wp.exe"" and process.parent.args : ""MSExchange*AppPool"" and(process.name : (""cmd.exe"", ""powershell.exe"", ""pwsh.exe"",""powershell_ise.exe"") or process.pe.original_file_name in(""cmd.exe"", ""powershell.exe"", ""pwsh.dll"", ""powershell_ise.exe""))","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers', 'https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities', 'https://discuss.elastic.co/t/detection-and-response-for-hafnium-activity/266289']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-iis-connection-strings-decryption.html,Microsoft IIS Connection Strings Decryptionedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],"Identifies use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command.",['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""aspnet_regiis.exe"" or process.pe.original_file_name== ""aspnet_regiis.exe"") and process.args : ""connectionStrings"" andprocess.args : ""-pdf""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://blog.netspi.com/decrypting-iis-passwords-to-break-out-of-the-dmz-part-1/', 'https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/greenbug-espionage-telco-south-asia']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/microsoft-iis-service-account-password-dumped.html,Microsoft IIS Service Account Password Dumpededit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],"Identifies the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords. An attacker with IIS web server access via a web shell can decrypt and dump the IIS AppPool service account password using AppCmd.",['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""appcmd.exe"" or process.pe.original_file_name ==""appcmd.exe"") and process.args : ""/list"" and process.args :""/text*password""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://blog.netspi.com/decrypting-iis-passwords-to-break-out-of-the-dmz-part-1/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/mimikatz-memssp-log-file-detected.html,Mimikatz Memssp Log File Detectededit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies the password log file from the default Mimikatz memssp module.,['eql'],"file where file.name : ""mimilsa.log"" and process.name : ""lsass.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/modification-of-amsienable-registry-key.html,Modification of AmsiEnable Registry Keyedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"JScript tries to query the AmsiEnable registry key from the HKEY_USERS registry hive before initializing Antimalware Scan Interface (AMSI). If this key is set to 0, AMSI is not enabled for the JScript process. An adversary can modify this key to disable AMSI protections.",['eql'],"registry where event.type in (""creation"", ""change"") andregistry.path: ""HKEY_USERS\\*\\Software\\Microsoft\\WindowsScript\\Settings\\AmsiEnable"" and registry.data.strings: ""0""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://hackinparis.com/data/slides/2019/talks/HIP2019-Dominic_Chell-Cracking_The_Perimeter_With_Sharpshooter.pdf', 'https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/modification-of-boot-configuration.html,Modification of Boot Configurationedit,['Impact'],['TA0040'],['Inhibit System Recovery'],['T1490'],Identifies use of bcdedit.exe to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""bcdedit.exe"" or process.pe.original_file_name ==""bcdedit.exe"") and (process.args : ""/set"" and process.args :""bootstatuspolicy"" and process.args : ""ignoreallfailures"") or(process.args : ""no"" and process.args : ""recoveryenabled"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/modification-of-dynamic-linker-preload-shared-object.html,Modification of Dynamic Linker Preload Shared Objectedit,['Privilege Escalation'],['TA0004'],['Hijack Execution Flow'],['T1574'],Identifies modification of the dynamic linker preload shared object (ld.so.preload). Adversaries may execute malicious payloads by hijacking the dynamic linker used to load libraries.,['query'],event.category:file and not event.type:deletion andfile.path:/etc/ld.so.preload,"['auditbeat-*', 'logs-endpoint.events.*']",['https://www.anomali.com/blog/rocke-evolves-its-arsenal-with-a-new-malware-family-written-in-golang'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/modification-of-environment-variable-via-launchctl.html,Modification of Environment Variable via Launchctledit,['Defense Evasion'],['TA0005'],['Hijack Execution Flow'],['T1574'],Identifies modifications to an environment variable using the built-in launchctl command. Adversaries may execute their own malicious payloads by hijacking certain environment variables to load arbitrary libraries or bypass certain restrictions.,['query'],"event.category:process and event.type:start andprocess.name:launchctl and process.args:(setenv and not (JAVA*_HOMEor RUNTIME_JAVA_HOME orDBUS_LAUNCHD_SESSION_BUS_SOCKET orANT_HOME or LG_WEBOS_TV_SDK_HOME orWEBOS_CLI_TV or EDEN_ENV)) and not process.parent.executable:(""/Applications/NoMachine.app/Contents/Frameworks/bin/nxserver.bin"" or""/usr/local/bin/kr"" or""/Applications/NoMachine.app/Contents/Frameworks/bin/nxserver.bin"" or""/Applications/IntelliJ IDEACE.app/Contents/jbr/Contents/Home/lib/jspawnhelper"")","['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/rapid7/metasploit-framework/blob/master//modules/post/osx/escalate/tccbypass.rb'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/modification-of-openssh-binaries.html,Modification of OpenSSH Binariesedit,"['Persistence', 'Credential Access']","['TA0003', 'TA0006']","['Create or Modify System Process', 'Modify Authentication Process']","['T1543', 'T1556']",Adversaries may modify SSH related binaries for persistence or credential access by patching sensitive functions to enable unauthorized access or by logging SSH credentials for exfiltration.,['query'],event.category:file and event.type:change and process.name:* and(file.path:(/usr/sbin/sshd or /usr/bin/ssh or /usr/bin/sftp or/usr/bin/scp) or file.name:libkeyutils.so) and notprocess.executable:/usr/bin/dpkg,"['auditbeat-*', 'logs-endpoint.events.*']",['https://blog.angelalonso.es/2016/09/anatomy-of-real-linux-intrusion-part-ii.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Credential Access', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/modification-of-safari-settings-via-defaults-command.html,Modification of Safari Settings via Defaults Commandedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies changes to the Safari configuration using the built-in defaults command. Adversaries may attempt to enable or disable certain Safari settings, such as enabling JavaScript from Apple Events to ease in the hijacking of the users browser.",['query'],event.category:process and event.type:start andprocess.name:defaults and process.args: (com.apple.Safari andwrite and not ( UniversalSearchEnabled orSuppressSearchSuggestions or WebKitTabToLinksPreferenceKey orShowFullURLInSmartSearchField orcom.apple.Safari.ContentPageGroupIdentifier.WebKit2TabsToLinks )),"['auditbeat-*', 'logs-endpoint.events.*']",['https://objectivebythesea.com/v2/talks/OBTS_v2_Zohar.pdf'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/modification-of-standard-authentication-module-or-configuration.html,Modification of Standard Authentication Module or Configurationedit,"['Persistence', 'Credential Access']","['TA0003', 'TA0006']","['Create or Modify System Process', 'Modify Authentication Process']","['T1543', 'T1556']",Adversaries may modify the standard authentication module for persistence via patching the normal authorization process or modifying the login configuration to allow unauthorized access or elevate privileges.,['query'],"event.category:file and event.type:change and (file.name:pam_*.soor file.path:(/etc/pam.d/* or /private/etc/pam.d/*)) andprocess.executable: (* and not ( /bin/yum or""/usr/sbin/pam-auth-update"" or /usr/libexec/packagekitd or/usr/bin/dpkg or /usr/bin/vim or/usr/libexec/xpcproxy or /usr/bin/bsdtar or/usr/local/bin/brew or /usr/bin/rsync or /usr/bin/yumor /var/lib/docker/*/bin/yum or/var/lib/docker/*/bin/dpkg or./merged/var/lib/docker/*/bin/dpkg or ""/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service"" ) ) andnot file.path: ( /tmp/snap.rootfs_*/pam_*.so or/tmp/newroot/lib/*/pam_*.so or /private/var/folders/*/T/com.apple.fileprovider.ArchiveService/TemporaryItems/*/lib/security/pam_*.so or /tmp/newroot/usr/lib64/security/pam_*.so )","['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/zephrax/linux-pam-backdoor', 'https://github.com/eurialo/pambd', 'http://0x90909090.blogspot.com/2016/06/creating-backdoor-in-pam-in-5-line-of.html', 'https://www.trendmicro.com/en_us/research/19/i/skidmap-linux-malware-uses-rootkit-capabilities-to-hide-cryptocurrency-mining-payload.html']","['Elastic', 'Host', 'macOS', 'Linux', 'Threat Detection', 'Credential Access', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/modification-of-wdigest-security-provider.html,Modification of WDigest Security Provideredit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],"Identifies attempts to modify the WDigest security provider in the registry to force the users password to be stored in clear text in memory. This behavior can be indicative of an adversary attempting to weaken the security configuration of an endpoint. Once the UseLogonCredential value is modified, the adversary may attempt to dump clear text passwords from memory.",['eql'],"registry where event.type in (""creation"", ""change"") and registry.path:""HKLM\\SYSTEM\\*ControlSet*\\Control\\SecurityProviders\\WDigest\\UseLogonCredential"" and registry.data.strings:""1""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.csoonline.com/article/3438824/how-to-detect-and-halt-credential-theft-via-windows-wdigest.html', 'https://www.praetorian.com/blog/mitigating-mimikatz-wdigest-cleartext-credential-theft?edition=2019']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/modification-or-removal-of-an-okta-application-sign-on-policy.html,Modification or Removal of an Okta Application Sign-On Policyedit,[],[],[],[],Detects attempts to modify or delete a sign on policy for an Okta application. An adversary may attempt to modify or delete the sign on policy for an Okta application in order to remove or weaken an organizations security controls.,['query'],event.dataset:okta.system andevent.action:(application.policy.sign_on.update orapplication.policy.sign_on.rule.delete),"['filebeat-*', 'logs-okta*']","['https://help.okta.com/en/prod/Content/Topics/Security/App_Based_Signon.htm', 'https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/mounting-hidden-or-webdav-remote-shares.html,Mounting Hidden or WebDav Remote Sharesedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies the use of net.exe to mount a WebDav or hidden remote share. This may indicate lateral movement or preparation for data exfiltration.,['eql'],"process where event.type in (""start"", ""process_started"") and((process.name : ""net.exe"" or process.pe.original_file_name ==""net.exe"") or ((process.name : ""net1.exe"" orprocess.pe.original_file_name == ""net1.exe"") and notprocess.parent.name : ""net.exe"")) and process.args : ""use"" and /*including hidden and webdav based online shares such as onedrive */process.args : (""\\\\*\\*$*"", ""\\\\*@SSL\\*"", ""http*"") and /*excluding shares deletion operation */ not process.args : ""/d*""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/msbuild-making-network-connections.html,MsBuild Making Network Connectionsedit,['Defense Evasion'],['TA0005'],['Trusted Developer Utilities Proxy Execution'],['T1127'],Identifies MsBuild.exe making outbound network connections. This may indicate adversarial activity as MsBuild is often leveraged by adversaries to execute code and evade detection.,['eql'],"sequence by process.entity_id [process where process.name :""MSBuild.exe"" and event.type == ""start""] [network where process.name: ""MSBuild.exe"" and not cidrmatch(destination.ip, ""127.0.0.1"",""::1"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/mshta-making-network-connections.html,Mshta Making Network Connectionsedit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],"Identifies Mshta.exe making outbound network connections. This may indicate adversarial activity, as Mshta is often leveraged by adversaries to execute malicious scripts and evade detection.",['eql'],"sequence by process.entity_id with maxspan=10m [process whereevent.type in (""start"", ""process_started"") and process.name :""mshta.exe"" and not process.parent.name :""Microsoft.ConfigurationManagement.exe"" and not(process.parent.executable : ""C:\\Amazon\\AmazonAssistant\\amazonAssistantService.exe"" orprocess.parent.executable : ""C:\\TeamViewer\\TeamViewer.exe"") andnot process.args : ""ADSelfService_Enroll.hta""] [network whereprocess.name : ""mshta.exe""]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/multi-factor-authentication-disabled-for-an-azure-user.html,Multi-Factor Authentication Disabled for an Azure Useredit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when multi-factor authentication (MFA) is disabled for an Azure user account. An adversary may disable MFA for a user account in order to weaken the authentication requirements for the account.,['query'],"event.dataset:azure.auditlogs andazure.auditlogs.operation_name:""Disable Strong Authentication"" andevent.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",N/A,"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/ntds-or-sam-database-file-copied.html,NTDS or SAM Database File Copiededit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies a copy operation of the Active Directory Domain Database (ntds.dit) or Security Account Manager (SAM) files. Those files contain sensitive information including hashed domain and/or local credentials.,['eql'],"process where event.type in (""start"", ""process_started"") and ((process.pe.original_file_name in (""Cmd.Exe"", ""PowerShell.EXE"",""XCOPY.EXE"") and process.args : (""copy"", ""xcopy"", ""Copy-Item"",""move"", ""cp"", ""mv"") ) or (process.pe.original_file_name :""esentutl.exe"" and process.args : (""*/y*"", ""*/vss*"", ""*/d*"")) ) andprocess.args : (""*\\ntds.dit"", ""*\\config\\SAM"",""\\*\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*\\*"",""*/system32/config/SAM*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://thedfirreport.com/2020/11/23/pysa-mespinoza-ransomware/', 'https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/net-command-via-system-account.html,Net command via SYSTEM accountedit,['Discovery'],['TA0007'],['System Owner/User Discovery'],['T1033'],Identifies the SYSTEM account using an account discovery utility. This could be a sign of discovery activity after an adversary has achieved privilege escalation.,['eql'],"process where event.type in (""start"", ""process_started"") anduser.id in (""S-1-5-18"", ""S-1-5-19"", ""S-1-5-20"") and process.name :""whoami.exe"" or (process.name : ""net1.exe"" and notprocess.parent.name : ""net.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/netcat-network-activity.html,Netcat Network Activityedit,[],[],[],[],A netcat process is engaging in network activity on a Linux host. Netcat is often used as a persistence mechanism by exporting a reverse shell or by serving a shell on a listening port. Netcat is also sometimes used for data exfiltration.,['eql'],"sequence by process.entity_id [process where (process.name == ""nc""or process.name == ""ncat"" or process.name == ""netcat"" orprocess.name == ""netcat.openbsd"" or process.name ==""netcat.traditional"") and event.type == ""start""] [network where(process.name == ""nc"" or process.name == ""ncat"" or process.name ==""netcat"" or process.name == ""netcat.openbsd"" orprocess.name == ""netcat.traditional"")]","['auditbeat-*', 'logs-endpoint.events.*']","['http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet', 'https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf', 'https://en.wikipedia.org/wiki/Netcat']","['Elastic', 'Host', 'Linux', 'Threat Detection']"
https://www.elastic.co/guide/en/security/7.16/network-connection-via-certutil.html,Network Connection via Certutiledit,['Command and Control'],['TA0011'],['Ingress Tool Transfer'],['T1105'],"Identifies certutil.exe making a network connection. Adversaries could abuse certutil.exe to download a certificate, or malware, from a remote URL.",['eql'],"sequence by process.entity_id [process where process.name :""certutil.exe"" and event.type == ""start""] [network whereprocess.name : ""certutil.exe"" and not cidrmatch(destination.ip,""10.0.0.0/8"", ""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"",""192.0.0.0/24"", ""192.0.0.0/29"",""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"", ""192.0.0.170/32"",""192.0.0.171/32"", ""192.0.2.0/24"", ""192.31.196.0/24"",""192.52.193.0/24"", ""192.168.0.0/16"",""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"", ""192.175.48.0/24"",""198.18.0.0/15"", ""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"",""::1"", ""FE80::/10"", ""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/network-connection-via-compiled-html-file.html,Network Connection via Compiled HTML Fileedit,"['Execution', 'Defense Evasion']","['TA0002', 'TA0005']","['User Execution', 'Signed Binary Proxy Execution']","['T1204', 'T1218']",Compiled HTML files (.chm) are commonly distributed as part of the Microsoft HTML Help system. Adversaries may conceal malicious code in a CHM file and deliver it to a victim for execution. CHM content is loaded by the HTML Help executable program (hh.exe).,['eql'],"sequence by process.entity_id [process where process.name : ""hh.exe""and event.type == ""start""] [network where process.name : ""hh.exe""and not cidrmatch(destination.ip, ""10.0.0.0/8"", ""127.0.0.0/8"",""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"",""192.31.196.0/24"", ""192.52.193.0/24"", ""192.168.0.0/16"",""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"",""198.18.0.0/15"", ""198.51.100.0/24"",""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"", ""FE80::/10"",""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/network-connection-via-msxsl.html,Network Connection via MsXsledit,['Defense Evasion'],['TA0005'],['XSL Script Processing'],['T1220'],Identifies msxsl.exe making a network connection. This may indicate adversarial activity as msxsl.exe is often leveraged by adversaries to execute malicious scripts and evade detection.,['eql'],"sequence by process.entity_id [process where process.name :""msxsl.exe"" and event.type == ""start""] [network where process.name :""msxsl.exe"" and not cidrmatch(destination.ip, ""10.0.0.0/8"",""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"",""192.31.196.0/24"", ""192.52.193.0/24"", ""192.168.0.0/16"",""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"",""198.18.0.0/15"", ""198.51.100.0/24"",""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"", ""FE80::/10"",""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/network-connection-via-registration-utility.html,Network Connection via Registration Utilityedit,"['Execution', 'Defense Evasion']","['TA0002', 'TA0005']",['Signed Binary Proxy Execution'],['T1218'],"Identifies the native Windows tools regsvr32.exe, regsvr64.exe, RegSvcs.exe, or RegAsm.exe making a network connection. This may be indicative of an attacker bypassing allowlists or running arbitrary scripts via a signed Microsoft binary.",['eql'],"sequence by process.entity_id [process where event.type == ""start""and process.name : (""regsvr32.exe"", ""RegAsm.exe"", ""RegSvcs.exe"")and not ( user.id == ""S-1-5-18"" and(process.parent.name : ""msiexec.exe"" or process.parent.executable :(""C:\\Program Files (x86)\\*.exe"", ""C:\\Program Files\\*.exe""))) ] [network where process.name : (""regsvr32.exe"", ""RegAsm.exe"",""RegSvcs.exe"") and not cidrmatch(destination.ip, ""10.0.0.0/8"",""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"",""192.31.196.0/24"", ""192.52.193.0/24"", ""192.168.0.0/16"",""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"",""198.18.0.0/15"", ""198.51.100.0/24"",""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"", ""FE80::/10"",""FF00::/8"") and network.protocol != ""dns""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/network-connection-via-signed-binary.html,Network Connection via Signed Binaryedit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']",['Signed Binary Proxy Execution'],['T1218'],Binaries signed with trusted digital certificates can execute on Windows systems protected by digital signature validation. Adversaries may use these binaries to live off the land and execute malicious files that could bypass application allowlists and signature validation.,['eql'],"sequence by process.entity_id [process where (process.name :""expand.exe"" or process.name : ""extrac32.exe"" orprocess.name : ""ieexec.exe"" or process.name : ""makecab.exe"") andevent.type == ""start""] [network where (process.name : ""expand.exe""or process.name : ""extrac32.exe"" or process.name :""ieexec.exe"" or process.name : ""makecab.exe"") and notcidrmatch(destination.ip, ""10.0.0.0/8"", ""127.0.0.0/8"",""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"", ""192.0.0.0/29"",""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"", ""192.31.196.0/24"",""192.52.193.0/24"", ""192.168.0.0/16"", ""192.88.99.0/24"", ""224.0.0.0/4"",""100.64.0.0/10"", ""192.175.48.0/24"", ""198.18.0.0/15"",""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"",""FE80::/10"", ""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/network-logon-provider-registry-modification.html,Network Logon Provider Registry Modificationedit,"['Credential Access', 'Persistence']","['TA0006', 'TA0003']","['Modify Authentication Process', 'Create or Modify System Process']","['T1556', 'T1543']",Adversaries may register a rogue network logon provider module for persistence and/or credential access via intercepting the authentication credentials in clear text during user logon.,['eql'],"registry where registry.data.strings != null and registry.path : ""HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\NetworkProvider\\ProviderPath""and /* Excluding default NetworkProviders RDPNP, LanmanWorkstationand webclient. */ not ( user.id : ""S-1-5-18"" andregistry.data.strings in(""%SystemRoot%\\System32\\ntlanman.dll"",""%SystemRoot%\\System32\\drprov.dll"",""%SystemRoot%\\System32\\davclnt.dll"") )","['auditbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://github.com/gtworek/PSBits/tree/master/PasswordStealing/NPPSpy', 'https://docs.microsoft.com/en-us/windows/win32/api/npapi/nf-npapi-nplogonnotify']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/network-traffic-to-rare-destination-country.html,Network Traffic to Rare Destination Countryedit,[],[],[],[],"A machine learning job detected a rare destination country name in the network logs. This can be due to initial access, persistence, command-and-control, or exfiltration activity. For example, when a user clicks on a link in a phishing email or opens a malicious document, a request may be sent to download and run a payload from a server in a country which does not normally appear in network traffic or business work-flows. Malware instances and persistence mechanisms may communicate with command-and-control (C2) infrastructure in their country of origin, which may be an unusual destination country for the source network.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/new-activesyncalloweddeviceid-added-via-powershell.html,New ActiveSyncAllowedDeviceID Added via PowerShelledit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies the use of the Exchange PowerShell cmdlet, Set-CASMailbox, to add a new ActiveSync allowed device. Adversaries may target user email to collect sensitive information.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name: (""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"") andprocess.args : ""Set-CASMailbox*ActiveSyncAllowedDeviceIDs*""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/', 'https://docs.microsoft.com/en-us/powershell/module/exchange/set-casmailbox?view=exchange-ps']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/new-or-modified-federation-domain.html,New or Modified Federation Domainedit,['Privilege Escalation'],['TA0004'],['Domain Policy Modification'],['T1484'],"Identifies a new or modified federation domain, which can be used to create a trust between O365 and an external identity provider.",['query'],"event.dataset:o365.audit and event.provider:Exchange andevent.category:web and event.action:(""Set-AcceptedDomain"" or ""Set-MsolDomainFederationSettings"" or ""Add-FederatedDomain"" or ""New-AcceptedDomain"" or ""Remove-AcceptedDomain"" or ""Remove-FederatedDomain"") and event.outcome:success","['filebeat-*', 'logs-o365*']","['https://docs.microsoft.com/en-us/powershell/module/exchange/remove-accepteddomain?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/remove-federateddomain?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/new-accepteddomain?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/add-federateddomain?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/exchange/set-accepteddomain?view=exchange-ps', 'https://docs.microsoft.com/en-us/powershell/module/msonline/set-msoldomainfederationsettings?view=azureadps-1.0']","['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/nping-process-activity.html,Nping Process Activityedit,[],[],[],[],"Nping ran on a Linux host. Nping is part of the Nmap tool suite and has the ability to construct raw packets for a wide variety of security testing applications, including denial of service testing.",['query'],event.category:process and event.type:(start or process_started) andprocess.name:nping,"['auditbeat-*', 'logs-endpoint.events.*']",['https://en.wikipedia.org/wiki/Nmap'],"['Elastic', 'Host', 'Linux', 'Threat Detection']"
https://www.elastic.co/guide/en/security/7.16/nullsessionpipe-registry-modification.html,NullSessionPipe Registry Modificationedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies NullSessionPipe registry modifications that specify which pipes can be accessed anonymously. This could be indicative of adversary lateral movement preparation by making the added pipe available to everyone.,['eql'],"registry where registry.path : ""HKLM\\SYSTEM\\*ControlSet*\\services\\LanmanServer\\Parameters\\NullSessionPipes"" and registry.data.strings!= null","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/', 'https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-access-restrict-anonymous-access-to-named-pipes-and-shares']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/o365-excessive-single-sign-on-logon-errors.html,O365 Excessive Single Sign-On Logon Errorsedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],Identifies accounts with a high number of single sign-on (SSO) logon errors. Excessive logon errors may indicate an attempt to brute force a password or SSO token.,['threshold'],"event.dataset:o365.audit and event.provider:AzureActiveDirectory andevent.category:web ando365.audit.LogonError:""SsoArtifactInvalidOrExpired""","['filebeat-*', 'logs-o365*']",N/A,"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/o365-exchange-suspicious-mailbox-right-delegation.html,O365 Exchange Suspicious Mailbox Right Delegationedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies the assignment of rights to accesss content from another mailbox. An adversary may use the compromised account to send messages to other accounts in the network of the target business while creating inbox rules, so messages can evade spam/phishing detection mechanisms.",['query'],event.dataset:o365.audit and event.provider:Exchange andevent.action:Add-MailboxPermission ando365.audit.Parameters.AccessRights:(FullAccess or SendAs orSendOnBehalf) and event.outcome:success,"['filebeat-*', 'logs-o365*']",N/A,"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/okta-brute-force-or-password-spraying-attack.html,Okta Brute Force or Password Spraying Attackedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],"Identifies a high number of failed Okta user authentication attempts from a single IP address, which could be indicative of a brute force or password spraying attack. An adversary may attempt a brute force or password spraying attack to obtain unauthorized access to user accounts.",['threshold'],event.dataset:okta.system and event.category:authentication andevent.outcome:failure,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/outbound-scheduled-task-activity-via-powershell.html,Outbound Scheduled Task Activity via PowerShelledit,['Execution'],['TA0002'],['Scheduled Task/Job'],['T1053'],Identifies the PowerShell process loading the Task Scheduler COM DLL followed by an outbound RPC network connection within a short time period. This may indicate lateral movement or remote discovery via scheduled tasks.,['eql'],"sequence by host.id, process.entity_id with maxspan = 5s [librarywhere dll.name : ""taskschd.dll"" and process.name : (""powershell.exe"",""pwsh.exe"", ""powershell_ise.exe"")] [network where process.name :(""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"") anddestination.port == 135 and not destination.address in (""127.0.0.1"",""::1"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/parent-process-pid-spoofing.html,Parent Process PID Spoofingedit,['Defense Evasion'],['TA0005'],['Access Token Manipulation'],['T1134'],Identifies parent process spoofing used to thwart detection. Adversaries may spoof the parent process identifier (PPID) of a new process to evade process-monitoring defenses or to elevate privileges.,['eql'],"/* This rule is compatible with Elastic Endpoint only */ sequence byhost.id, user.id with maxspan=5m [process where event.type == ""start""and process.Ext.token.integrity_level_name != ""system"" and (process.pe.original_file_name : (""winword.exe"", ""excel.exe"",""outlook.exe"", ""powerpnt.exe"", ""eqnedt32.exe"",""fltldr.exe"", ""mspub.exe"", ""msaccess.exe"", ""powershell.exe"",""pwsh.exe"", ""cscript.exe"",""wscript.exe"", ""rundll32.exe"", ""regsvr32.exe"", ""msbuild.exe"",""mshta.exe"", ""wmic.exe"", ""cmstp.exe"", ""msxsl.exe"") orprocess.executable : (""?:\\Users\\*.exe"",""?:\\ProgramData\\*.exe"",""?:\\Windows\\Microsoft.NET\\*.exe"",""?:\\Windows\\Temp\\*.exe"",""?:\\Windows\\Tasks\\*"") or process.code_signature.trusted != true) ] by process.pid [process where event.type == ""start"" andprocess.parent.Ext.real.pid > 0 and /* process.parent.Ext.real.pidis only populated if the parent process pid doesn't match */ not(process.name : ""msedge.exe"" and process.parent.name : ""sihost.exe"")] by process.parent.Ext.real.pid",['logs-endpoint.events.*'],['https://blog.didierstevens.com/2017/03/20/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/peripheral-device-discovery.html,Peripheral Device Discoveryedit,['Discovery'],['TA0007'],['Peripheral Device Discovery'],['T1120'],Identifies use of the Windows file system utility (fsutil.exe ) to gather information about attached peripheral devices and components connected to a computer system.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""fsutil.exe"" or process.pe.original_file_name ==""fsutil.exe"") and process.args : ""fsinfo"" and process.args :""drives""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/permission-theft-detected-elastic-endgame.html,Permission Theft - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected Permission Theft. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and(event.action:token_protection_event orendgame.event_subtype_full:token_protection_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/permission-theft-prevented-elastic-endgame.html,Permission Theft - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented Permission Theft. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and(event.action:token_protection_event orendgame.event_subtype_full:token_protection_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-bits-job-notify-cmdline.html,Persistence via BITS Job Notify Cmdlineedit,['Persistence'],['TA0003'],['BITS Jobs'],['T1197'],An adversary can use the Background Intelligent Transfer Service (BITS) SetNotifyCmdLine method to execute a program that runs after a job finishes transferring data or after a job enters a specified state in order to persist on a system.,['eql'],"process where event.type == ""start"" and process.parent.name :""svchost.exe"" and process.parent.args : ""BITS"" and notprocess.executable :(""?:\\Windows\\System32\\WerFaultSecure.exe"",""?:\\Windows\\System32\\WerFault.exe"",""?:\\Windows\\System32\\wermgr.exe"",""?:\\WINDOWS\\system32\\directxdatabaseupdater.exe"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://pentestlab.blog/2019/10/30/persistence-bits-jobs/', 'https://docs.microsoft.com/en-us/windows/win32/api/bits1_5/nf-bits1_5-ibackgroundcopyjob2-setnotifycmdline', 'https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/bitsadmin-setnotifycmdline', '/blog/hunting-for-persistence-using-elastic-security-part-2']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-directoryservice-plugin-modification.html,Persistence via DirectoryService Plugin Modificationedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies the creation or modification of a DirectoryService PlugIns (dsplug) file. The DirectoryService daemonlaunches on each system boot and automatically reloads after crash. It scans and executes bundles that are located in the DirectoryServices PlugIns folder and can be abused by adversaries to maintain persistence.,['query'],event.category:file and not event.type:deletion andfile.path:/Library/DirectoryServices/PlugIns/*.dsplug,"['auditbeat-*', 'logs-endpoint.events.*']",['https://blog.chichou.me/2019/11/21/two-macos-persistence-tricks-abusing-plugins/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-docker-shortcut-modification.html,Persistence via Docker Shortcut Modificationedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],An adversary can establish persistence by modifying an existing macOS dock property list in order to execute a malicious application instead of the intended one when invoked.,['query'],event.category : file and event.action : modification and file.path: /Users/*/Library/Preferences/com.apple.dock.plist and notprocess.name : (xpcproxy or cfprefsd or plutil or jamf or PlistBuddyor InstallerRemotePluginService),"['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/specterops/presentations/raw/master/Leo%20Pitt/Hey_Im_Still_in_Here_Modern_macOS_Persistence_SO-CON2020.pdf'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-folder-action-script.html,Persistence via Folder Action Scriptedit,"['Persistence', 'Execution']","['TA0003', 'TA0002']","['Boot or Logon Initialization Scripts', 'Command and Scripting Interpreter']","['T1037', 'T1059']","A Folder Action script is executed when the folder to which it is attached has items added or removed, or when its window is opened, closed, moved, or resized. Adversaries may abuse this feature to establish persistence by utilizing a malicious script.",['eql'],"sequence by host.id with maxspan=5s [process where event.type in(""start"", ""process_started"", ""info"") and process.name ==""com.apple.foundation.UserScriptService""] by process.pid [processwhere event.type in (""start"", ""process_started"") and process.name in(""osascript"", ""sh"")] by process.parent.pid","['auditbeat-*', 'logs-endpoint.events.*']",['https://posts.specterops.io/folder-actions-for-persistence-on-macos-8923f222343d'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Execution', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-hidden-run-key-detected.html,Persistence via Hidden Run Key Detectededit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies a persistence mechanism that utilizes the NtSetValueKey native API to create a hidden (null terminated) registry key. An adversary may use this method to hide from system utilities such as the Registry Editor (regedit).,['eql'],"/* Registry Path ends with backslash */ registry where /*length(registry.data.strings) > 0 and */ registry.path :(""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\"",""HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\"", ""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://github.com/outflanknl/SharpHide', 'https://github.com/ewhitehats/InvisiblePersistence/blob/master/InvisibleRegValues_Whitepaper.pdf']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-kde-autostart-script-or-desktop-file-modification.html,Persistence via KDE AutoStart Script or Desktop File Modificationedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies the creation or modification of a K Desktop Environment (KDE) AutoStart script or desktop file that will execute upon each user logon. Adversaries may abuse this method for persistence.,['eql'],"file where event.type != ""deletion"" and file.extension in (""sh"",""desktop"") and file.path : (""/home/*/.config/autostart/*"", ""/root/.config/autostart/*"",""/home/*/.kde/Autostart/*"", ""/root/.kde/Autostart/*"",""/home/*/.kde4/Autostart/*"", ""/root/.kde4/Autostart/*"",""/home/*/.kde/share/autostart/*"", ""/root/.kde/share/autostart/*"",""/home/*/.kde4/share/autostart/*"", ""/root/.kde4/share/autostart/*"",""/home/*/.local/share/autostart/*"", ""/root/.local/share/autostart/*"",""/home/*/.config/autostart-scripts/*"", ""/root/.config/autostart-scripts/*"", ""/etc/xdg/autostart/*"", ""/usr/share/autostart/*"")","['auditbeat-*', 'logs-endpoint.events.*']","['https://userbase.kde.org/System_Settings/Autostart', 'https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/', 'https://www.intezer.com/blog/research/operation-electrorat-attacker-creates-fake-companies-to-drain-your-crypto-wallets/']","['Elastic', 'Host', 'Linux', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-login-or-logout-hook.html,Persistence via Login or Logout Hookedit,['Persistence'],['TA0003'],['Boot or Logon Initialization Scripts'],['T1037'],Identifies use of the Defaults command to install a login or logoff hook in MacOS. An adversary may abuse this capability to establish persistence in an environment by inserting code to be executed at login or logout.,['eql'],"process where event.type == ""start"" and process.name == ""defaults""and process.args == ""write"" and process.args in (""LoginHook"",""LogoutHook"") and not process.args : (""Support/JAMF/ManagementFrameworkScripts/logouthook.sh"",""Support/JAMF/ManagementFrameworkScripts/loginhook.sh"",""/Library/ApplicationSupport/JAMF/ManagementFrameworkScripts/logouthook.sh"",""/Library/ApplicationSupport/JAMF/ManagementFrameworkScripts/loginhook.sh"" )","['auditbeat-*', 'logs-endpoint.events.*']","['https://www.virusbulletin.com/uploads/pdf/conference_slides/2014/Wardle-VB2014.pdf', 'https://www.manpagez.com/man/1/defaults/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-microsoft-office-addins.html,Persistence via Microsoft Office AddInsedit,['Persistence'],['TA0003'],['Office Application Startup'],['T1137'],Detects attempts to establish persistence on an endpoint by abusing Microsoft Office add-ins.,['eql'],"file where event.type != ""deletion"" and file.extension :(""wll"",""xll"",""ppa"",""ppam"",""xla"",""xlam"") and file.path : (""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Word\\Startup\\*"",""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\AddIns\\*"",""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Excel\\XLSTART\\*"" )","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://labs.mwrinfosecurity.com/blog/add-in-opportunities-for-office-persistence/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-microsoft-outlook-vba.html,Persistence via Microsoft Outlook VBAedit,['Persistence'],['TA0003'],['Office Application Startup'],['T1137'],Detects attempts to establish persistence on an endpoint by installing a rogue Microsoft Outlook VBA Template.,['eql'],"file where event.type != ""deletion"" and file.path :""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Outlook\\VbaProject.OTM""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/', 'https://www.linkedin.com/pulse/outlook-backdoor-using-vba-samir-b-/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-scheduled-job-creation.html,Persistence via Scheduled Job Creationedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],A job can be used to schedule programs or scripts to be executed at a specified date and time. Adversaries may abuse task scheduling functionality to facilitate initial or recurring execution of malicious code.,['eql'],"file where event.type != ""deletion"" and file.path :""?:\\Windows\\Tasks\\*"" and file.extension : ""job""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-telemetrycontroller-scheduled-task-hijack.html,Persistence via TelemetryController Scheduled Task Hijackedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],Detects the successful hijack of Microsoft Compatibility Appraiser scheduled task to establish persistence with an integrity level of system.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""CompatTelRunner.exe"" and process.args : ""-cv*""and not process.name : (""conhost.exe"",""DeviceCensus.exe"", ""CompatTelRunner.exe"",""DismHost.exe"", ""rundll32.exe"",""powershell.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/?utm_content=131234033&utm_medium=social&utm_source=twitter&hss_channel=tw-403811306'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-update-orchestrator-service-hijack.html,Persistence via Update Orchestrator Service Hijackedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],Identifies potential hijacking of the Microsoft Update Orchestrator Service to establish persistence with an integrity level of SYSTEM.,['eql'],"process where event.type == ""start"" and process.parent.executable :""C:\\Windows\\System32\\svchost.exe"" and process.parent.args :""UsoSvc"" and not process.executable : (""C:\\Windows\\System32\\UsoClient.exe"",""C:\\Windows\\System32\\MusNotification.exe"",""C:\\Windows\\System32\\MusNotificationUx.exe"",""C:\\Windows\\System32\\MusNotifyIcon.exe"",""C:\\Windows\\System32\\WerFault.exe"",""C:\\Windows\\System32\\WerMgr.exe"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://github.com/irsl/CVE-2020-1313'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-wmi-event-subscription.html,Persistence via WMI Event Subscriptionedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"An adversary can use Windows Management Instrumentation (WMI) to install event filters, providers, consumers, and bindings that execute code when a defined event occurs. Adversaries may use the capabilities of WMI to subscribe to an event and execute arbitrary code when that event occurs, providing persistence on a system.",['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""wmic.exe"" or process.pe.original_file_name ==""wmic.exe"") and process.args : ""create"" and process.args :(""ActiveScriptEventConsumer"", ""CommandLineEventConsumer"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistence-via-wmi-standard-registry-provider.html,Persistence via WMI Standard Registry Provideredit,"['Persistence', 'Execution']","['TA0003', 'TA0002']","['Boot or Logon Autostart Execution', 'Windows Management Instrumentation']","['T1547', 'T1047']",Identifies use of the Windows Management Instrumentation StdRegProv (registry provider) to modify commonly abused registry locations for persistence.,['eql'],"registry where registry.data.strings != null and process.name :""WmiPrvSe.exe"" and registry.path : (""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*"",""HKLM\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\*"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*"", ""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*"",""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*"",""HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\ServiceDLL"",""HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\ImagePath"",""HKEY_USERS\\*\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Shell\\*"",""HKEY_USERS\\*\\Environment\\UserInitMprLogonScript"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\Load"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Shell"", ""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Shell"", ""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logoff\\Script"", ""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logon\\Script"", ""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script"",""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Startup\\Script"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\InternetExplorer\\Extensions\\*\\Exec"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\InternetExplorer\\Extensions\\*\\Script"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/previous-versions/windows/desktop/regprov/stdregprov'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/persistent-scripts-in-the-startup-directory.html,Persistent Scripts in the Startup Directoryedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],"Identifies script engines creating files in the startup folder, or the creation of script files in the startup folder.",['eql'],"file where event.type != ""deletion"" and user.domain != ""NT AUTHORITY""and /* detect shortcuts created by wscript.exe or cscript.exe */(file.path : ""C:\\*\\Programs\\Startup\\*.lnk"" and process.name :(""wscript.exe"", ""cscript.exe"")) or /* detect vbs or js filescreated by any process */ file.path :(""C:\\*\\Programs\\Startup\\*.vbs"",""C:\\*\\Programs\\Startup\\*.vbe"",""C:\\*\\Programs\\Startup\\*.wsh"",""C:\\*\\Programs\\Startup\\*.wsf"",""C:\\*\\Programs\\Startup\\*.js"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/port-forwarding-rule-addition.html,Port Forwarding Rule Additionedit,['Command and Control'],['TA0011'],['Protocol Tunneling'],['T1572'],Identifies the creation of a new port forwarding rule. An adversary may abuse this technique to bypass network segmentation restrictions.,['eql'],"registry where registry.path :""HKLM\\SYSTEM\\ControlSet*\\Services\\PortProxy\\v4tov4\\*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/possible-consent-grant-attack-via-azure-registered-application.html,Possible Consent Grant Attack via Azure-Registered Applicationedit,"['Initial Access', 'Credential Access']","['TA0001', 'TA0006']","['Phishing', 'Steal Application Access Token']","['T1566', 'T1528']","Detects when a user grants permissions to an Azure-registered application or when an administrator grants tenant-wide permissions to an application. An adversary may create an Azure-registered application that requests access to data such as contact information, email, or documents.",['query'],"event.dataset:(azure.activitylogs or azure.auditlogs or o365.audit)and ( azure.activitylogs.operation_name:""Consent toapplication"" or azure.auditlogs.operation_name:""Consent toapplication"" or o365.audit.Operation:""Consent to application."" )and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/detect-and-remediate-illicit-consent-grants?view=o365-worldwide'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/possible-fin7-dga-command-and-control-behavior.html,Possible FIN7 DGA Command and Control Behavioredit,['Command and Control'],['TA0011'],['Application Layer Protocol'],['T1071'],"This rule detects a known command and control pattern in network events. The FIN7 threat group is known to use this command and control technique, while maintaining persistence in their targets network.",['query'],"event.category:(network OR network_traffic) AND type:(tls OR http) ANDnetwork.transport:tcp ANDdestination.domain:/[a-zA-Z]{4,5}\.(pw|us|club|info|site|top)/ AND NOTdestination.domain:zoom.us","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html'],"['Elastic', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/possible-okta-dos-attack.html,Possible Okta DoS Attackedit,['Impact'],['TA0040'],['Network Denial of Service'],['T1498'],Detects possible Denial of Service (DoS) attacks against an Okta organization. An adversary may attempt to disrupt an organizations business operations by performing a DoS attack against its Okta service.,['query'],event.dataset:okta.system andevent.action:(application.integration.rate_limit_exceeded orsystem.org.rate_limit.warning or system.org.rate_limit.violation orcore.concurrency.org.limit.violation),"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/potential-admin-group-account-addition.html,Potential Admin Group Account Additionedit,['Privilege Escalation'],['TA0004'],['Valid Accounts'],['T1078'],Identifies attempts to add an account to the admin group via the command line. This could be an indication of privilege escalation activity.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:(dscl or dseditgroup) and process.args:((""/Groups/admin""or admin) and (""-a"" or ""-append""))","['auditbeat-*', 'logs-endpoint.events.*']",['https://managingosx.wordpress.com/2010/01/14/add-a-user-to-the-admin-group-via-command-line-3-0/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/potential-application-shimming-via-sdbinst.html,Potential Application Shimming via Sdbinstedit,"['Persistence', 'Privilege Escalation']","['TA0003', 'TA0004']","['Event Triggered Execution', 'Event Triggered Execution']","['T1546', 'T1546']",The Application Shim was created to allow for backward compatibility of software as the operating system codebase changes over time. This Windows functionality has been abused by attackers to stealthily gain persistence and arbitrary code execution in legitimate Windows processes.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""sdbinst.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-command-and-control-via-internet-explorer.html,Potential Command and Control via Internet Exploreredit,"['Command and Control', 'Execution']","['TA0011', 'TA0002']","['Application Layer Protocol', 'Inter-Process Communication']","['T1071', 'T1559']",Identifies instances of Internet Explorer (iexplore.exe) being started via the Component Object Model (COM) making unusual network connections. Adversaries could abuse Internet Explorer via COM to avoid suspicious processes making network connections and bypass host-based firewall restrictions.,['eql'],"sequence by host.id, user.id with maxspan = 5s [library wheredll.name : ""IEProxy.dll"" and process.name : (""rundll32.exe"",""regsvr32.exe"")] [process where event.type == ""start"" andprocess.parent.name : ""iexplore.exe"" and process.parent.args :""-Embedding""] /* IE started via COM in normal conditions makes fewconnections, mainly to Microsoft and OCSP related domains, add FPshere */ [network where network.protocol == ""dns"" and process.name :""iexplore.exe"" and not dns.question.name : (""*.microsoft.com"", ""*.digicert.com"", ""*.msocsp.com"",""*.windowsupdate.com"", ""*.bing.com"", ""*.identrust.com"",""*.sharepoint.com"", ""*.office365.com"", ""*.office.com"" )]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/potential-cookies-theft-via-browser-debugging.html,Potential Cookies Theft via Browser Debuggingedit,['Credential Access'],['TA0006'],['Steal Web Session Cookie'],['T1539'],"Identifies the execution of a Chromium based browser with the debugging process argument, which may indicate an attempt to steal authentication cookies. An adversary may steal web application or service session cookies and use them to gain access web applications or Internet services as an authenticated user without needing credentials.",['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.name in ( ""Microsoft Edge"",""chrome.exe"", ""Google Chrome"", ""google-chrome-stable"", ""google-chrome-beta"",""google-chrome"", ""msedge.exe"") and process.args : (""--remote-debugging-port=*"", ""--remote-debugging-targets=*"", ""--remote-debugging-pipe=*"") andprocess.args : ""--user-data-dir=*"" and not process.args:""--remote-debugging-port=0""","['auditbeat-*', 'winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://github.com/defaultnamehere/cookie_crimes', 'https://embracethered.com/blog/posts/2020/cookie-crimes-on-mirosoft-edge/', 'https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/gather/chrome_cookies.md', 'https://posts.specterops.io/hands-in-the-cookie-jar-dumping-cookies-with-chromiums-remote-debugger-port-34c4f468844e']","['Elastic', 'Host', 'Linux', 'Windows', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/potential-credential-access-via-duplicatehandle-in-lsass.html,Potential Credential Access via DuplicateHandle in LSASSedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies suspicious access to an LSASS handle via DuplicateHandle from an unknown call trace module. This may indicate an attempt to bypass the NtOpenProcess API to evade detection and dump Lsass memory for credential access.,['eql'],"process where event.code == ""10"" and /* LSASS requestingDuplicateHandle access right to another process */ process.name :""lsass.exe"" and winlog.event_data.GrantedAccess == ""0x40"" and /*call is coming from an unknown executable region */winlog.event_data.CallTrace : ""*UNKNOWN*""","['winlogbeat-*', 'logs-windows.*']",['https://github.com/CCob/MirrorDump'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/potential-credential-access-via-windows-utilities.html,Potential Credential Access via Windows Utilitiesedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],Identifies the execution of known Windows utilities often abused to dump LSASS memory or the Active Directory database (NTDS.dit) in preparation for credential access.,['eql'],"process where event.type in (""start"", ""process_started"") and /* updatehere with any new lolbas with dump capability */(process.pe.original_file_name == ""procdump"" and process.args : ""-ma"")or (process.name : ""ProcessDump.exe"" and not process.parent.executableregex~ """"""C:\\Program Files( \(x86\))?\\Cisco Systems\\.*"""""") or(process.pe.original_file_name == ""WriteMiniDump.exe"" and notprocess.parent.executable regex~ """"""C:\\Program Files(\(x86\))?\\Steam\\.*"""""") or (process.pe.original_file_name ==""RUNDLL32.EXE"" and (process.args : ""MiniDump*"" or process.command_line: ""*comsvcs.dll*#24*"")) or (process.pe.original_file_name ==""RdrLeakDiag.exe"" and process.args : ""/fullmemdmp"") or(process.pe.original_file_name == ""SqlDumper.exe"" and process.args :""0x01100*"") or (process.pe.original_file_name == ""TTTracer.exe"" andprocess.args : ""-dumpFull"" and process.args : ""-attach"") or(process.pe.original_file_name == ""ntdsutil.exe"" and process.args :""create*full*"") or (process.pe.original_file_name == ""diskshadow.exe""and process.args : ""/s"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://lolbas-project.github.io/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/potential-dll-side-loading-via-microsoft-antimalware-service-executable.html,Potential DLL Side-Loading via Microsoft Antimalware Service Executableedit,['Defense Evasion'],['TA0005'],['Hijack Execution Flow'],['T1574'],Identifies a Windows trusted program that is known to be vulnerable to DLL Search Order Hijacking starting after being renamed or from a non-standard path. This is uncommon behavior and may indicate an attempt to evade defenses via side-loading a malicious DLL within the memory space of one of those processes.,['eql'],"process where event.type == ""start"" and(process.pe.original_file_name == ""MsMpEng.exe"" and not process.name :""MsMpEng.exe"") or (process.name : ""MsMpEng.exe"" and notprocess.executable : (""?:\\ProgramData\\Microsoft\\WindowsDefender\\*.exe"", ""?:\\ProgramFiles\\Windows Defender\\*.exe"",""?:\\Program Files (x86)\\Windows Defender\\*.exe"",""?:\\Program Files\\Microsoft Security Client\\*.exe"",""?:\\Program Files (x86)\\Microsoft Security Client\\*.exe""))","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://news.sophos.com/en-us/2021/07/04/independence-day-revil-uses-supply-chain-exploit-to-attack-hundreds-of-businesses/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-dll-sideloading-via-trusted-microsoft-programs.html,Potential DLL SideLoading via Trusted Microsoft Programsedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],Identifies an instance of a Windows trusted program that is known to be vulnerable to DLL Search Order Hijacking starting after being renamed or from a non-standard path. This is uncommon behavior and may indicate an attempt to evade defenses via side loading a malicious DLL within the memory space of one of those processes.,['eql'],"process where event.type == ""start"" andprocess.pe.original_file_name in (""WinWord.exe"", ""EXPLORER.EXE"",""w3wp.exe"", ""DISM.EXE"") and not (process.name : (""winword.exe"",""explorer.exe"", ""w3wp.exe"", ""Dism.exe"") or process.executable: (""?:\\Windows\\explorer.exe"",""?:\\Program Files\\Microsoft Office\\root\\Office*\\WINWORD.EXE"",""?:\\Program Files?(x86)\\MicrosoftOffice\\root\\Office*\\WINWORD.EXE"",""?:\\Windows\\System32\\Dism.exe"",""?:\\Windows\\SysWOW64\\Dism.exe"",""?:\\Windows\\System32\\inetsrv\\w3wp.exe"") )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-dns-tunneling-via-iodine.html,Potential DNS Tunneling via Iodineedit,[],[],[],[],"Iodine is a tool for tunneling Internet protocol version 4 (IPV4) traffic over the DNS protocol to circumvent firewalls, network security groups, and network access lists while evading detection.",['query'],event.category:process and event.type:(start or process_started) andprocess.name:(iodine or iodined),"['auditbeat-*', 'logs-endpoint.events.*']",['https://code.kryo.se/iodine/'],"['Elastic', 'Host', 'Linux', 'Threat Detection']"
https://www.elastic.co/guide/en/security/7.16/potential-dns-tunneling-via-nslookup.html,Potential DNS Tunneling via NsLookupedit,['Command and Control'],['TA0011'],['Application Layer Protocol'],['T1071'],This rule identifies a large number (15) of nslookup.exe executions with an explicit query type from the same host. This may indicate command and control activity utilizing the DNS protocol.,['threshold'],event.category:process and event.type:start andprocess.name:nslookup.exe and process.args:(-querytype=* or -qt=* or-q=* or -type=*),"['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://unit42.paloaltonetworks.com/dns-tunneling-in-the-wild-overview-of-oilrigs-dns-tunneling/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/potential-disabling-of-selinux.html,Potential Disabling of SELinuxedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies potential attempts to disable Security-Enhanced Linux (SELinux), which is a Linux kernel security feature to support access control policies. Adversaries may disable security tools to avoid possible detection of their tools and activities.",['query'],event.category:process and event.type:(start or process_started) andprocess.name:setenforce and process.args:0,"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-evasion-via-filter-manager.html,Potential Evasion via Filter Manageredit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],The Filter Manager Control Program (fltMC.exe) binary may be abused by adversaries to unload a filter driver and evade defenses.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""fltMC.exe"" and process.args : ""unload""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-hidden-local-user-account-creation.html,Potential Hidden Local User Account Creationedit,['Persistence'],['TA0003'],['Valid Accounts'],['T1078'],Identifies attempts to create a local account that will be hidden from the macOS logon window. This may indicate an attempt to evade user attention while maintaining persistence using a separate local account.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:dscl and process.args:(IsHidden and create and (true or 1or yes)),"['auditbeat-*', 'logs-endpoint.events.*']",['https://support.apple.com/en-us/HT203998'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-kerberos-attack-via-bifrost.html,Potential Kerberos Attack via Bifrostedit,"['Lateral Movement', 'Credential Access']","['TA0008', 'TA0006']","['Use Alternate Authentication Material', 'Steal or Forge Kerberos Tickets']","['T1550', 'T1558']","Identifies use of Bifrost, a known macOS Kerberos pentesting tool, which can be used to dump cached Kerberos tickets or attempt unauthorized authentication techniques such as pass-the-ticket/hash and kerberoasting.",['query'],"event.category:process and event.type:start andprocess.args:(""-action"" and (""-kerberoast"" or askhash or asktgs orasktgt or s4u or (""-ticket"" and ptt) or (dump and (tickets orkeytab))))","['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/its-a-feature/bifrost'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/potential-lsa-authentication-package-abuse.html,Potential LSA Authentication Package Abuseedit,"['Privilege Escalation', 'Persistence']","['TA0004', 'TA0003']","['Boot or Logon Autostart Execution', 'Boot or Logon Autostart Execution']","['T1547', 'T1547']",Adversaries can use the autostart mechanism provided by the Local Security Authority (LSA) authentication packages for privilege escalation or persistence by placing a reference to a binary in the Windows registry. The binary will then be executed by SYSTEM when the authentication packages are loaded.,['eql'],"registry where event.type == ""change"" and registry.path :""HKLM\\SYSTEM\\*ControlSet*\\Control\\Lsa\\Authentication Packages""and /* exclude SYSTEM SID - look for changes by non-SYSTEM user */not user.id : ""S-1-5-18""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/potential-microsoft-office-sandbox-evasion.html,Potential Microsoft Office Sandbox Evasionedit,[],[],[],[],"Identifies the creation of a suspicious zip file prepended with special characters. Sandboxed Microsoft Office applications on macOS are allowed to write files that start with special characters, which can be combined with an AutoStart location to achieve sandbox evasion.",['query'],event.category:file and not event.type:deletion and file.name:~$*.zip,"['auditbeat-*', 'logs-endpoint.events.*']","['https://i.blackhat.com/USA-20/Wednesday/us-20-Wardle-Office-Drama-On-macOS.pdf', 'https://www.mdsec.co.uk/2018/08/escaping-the-sandbox-microsoft-office-on-macos/', 'https://desi-jarvis.medium.com/office365-macos-sandbox-escape-fcce4fa4123c']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-modification-of-accessibility-binaries.html,Potential Modification of Accessibility Binariesedit,"['Persistence', 'Privilege Escalation']","['TA0003', 'TA0004']","['Event Triggered Execution', 'Event Triggered Execution']","['T1546', 'T1546']",Windows contains accessibility features that may be launched with a key combination before a user has logged in. An adversary can modify the way these programs are launched to get a command prompt or backdoor without logging in to the system.,['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.parent.name : (""Utilman.exe"", ""winlogon.exe"") and user.name ==""SYSTEM"" and process.args : (""C:\\Windows\\System32\\osk.exe"",""C:\\Windows\\System32\\Magnify.exe"",""C:\\Windows\\System32\\Narrator.exe"",""C:\\Windows\\System32\\Sethc.exe"", ""utilman.exe"",""ATBroker.exe"", ""DisplaySwitch.exe"", ""sethc.exe"" ) andnot process.pe.original_file_name in ( ""osk.exe"",""sethc.exe"", ""utilman2.exe"", ""DisplaySwitch.exe"",""ATBroker.exe"", ""ScreenMagnifier.exe"", ""SR.exe"",""Narrator.exe"", ""magnify.exe"", ""MAGNIFY.EXE"" ) /*uncomment once in winlogbeat to avoid bypass with rogue process withmatching pe original file name */ /* andprocess.code_signature.subject_name == ""Microsoft Windows"" andprocess.code_signature.status == ""trusted"" */","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['/blog/practical-security-engineering-stateful-detection'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-openssh-backdoor-logging-activity.html,Potential OpenSSH Backdoor Logging Activityedit,"['Credential Access', 'Persistence']","['TA0006', 'TA0003']","['Modify Authentication Process', 'Compromise Client Software Binary']","['T1556', 'T1554']",Identifies a Secure Shell (SSH) client or server process creating or writing to a known SSH backdoor log file. Adversaries may modify SSH related binaries for persistence or credential access via patching sensitive functions to enable unauthorized access or to log SSH credentials for exfiltration.,['eql'],"file where event.type == ""change"" and process.executable :(""/usr/sbin/sshd"", ""/usr/bin/ssh"") and ( file.name : ("".*"",""~*"") or file.extension : (""in"", ""out"", ""ini"", ""h"", ""gz"", ""so"",""sock"", ""sync"", ""0"", ""1"", ""2"", ""3"", ""4"", ""5"", ""6"", ""7"", ""8"", ""9"") orfile.path : ( ""/private/etc/*--"", ""/usr/share/*"",""/usr/include/*"", ""/usr/local/include/*"",""/private/tmp/*"", ""/private/var/tmp/*"", ""/usr/tmp/*"",""/usr/share/man/*"", ""/usr/local/share/*"",""/usr/lib/*.so.*"", ""/private/etc/ssh/.sshd_auth"",""/usr/bin/ssd"", ""/private/var/opt/power"",""/private/etc/ssh/ssh_known_hosts"", ""/private/var/html/lol"",""/private/var/log/utmp"", ""/private/var/lib"",""/var/run/sshd/sshd.pid"", ""/var/run/nscd/ns.pid"",""/var/run/udev/ud.pid"", ""/var/run/udevd.pid"" ) )","['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/eset/malware-ioc/tree/master/sshdoor', 'https://www.welivesecurity.com/wp-content/uploads/2021/01/ESET_Kobalos.pdf']","['Elastic', 'Host', 'Linux', 'Threat Detection', 'Persistence', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/potential-password-spraying-of-microsoft-365-user-accounts.html,Potential Password Spraying of Microsoft 365 User Accountsedit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],"Identifies a high number (25) of failed Microsoft 365 user authentication attempts from a single IP address within 30 minutes, which could be indicative of a password spraying attack. An adversary may attempt a password spraying attack to obtain unauthorized access to user accounts.",['threshold'],"event.dataset:o365.audit and event.provider:(Exchange orAzureActiveDirectory) and event.category:authentication andevent.action:(""UserLoginFailed"" or""PasswordLogonInitialAuthUsingPassword"") and event.outcome:failure","['filebeat-*', 'logs-o365*']",N/A,"['Elastic', 'Cloud', 'Microsoft 365', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/potential-persistence-via-atom-init-script-modification.html,Potential Persistence via Atom Init Script Modificationedit,[],[],[],[],Identifies modifications to the Atom desktop text editor Init File. Adversaries may add malicious JavaScript code to the init.coffee file that will be executed upon the Atom application opening.,['query'],"event.category:""file"" and not event.type:""deletion"" andfile.path:/Users/*/.atom/init.coffee and not process.name:(Atom orxpcproxy) and not user.name:root","['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/D00MFist/PersistentJXA/blob/master/AtomPersist.js', 'https://flight-manual.atom.io/hacking-atom/sections/the-init-file/']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-persistence-via-login-hook.html,Potential Persistence via Login Hookedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies the creation or modification of the login window property list (plist). Adversaries may modify plist files to run a program during system boot or user login for persistence.,['query'],"event.category:""file"" and not event.type:""deletion"" andfile.name:""com.apple.loginwindow.plist"" and process.name:(* and not(systemmigrationd or DesktopServicesHelper or diskmanagementd or rsyncor launchd or cfprefsd or xpcproxy or ManagedClient or MCXCompositor))","['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/D00MFist/PersistentJXA/blob/master/LoginScript.js'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-persistence-via-periodic-tasks.html,Potential Persistence via Periodic Tasksedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],Identifies the creation or modification of the default configuration for periodic tasks. Adversaries may abuse periodic tasks to execute malicious code or maintain persistence.,['query'],"event.category:""file"" and not event.type:""deletion"" andfile.path:(/private/etc/periodic/* or/private/etc/defaults/periodic.conf or /private/etc/periodic.conf)","['auditbeat-*', 'logs-endpoint.events.*']","['https://opensource.apple.com/source/crontabs/crontabs-13/private/etc/defaults/periodic.conf.auto.html', 'https://www.oreilly.com/library/view/mac-os-x/0596003706/re328.html', 'https://github.com/D00MFist/PersistentJXA/blob/master/PeriodicPersist.js']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-persistence-via-time-provider-modification.html,Potential Persistence via Time Provider Modificationedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],"Windows operating systems are utilizing the time provider architecture in order to obtain accurate time stamps from other network devices or clients in the network. Time providers are implemented in the form of a DLL file which resides in System32 folder. The service W32Time initiates during the startup of Windows and loads w32time.dll. Adversaries may abuse this architecture to establish persistence, specifically by registering and enabling a malicious DLL as a time provider.",['eql'],"registry where event.type:""change"" and registry.path:""HKLM\\SYSTEM\\*ControlSet*\\Services\\W32Time\\TimeProviders\\*"" andregistry.data.strings:""*.dll""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://pentestlab.blog/2019/10/22/persistence-time-providers/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-port-monitor-or-print-processor-registration-abuse.html,Potential Port Monitor or Print Processor Registration Abuseedit,"['Privilege Escalation', 'Persistence']","['TA0004', 'TA0003']","['Boot or Logon Autostart Execution', 'Boot or Logon Autostart Execution']","['T1547', 'T1547']","Identifies port monitor and print processor registry modifications. Adversaries may abuse port monitor and print processors to run malicious DLLs during system boot that will be executed as SYSTEM for privilege escalation and/or persistence, if permissions allow writing a fully-qualified pathname for that DLL.",['eql'],"registry where event.type in (""creation"", ""change"") andregistry.path :(""HKLM\\SYSTEM\\*ControlSet*\\Control\\Print\\Monitors\\*"", ""HLLM\\SYSTEM\\*ControlSet*\\Control\\Print\\Environments\\Windows*\\PrintProcessors\\*"") and registry.data.strings : ""*.dll"" and /* excludeSYSTEM SID - look for changes by non-SYSTEM user */ not user.id :""S-1-5-18""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/potential-printnightmare-exploit-registry-modification.html,Potential PrintNightmare Exploit Registry Modificationedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Detects attempts to exploit privilege escalation vulnerabilities related to the Print Spooler service. For more information refer to CVE-2021-34527 and verify that the impacted system is investigated.,['eql'],"/* This rule is not compatible with Sysmon due to schema issues */registry where process.name : ""spoolsv.exe"" and (registry.path : ""HKLM\\SYSTEM\\ControlSet*\\Control\\Print\\Environments\\Windows*\\Drivers\\Version-3\\mimikatz*\\Data File"" or (registry.path : ""HKLM\\SYSTEM\\ControlSet*\\Control\\Print\\Environments\\Windows*\\Drivers\\Version-3\\*\\Configuration File"" and registry.data.strings :(""kernelbase.dll"", ""ntdll.dll"", ""kernel32.dll"", ""winhttp.dll"",""user32.dll"")))","['logs-endpoint.events.*', 'logs-windows.*']","['https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527', 'https://github.com/afwu/PrintNightmare']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/potential-printnightmare-file-modification.html,Potential PrintNightmare File Modificationedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Detects the creation or modification of a print driver with an unusual file name. This may indicate attempts to exploit privilege escalation vulnerabilities related to the Print Spooler service. For more information refer to CVE-2021-34527 and verify that the impacted system is investigated.,['eql'],"/* This rule is compatible with both Sysmon and Elastic Endpoint */file where process.name : ""spoolsv.exe"" and file.name :(""kernelbase.dll"", ""ntdll.dll"", ""kernel32.dll"", ""winhttp.dll"",""user32.dll"") and file.path :""?:\\Windows\\System32\\spool\\drivers\\x64\\3\\*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527', 'https://github.com/afwu/PrintNightmare']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/potential-privacy-control-bypass-via-localhost-secure-copy.html,Potential Privacy Control Bypass via Localhost Secure Copyedit,"['Defense Evasion', 'Privilege Escalation']","['TA0005', 'TA0004']","['Abuse Elevation Control Mechanism', 'Abuse Elevation Control Mechanism']","['T1548', 'T1548']",Identifies use of the Secure Copy Protocol (SCP) to copy files locally by abusing the auto addition of the Secure Shell Daemon (sshd) to the authorized application list for Full Disk Access. This may indicate attempts to bypass macOS privacy controls to access sensitive files.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name:""scp"" and process.args:""StrictHostKeyChecking=no"" andprocess.command_line:(""scp *localhost:/*"", ""scp *127.0.0.1:/*"") andnot process.args:""vagrant@*127.0.0.1*""","['auditbeat-*', 'logs-endpoint.events.*']",['https://blog.trendmicro.com/trendlabs-security-intelligence/xcsset-mac-malware-infects-xcode-projects-performs-uxss-attack-on-safari-other-browsers-leverages-zero-day-exploits/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Privilege Escalation', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-privacy-control-bypass-via-tccdb-modification.html,Potential Privacy Control Bypass via TCCDB Modificationedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies the use of sqlite3 to directly modify the Transparency, Consent, and Control (TCC) SQLite database. This may indicate an attempt to bypass macOS privacy controls, including access to sensitive resources like the system camera, microphone, address book, and calendar.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""sqlite*"" and process.args : ""/*/ApplicationSupport/com.apple.TCC/TCC.db""","['auditbeat-*', 'logs-endpoint.events.*']","['https://applehelpwriter.com/2016/08/29/discovering-how-dropbox-hacks-your-mac/', 'https://github.com/bp88/JSS-Scripts/blob/master/TCC.db%20Modifier.sh', 'https://medium.com/@mattshockl/cve-2020-9934-bypassing-the-os-x-transparency-consent-and-control-tcc-framework-for-4e14806f1de8']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-privilege-escalation-via-sudoers-file-modification.html,Potential Privilege Escalation via Sudoers File Modificationedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],A sudoers file specifies the commands users or groups can run and from which terminals. Adversaries can take advantage of these configurations to execute commands as other users or spawn processes with higher privileges.,['query'],event.category:process and event.type:start and process.args:(echo and*NOPASSWD*ALL*),"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/potential-process-herpaderping-attempt.html,Potential Process Herpaderping Attemptedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],Identifies process execution followed by a file overwrite of an executable by the same parent process. This may indicate an evasion attempt to execute malicious code in a stealthy way.,['eql'],"sequence with maxspan=5s [process where event.type == ""start"" andnot process.parent.executable :""C:\\Windows\\SoftwareDistribution\\*.exe""] by host.id,process.executable, process.parent.entity_id [file where event.type== ""change"" and event.action == ""overwrite"" and file.extension ==""exe""] by host.id, file.path, process.entity_id","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://github.com/jxy-s/herpaderping'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-protocol-tunneling-via-earthworm.html,Potential Protocol Tunneling via EarthWormedit,['Command and Control'],['TA0011'],['Protocol Tunneling'],['T1572'],"Identifies the execution of the EarthWorm tunneler. Adversaries may tunnel network communications to and from a victim system within a separate protocol to avoid detection and network filtering, or to enable access to otherwise unreachable systems.",['eql'],"process where event.type == ""start"" and process.args : ""-s"" andprocess.args : ""-d"" and process.args : ""rssocks""","['auditbeat-*', 'logs-endpoint.events.*']","['http://rootkiter.com/EarthWorm/', 'https://decoded.avast.io/luigicamastra/apt-group-targeting-governmental-agencies-in-east-asia/']","['Elastic', 'Host', 'Linux', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/potential-remote-desktop-shadowing-activity.html,Potential Remote Desktop Shadowing Activityedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies the modification of the Remote Desktop Protocol (RDP) Shadow registry or the execution of processes indicative of an active RDP shadowing session. An adversary may abuse the RDP Shadowing feature to spy on or control other users active RDP sessions.,['eql'],"/* Identifies the modification of RDP Shadow registry or theexecution of processes indicative of active shadow RDP session */ anywhere (event.category == ""registry"" and registry.path :""HKLM\\Software\\Policies\\Microsoft\\Windows NT\\TerminalServices\\Shadow"" ) or (event.category == ""process"" and(process.name : (""RdpSaUacHelper.exe"", ""RdpSaProxy.exe"") andprocess.parent.name : ""svchost.exe"") or(process.pe.original_file_name : ""mstsc.exe"" and process.args :""/shadow:*"") )","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://bitsadm.in/blog/spying-on-users-using-rdp-shadowing', 'https://swarm.ptsecurity.com/remote-desktop-services-shadowing/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/potential-remote-desktop-tunneling-detected.html,Potential Remote Desktop Tunneling Detectededit,['Command and Control'],['TA0011'],['Protocol Tunneling'],['T1572'],Identifies potential use of an SSH utility to establish RDP over a reverse SSH Tunnel. This can be used by attackers to enable routing of network packets that would otherwise not reach their intended destination.,['eql'],"process where event.type in (""start"", ""process_started"") and /* RDPport and usual SSH tunneling related switches in command line */process.args : ""*:3389"" and process.args : (""-L"", ""-P"", ""-R"", ""-pw"",""-ssh"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://blog.netspi.com/how-to-access-rdp-over-a-reverse-ssh-tunnel/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/potential-reverse-shell-activity-via-terminal.html,Potential Reverse Shell Activity via Terminaledit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies the execution of a shell process with suspicious arguments which may be indicative of reverse shell activity.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name in (""sh"", ""bash"", ""zsh"", ""dash"", ""zmodload"") andprocess.args:(""*/dev/tcp/*"", ""*/dev/udp/*"", ""zsh/net/tcp"",""zsh/net/udp"")","['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md', 'https://github.com/WangYihang/Reverse-Shell-Manager', 'https://www.netsparker.com/blog/web-security/understanding-reverse-shells/']","['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/potential-ssh-brute-force-detected.html,Potential SSH Brute Force Detectededit,['Credential Access'],['TA0006'],['Brute Force'],['T1110'],Identifies a high number (20) of macOS SSH KeyGen process executions from the same host. An adversary may attempt a brute force attack to obtain unauthorized access to user accounts.,['threshold'],"event.category:process and event.type:start and process.name:""sshd-keygen-wrapper"" and process.parent.name:launchd","['auditbeat-*', 'logs-endpoint.events.*']",['https://themittenmac.com/detecting-ssh-activity-via-process-monitoring/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/potential-secure-file-deletion-via-sdelete-utility.html,Potential Secure File Deletion via SDelete Utilityedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Detects file name patterns generated by the use of Sysinternals SDelete utility to securely delete a file via multiple file overwrite and rename operations.,['eql'],"file where event.type == ""change"" and file.name : ""*AAA.AAA""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/potential-sharprdp-behavior.html,Potential SharpRDP Behavioredit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies potential behavior of SharpRDP, which is a tool that can be used to perform authenticated command execution against a remote target via Remote Desktop Protocol (RDP) for the purposes of lateral movement.",['eql'],"/* Incoming RDP followed by a new RunMRU string value set to cmd,powershell, taskmgr or tsclient, followed by process execution within1m */ sequence by host.id with maxspan=1m [network where event.type== ""start"" and process.name : ""svchost.exe"" and destination.port ==3389 and network.direction : (""incoming"", ""ingress"") andnetwork.transport == ""tcp"" and source.address != ""127.0.0.1"" andsource.address != ""::1"" ] [registry where process.name :""explorer.exe"" and registry.path : (""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\\*"") andregistry.data.strings : (""cmd.exe*"", ""powershell.exe*"", ""taskmgr*"",""\\\\tsclient\\*.exe\\*"") ] [process where event.type in(""start"", ""process_started"") and (process.parent.name : (""cmd.exe"",""powershell.exe"", ""taskmgr.exe"") or process.args :(""\\\\tsclient\\*.exe"")) and not process.name : ""conhost.exe"" ]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']","['https://posts.specterops.io/revisiting-remote-desktop-lateral-movement-8fb905cb46c3', 'https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Lateral%20Movement/LM_sysmon_3_12_13_1_SharpRDP.evtx']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/potential-shell-via-web-server.html,Potential Shell via Web Serveredit,['Persistence'],['TA0003'],['Server Software Component'],['T1505'],"Identifies suspicious commands executed via a web server, which may suggest a vulnerability and remote shell access.",['query'],"event.category:process and event.type:(start or process_started) andprocess.name:(bash or dash) and user.name:(apache or nginx or www or""www-data"")","['auditbeat-*', 'logs-endpoint.events.*']",['https://pentestlab.blog/tag/web-shell/'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/potential-windows-error-manager-masquerading.html,Potential Windows Error Manager Masqueradingedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],Identifies suspicious instances of the Windows Error Reporting process (WerFault.exe or Wermgr.exe) with matching command-line and process executable values performing outgoing network connections. This may be indicative of a masquerading attempt to evade suspicious child process behavior detections.,['eql'],"sequence by host.id, process.entity_id with maxspan = 5s [processwhere event.type:""start"" and process.name : (""wermgr.exe"",""WerFault.exe"") and process.args_count == 1] [network whereprocess.name : (""wermgr.exe"", ""WerFault.exe"") and network.protocol !=""dns"" and network.direction : (""outgoing"", ""egress"") anddestination.ip !=""::1"" and destination.ip !=""127.0.0.1"" ]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://twitter.com/SBousseaden/status/1235533224337641473', 'https://www.hexacorn.com/blog/2019/09/20/werfault-command-line-switches-v0-1/', 'https://app.any.run/tasks/26051d84-b68e-4afb-8a9a-76921a271b81/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/powershell-minidump-script.html,PowerShell MiniDump Scriptedit,"['Credential Access', 'Execution']","['TA0006', 'TA0002']","['OS Credential Dumping', 'Command and Scripting Interpreter']","['T1003', 'T1059']",This rule detects PowerShell scripts that have capabilities to dump process memory using WindowsErrorReporting or Dbghelp.dll MiniDumpWriteDump. Attackers can use this tooling to dump LSASS and get access to credentials.,['query'],"event.code:""4104"" andpowershell.file.script_block_text:(MiniDumpWriteDump orMiniDumpWithFullMemory or pmuDetirWpmuDiniM)","['winlogbeat-*', 'logs-windows.*']","['https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Out-Minidump.ps1', 'https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Get-ProcessMiniDump.ps1']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/powershell-suspicious-discovery-related-windows-api-functions.html,PowerShell Suspicious Discovery Related Windows API Functionsedit,"['Discovery', 'Execution']","['TA0007', 'TA0002']","['Network Share Discovery', 'Command and Scripting Interpreter']","['T1135', 'T1059']","This rule detects the use of discovery-related Windows API Functions in Powershell Scripts. Attackers can use these functions to perform various situational awareness related activities, like enumerating users, shares, sessions, domain trusts, groups, etc.,",['query'],"event.code:""4104"" and powershell.file.script_block_text : (NetShareEnum or NetWkstaUserEnum or NetSessionEnum orNetLocalGroupEnum or NetLocalGroupGetMembers or DsGetSiteNameor DsEnumerateDomainTrusts or WTSEnumerateSessionsEx orWTSQuerySessionInformation or LsaGetLogonSessionData orQueryServiceObjectSecurity )","['winlogbeat-*', 'logs-windows.*']",['https://github.com/BC-SECURITY/Empire/blob/9259e5106986847d2bb770c4289c0c0f1adf2344/data/module_source/situational_awareness/network/powerview.ps1#L21413'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/powershell-suspicious-script-with-audio-capture-capabilities.html,PowerShell Suspicious Script with Audio Capture Capabilitiesedit,"['Collection', 'Execution']","['TA0009', 'TA0002']","['Audio Capture', 'Command and Scripting Interpreter']","['T1123', 'T1059']","Detects PowerShell Scripts that can record audio, a common feature in popular post-exploitation tooling.",['query'],"event.code:""4104"" and powershell.file.script_block_text : (Get-MicrophoneAudio or (waveInGetNumDevs and mciSendStringA) )","['winlogbeat-*', 'logs-windows.*']",['https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-MicrophoneAudio.ps1'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Collection']"
https://www.elastic.co/guide/en/security/7.16/privilege-escalation-via-named-pipe-impersonation.html,Privilege Escalation via Named Pipe Impersonationedit,['Privilege Escalation'],['TA0004'],['Access Token Manipulation'],['T1134'],Identifies a privilege escalation attempt via named pipe impersonation. An adversary may abuse this technique by utilizing a framework such Metasploits meterpreter getsystem command.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.pe.original_file_name in (""Cmd.Exe"", ""PowerShell.EXE"") andprocess.args : ""echo"" and process.args : "">"" and process.args :""\\\\.\\pipe\\*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.ired.team/offensive-security/privilege-escalation/windows-namedpipes-privilege-escalation'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/privilege-escalation-via-root-crontab-file-modification.html,Privilege Escalation via Root Crontab File Modificationedit,['Privilege Escalation'],['TA0004'],['Scheduled Task/Job'],['T1053'],Identifies modifications to the root crontab file. Adversaries may overwrite this file to gain code execution with root privileges by exploiting privileged file write or move related vulnerabilities.,['query'],event.category:file and not event.type:deletion andfile.path:/private/var/at/tabs/root and notprocess.executable:/usr/bin/crontab,"['auditbeat-*', 'logs-endpoint.events.*']","['https://phoenhex.re/2017-06-09/pwn2own-diskarbitrationd-privesc', 'https://www.exploit-db.com/exploits/42146']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/privilege-escalation-via-windir-environment-variable.html,Privilege Escalation via Windir Environment Variableedit,['Privilege Escalation'],['TA0004'],['Hijack Execution Flow'],['T1574'],Identifies a privilege escalation attempt via a rogue Windows directory (Windir) environment variable. This is a known primitive that is often combined with other vulnerabilities to elevate privileges.,['eql'],"registry where registry.path : (""HKEY_USERS\\*\\Environment\\windir"",""HKEY_USERS\\*\\Environment\\systemroot"") and notregistry.data.strings : (""C:\\windows"", ""%SystemRoot%"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.tiraniddo.dev/2017/05/exploiting-environment-variables-in.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/process-activity-via-compiled-html-file.html,Process Activity via Compiled HTML Fileedit,"['Execution', 'Defense Evasion']","['TA0002', 'TA0005']","['User Execution', 'Signed Binary Proxy Execution']","['T1204', 'T1218']",Compiled HTML files (.chm) are commonly distributed as part of the Microsoft HTML Help system. Adversaries may conceal malicious code in a CHM file and deliver it to a victim for execution. CHM content is loaded by the HTML Help executable program (hh.exe).,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""hh.exe"" and process.name : (""mshta.exe"",""cmd.exe"", ""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"",""cscript.exe"", ""wscript.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/process-execution-from-an-unusual-directory.html,Process Execution from an Unusual Directoryedit,[],[],[],[],Identifies process execution from suspicious default Windows directories. This is sometimes done by adversaries to hide malware in trusted paths.,['eql'],"process where event.type in (""start"", ""process_started"", ""info"") and/* add suspicious execution paths here */ process.executable : (""C:\\PerfLogs\\*.exe"",""C:\\Users\\Public\\*.exe"",""C:\\Users\\Default\\*.exe"",""C:\\Windows\\Tasks\\*.exe"",""C:\\Intel\\*.exe"",""C:\\AMD\\Temp\\*.exe"",""C:\\Windows\\AppReadiness\\*.exe"", ""C:\\Windows\\ServiceState\\*.exe"",""C:\\Windows\\security\\*.exe"",""C:\\Windows\\IdentityCRL\\*.exe"",""C:\\Windows\\Branding\\*.exe"",""C:\\Windows\\csc\\*.exe"",""C:\\Windows\\DigitalLocker\\*.exe"",""C:\\Windows\\en-US\\*.exe"",""C:\\Windows\\wlansvc\\*.exe"",""C:\\Windows\\Prefetch\\*.exe"",""C:\\Windows\\Fonts\\*.exe"", ""C:\\Windows\\diagnostics\\*.exe"",""C:\\Windows\\TAPI\\*.exe"",""C:\\Windows\\INF\\*.exe"",""C:\\Windows\\System32\\Speech\\*.exe"",""C:\\windows\\tracing\\*.exe"", ""c:\\windows\\IME\\*.exe"",""c:\\Windows\\Performance\\*.exe"",""c:\\windows\\intel\\*.exe"",""c:\\windows\\ms\\*.exe"",""C:\\Windows\\dot3svc\\*.exe"",""C:\\Windows\\ServiceProfiles\\*.exe"", ""C:\\Windows\\panther\\*.exe"",""C:\\Windows\\RemotePackages\\*.exe"",""C:\\Windows\\OCR\\*.exe"",""C:\\Windows\\appcompat\\*.exe"",""C:\\Windows\\apppatch\\*.exe"",""C:\\Windows\\addins\\*.exe"", ""C:\\Windows\\Setup\\*.exe"",""C:\\Windows\\Help\\*.exe"",""C:\\Windows\\SKB\\*.exe"",""C:\\Windows\\Vss\\*.exe"",""C:\\Windows\\Web\\*.exe"",""C:\\Windows\\servicing\\*.exe"",""C:\\Windows\\CbsTemp\\*.exe"", ""C:\\Windows\\Logs\\*.exe"",""C:\\Windows\\WaaS\\*.exe"",""C:\\Windows\\twain_32\\*.exe"",""C:\\Windows\\ShellExperiences\\*.exe"",""C:\\Windows\\ShellComponents\\*.exe"",""C:\\Windows\\PLA\\*.exe"", ""C:\\Windows\\Migration\\*.exe"",""C:\\Windows\\debug\\*.exe"",""C:\\Windows\\Cursors\\*.exe"",""C:\\Windows\\Containers\\*.exe"",""C:\\Windows\\Boot\\*.exe"",""C:\\Windows\\bcastdvr\\*.exe"", ""C:\\Windows\\assembly\\*.exe"",""C:\\Windows\\TextInput\\*.exe"",""C:\\Windows\\security\\*.exe"",""C:\\Windows\\schemas\\*.exe"",""C:\\Windows\\SchCache\\*.exe"",""C:\\Windows\\Resources\\*.exe"", ""C:\\Windows\\rescache\\*.exe"",""C:\\Windows\\Provisioning\\*.exe"",""C:\\Windows\\PrintDialog\\*.exe"",""C:\\Windows\\PolicyDefinitions\\*.exe"",""C:\\Windows\\media\\*.exe"",""C:\\Windows\\Globalization\\*.exe"",""C:\\Windows\\L2Schemas\\*.exe"",""C:\\Windows\\LiveKernelReports\\*.exe"",""C:\\Windows\\ModemLogs\\*.exe"",""C:\\Windows\\ImmersiveControlPanel\\*.exe"") and not process.name : (""SpeechUXWiz.exe"",""SystemSettings.exe"",""TrustedInstaller.exe"",""PrintDialog.exe"",""MpSigStub.exe"",""LMS.exe"",""mpam-*.exe"") /* uncomment oncein winlogbeat */ /* and not (process.code_signature.subject_name ==""Microsoft Corporation"" and process.code_signature.trusted == true) */","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/process-injection-detected-elastic-endgame.html,Process Injection - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected Process Injection. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and(event.action:kernel_shellcode_event orendgame.event_subtype_full:kernel_shellcode_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/process-injection-prevented-elastic-endgame.html,Process Injection - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented Process Injection. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and(event.action:kernel_shellcode_event orendgame.event_subtype_full:kernel_shellcode_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/process-injection-by-the-microsoft-build-engine.html,Process Injection by the Microsoft Build Engineedit,"['Defense Evasion', 'Privilege Escalation']","['TA0005', 'TA0004']","['Process Injection', 'Process Injection']","['T1055', 'T1055']","An instance of MSBuild, the Microsoft Build Engine, created a thread in another process. This technique is sometimes used to evade detection or elevate privileges.",['query'],"process.name:MSBuild.exe and event.action:""CreateRemoteThread detected(rule: CreateRemoteThread)""","['winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/process-termination-followed-by-deletion.html,Process Termination followed by Deletionedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],"Identifies a process termination event quickly followed by the deletion of its executable file. Malware tools and other non-native files dropped or created on a system by an adversary may leave traces to indicate to what occurred. Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversarys footprint.",['eql'],"sequence by host.id with maxspan=5s [process where event.type ==""end"" and process.code_signature.trusted == false and notprocess.executable : (""C:\\Windows\\SoftwareDistribution\\*.exe"",""C:\\Windows\\WinSxS\\*.exe"") ] by process.executable [filewhere event.type == ""deletion"" and file.extension : (""exe"", ""scr"",""com"")] by file.path",['logs-endpoint.events.*'],N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/program-files-directory-masquerading.html,Program Files Directory Masqueradingedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],"Identifies execution from a directory masquerading as the Windows Program Files directories. These paths are trusted and usually host trusted third party programs. An adversary may leverage masquerading, along with low privileges to bypass detections whitelisting those folders.",['eql'],"process where event.type == ""start"" and process.executable :""C:\\*Program*Files*\\*.exe"" and not process.executable :(""C:\\Program Files\\*.exe"", ""C:\\Program Files (x86)\\*.exe"",""C:\\Users\\*.exe"", ""C:\\ProgramData\\*.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/prompt-for-credentials-with-osascript.html,Prompt for Credentials with OSASCRIPTedit,['Credential Access'],['TA0006'],['Input Capture'],['T1056'],Identifies the use of osascript to execute scripts via standard input that may prompt a user with a rogue dialog for credentials.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""osascript"" and process.command_line :""osascript*display dialog*password*""","['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/EmpireProject/EmPyre/blob/master/lib/modules/collection/osx/prompt.py', 'https://ss64.com/osx/osascript.html']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/psexec-network-connection.html,PsExec Network Connectionedit,"['Execution', 'Lateral Movement']","['TA0002', 'TA0008']",['System Services'],['T1569'],Identifies use of the SysInternals tool PsExec.exe making a network connection. This could be an indication of lateral movement.,['eql'],"sequence by process.entity_id [process where process.name :""PsExec.exe"" and event.type == ""start""] [network where process.name: ""PsExec.exe""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/rdp-remote-desktop-protocol-from-the-internet.html,RDP (Remote Desktop Protocol) from the Internetedit,"['Command and Control', 'Lateral Movement', 'Initial Access']","['TA0011', 'TA0008', 'TA0001']","['Remote Services', 'Exploit Public-Facing Application']","['T1021', 'T1190']","This rule detects network events that may indicate the use of RDP traffic from the Internet. RDP is commonly used by system administrators to remotely control a system for maintenance or to use shared resources. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector.",['query'],"event.category:(network or network_traffic) and network.transport:tcpand (destination.port:3389 or event.dataset:zeek.rdp) and notsource.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or203.0.113.0/24 or 240.0.0.0/4 or ""::1"" or ""FE80::/10"" or""FF00::/8"" ) and destination.ip:( 10.0.0.0/8 or172.16.0.0/12 or 192.168.0.0/16 )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/rdp-enabled-via-registry.html,RDP Enabled via Registryedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies registry write modifications to enable Remote Desktop Protocol (RDP) access. This could be indicative of adversary lateral movement preparation.,['eql'],"registry where registry.path :""HKLM\\SYSTEM\\ControlSet*\\Control\\TerminalServer\\fDenyTSConnections"" and registry.data.strings == ""0"" and not(process.name : ""svchost.exe"" and user.domain == ""NT AUTHORITY"") andnot process.executable :""C:\\Windows\\System32\\SystemPropertiesRemote.exe""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/rpc-remote-procedure-call-from-the-internet.html,RPC (Remote Procedure Call) from the Internetedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],"This rule detects network events that may indicate the use of RPC traffic from the Internet. RPC is commonly used by system administrators to remotely control a system for maintenance or to use shared resources. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector.",['query'],"event.category:(network or network_traffic) and network.transport:tcpand (destination.port:135 or event.dataset:zeek.dce_rpc) and notsource.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or203.0.113.0/24 or 240.0.0.0/4 or ""::1"" or ""FE80::/10"" or""FF00::/8"" ) and destination.ip:( 10.0.0.0/8 or172.16.0.0/12 or 192.168.0.0/16 )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Network', 'Threat Detection', 'Initial Access', 'Host']"
https://www.elastic.co/guide/en/security/7.16/rpc-remote-procedure-call-to-the-internet.html,RPC (Remote Procedure Call) to the Internetedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],"This rule detects network events that may indicate the use of RPC traffic to the Internet. RPC is commonly used by system administrators to remotely control a system for maintenance or to use shared resources. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector.",['query'],"event.category:(network or network_traffic) and network.transport:tcpand (destination.port:135 or event.dataset:zeek.dce_rpc) andsource.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or ""::1""or ""FE80::/10"" or ""FF00::/8"" )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Network', 'Threat Detection', 'Initial Access', 'Host']"
https://www.elastic.co/guide/en/security/7.16/ransomware-detected-elastic-endgame.html,Ransomware - Detected - Elastic Endgameedit,[],[],[],[],Elastic Endgame detected Ransomware. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:detection and (event.action:ransomware_event orendgame.event_subtype_full:ransomware_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/ransomware-prevented-elastic-endgame.html,Ransomware - Prevented - Elastic Endgameedit,[],[],[],[],Elastic Endgame prevented Ransomware. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.,['query'],event.kind:alert and event.module:endgame andendgame.metadata.type:prevention and (event.action:ransomware_event orendgame.event_subtype_full:ransomware_event),['endgame-*'],N/A,"['Elastic', 'Elastic Endgame']"
https://www.elastic.co/guide/en/security/7.16/rare-aws-error-code.html,Rare AWS Error Codeedit,[],[],[],[],"A machine learning job detected an unusual error in a CloudTrail message. These can be byproducts of attempted or successful persistence, privilege escalation, defense evasion, discovery, lateral movement, or collection.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Cloud', 'AWS', 'ML']"
https://www.elastic.co/guide/en/security/7.16/rare-user-logon.html,Rare User Logonedit,[],[],[],[],A machine learning job found an unusual user name in the authentication logs. An unusual user name is one way of detecting credentialed access by means of a new or dormant user account. An inactive user account (because the user has left the organization) that becomes active may be due to credentialed access using a compromised account password. Threat actors will sometimes also create new users as a means of persisting in a compromised web application.,['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Authentication', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/registry-persistence-via-appcert-dll.html,Registry Persistence via AppCert DLLedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],Detects attempts to maintain persistence by creating registry keys using AppCert DLLs. AppCert DLLs are loaded by every process using the common API functions to create processes.,['eql'],"registry where /* uncomment once stable length(bytes_written_string) >0 and */ registry.path :""HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\AppCertDLLs\\*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/registry-persistence-via-appinit-dll.html,Registry Persistence via AppInit DLLedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"Attackers may maintain persistence by creating registry keys using AppInit DLLs. AppInit DLLs are loaded by every process using the common library, user32.dll.",['eql'],"registry where registry.path : (""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\AppInit_Dlls"",""HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\AppInit_Dlls"") and notprocess.executable : (""C:\\Windows\\System32\\msiexec.exe"",""C:\\Windows\\SysWOW64\\msiexec.exe"",""C:\\Program Files\\Commvault\\ContentStore*\\Base\\cvd.exe"",""C:\\Program Files (x86)\\Commvault\\ContentStore*\\Base\\cvd.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/remote-desktop-enabled-in-windows-firewall.html,Remote Desktop Enabled in Windows Firewalledit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies use of the network shell utility (netsh.exe) to enable inbound Remote Desktop Protocol (RDP) connections in the Windows Firewall.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""netsh.exe"" or process.pe.original_file_name ==""netsh.exe"") and process.args : (""localport=3389"", ""RemoteDesktop"",""group=\""remote desktop\"""") and process.args : (""action=allow"",""enable=Yes"", ""enable"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/remote-execution-via-file-shares.html,Remote Execution via File Sharesedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies the execution of a file that was created by the virtual system process. This may indicate lateral movement via network file shares.,['eql'],"sequence with maxspan=1m [file where event.type in (""creation"",""change"") and process.pid == 4 and file.extension : ""exe""] by host.id,file.path [process where event.type in (""start"", ""process_started"")]by host.id, process.executable","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://web.archive.org/web/20230329172636/https://blog.menasec.net/2020/08/new-trick-to-detect-lateral-movement.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/remote-file-copy-to-a-hidden-share.html,Remote File Copy to a Hidden Shareedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : (""cmd.exe"", ""powershell.exe"", ""robocopy.exe"",""xcopy.exe"") and process.args : (""copy*"", ""move*"", ""cp"", ""mv"") andprocess.args : ""*$*""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/remote-file-copy-via-teamviewer.html,Remote File Copy via TeamVieweredit,['Command and Control'],['TA0011'],['Ingress Tool Transfer'],['T1105'],Identifies an executable or script file remotely downloaded via a TeamViewer transfer session.,['eql'],"file where event.type == ""creation"" and process.name :""TeamViewer.exe"" and file.extension : (""exe"", ""dll"", ""scr"", ""com"",""bat"", ""ps1"", ""vbs"", ""vbe"", ""js"", ""wsh"", ""hta"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://web.archive.org/web/20230329160957/https://blog.menasec.net/2019/11/hunting-for-suspicious-use-of.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/remote-file-download-via-desktopimgdownldr-utility.html,Remote File Download via Desktopimgdownldr Utilityedit,['Command and Control'],['TA0011'],['Ingress Tool Transfer'],['T1105'],Identifies the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""desktopimgdownldr.exe"" orprocess.pe.original_file_name == ""desktopimgdownldr.exe"") andprocess.args : ""/lockscreenurl:http*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/remote-file-download-via-mpcmdrun.html,Remote File Download via MpCmdRunedit,['Command and Control'],['TA0011'],['Ingress Tool Transfer'],['T1105'],Identifies the Windows Defender configuration utility (MpCmdRun.exe) being used to download a remote file.,['eql'],"process where event.type == ""start"" and (process.name :""MpCmdRun.exe"" or process.pe.original_file_name == ""MpCmdRun.exe"") andprocess.args : ""-DownloadFile"" and process.args : ""-url"" andprocess.args : ""-path""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://twitter.com/mohammadaskar2/status/1301263551638761477', 'https://www.bleepingcomputer.com/news/microsoft/microsoft-defender-can-ironically-be-used-to-download-malware/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/remote-file-download-via-powershell.html,Remote File Download via PowerShelledit,"['Command and Control', 'Execution']","['TA0011', 'TA0002']","['Ingress Tool Transfer', 'Command and Scripting Interpreter']","['T1105', 'T1059']",Identifies powershell.exe being used to download an executable file from an untrusted remote destination.,['eql'],"sequence by host.id, process.entity_id with maxspan=30s [networkwhere process.name : (""powershell.exe"", ""pwsh.exe"",""powershell_ise.exe"") and network.protocol == ""dns"" and notdns.question.name : (""localhost"", ""*.microsoft.com"",""*.azureedge.net"", ""*.powershellgallery.com"", ""*.windowsupdate.com"",""metadata.google.internal"") and not user.domain : ""NT AUTHORITY""][file where process.name : ""powershell.exe"" and event.type ==""creation"" and file.extension : (""exe"", ""dll"", ""ps1"", ""bat"") andnot file.name : ""__PSScriptPolicy*.ps1""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/remote-file-download-via-script-interpreter.html,Remote File Download via Script Interpreteredit,['Command and Control'],['TA0011'],['Ingress Tool Transfer'],['T1105'],Identifies built-in Windows script interpreters (cscript.exe or wscript.exe) being used to download an executable file from a remote destination.,['eql'],"sequence by host.id, process.entity_id [network where process.name :(""wscript.exe"", ""cscript.exe"") and network.protocol != ""dns"" andnetwork.direction : (""outgoing"", ""egress"") and network.type == ""ipv4""and destination.ip != ""127.0.0.1"" ] [file where event.type ==""creation"" and file.extension : (""exe"", ""dll"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/remote-ssh-login-enabled-via-systemsetup-command.html,Remote SSH Login Enabled via systemsetup Commandedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Detects use of the systemsetup command to enable remote SSH Login.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:systemsetup and process.args:(""-setremotelogin"" and on)","['auditbeat-*', 'logs-endpoint.events.*']","['https://documents.trendmicro.com/assets/pdf/XCSSET_Technical_Brief.pdf', 'https://ss64.com/osx/systemsetup.html', 'https://support.apple.com/guide/remote-desktop/about-systemsetup-apd95406b8d/mac']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/remote-scheduled-task-creation.html,Remote Scheduled Task Creationedit,"['Lateral Movement', 'Execution']","['TA0008', 'TA0002']","['Remote Services', 'Scheduled Task/Job']","['T1021', 'T1053']",Identifies remote scheduled task creations on a target host. This could be indicative of adversary lateral movement.,['eql'],"/* Task Scheduler service incoming connection followed by TaskCacheregistry modification */ sequence by host.id, process.entity_id withmaxspan = 1m [network where process.name : ""svchost.exe"" andnetwork.direction : (""incoming"", ""ingress"") and source.port >= 49152and destination.port >= 49152 and source.address != ""127.0.0.1"" andsource.address != ""::1"" ] [registry where registry.path :""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions""]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/remote-system-discovery-commands.html,Remote System Discovery Commandsedit,['Discovery'],['TA0007'],['Remote System Discovery'],['T1018'],"Discovery of remote system information using built-in commands, which may be used to mover laterally.",['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""nbtstat.exe"" and process.args : (""-n"", ""-s"")) or(process.name : ""arp.exe"" and process.args : ""-a"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/remotely-started-services-via-rpc.html,Remotely Started Services via RPCedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies remote execution of Windows services over remote procedure call (RPC). This could be indicative of lateral movement, but will be noisy if commonly done by administrators.""",['eql'],"sequence with maxspan=1s [network where process.name :""services.exe"" and network.direction : (""incoming"", ""ingress"")and network.transport == ""tcp"" and source.port >= 49152 anddestination.port >= 49152 and source.address not in (""127.0.0.1"",""::1"") ] by host.id, process.entity_id [process whereevent.type in (""start"", ""process_started"") and process.parent.name :""services.exe"" and not (process.name : ""svchost.exe"" andprocess.args : ""tiledatamodelsvc"") and not (process.name :""msiexec.exe"" and process.args : ""/V"") /* uncomment if psexecis noisy in your environment */ /* and not process.name :""PSEXESVC.exe"" */ ] by host.id, process.parent.entity_id","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/renamed-autoit-scripts-interpreter.html,Renamed AutoIt Scripts Interpreteredit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],Identifies a suspicious AutoIt process execution. Malware written as an AutoIt script tends to rename the AutoIt executable to avoid detection.,['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.pe.original_file_name : ""AutoIt*.exe"" and not process.name :""AutoIt*.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/roshal-archive-rar-or-powershell-file-downloaded-from-the-internet.html,Roshal Archive (RAR) or PowerShell File Downloaded from the Internetedit,['Command and Control'],['TA0011'],['Ingress Tool Transfer'],['T1105'],"Detects a Roshal Archive (RAR) file or PowerShell script downloaded from the internet by an internal host. Gaining initial access to a system and then downloading encoded or encrypted tools to move laterally is a common practice for adversaries as a way to protect their more valuable tools and tactics, techniques, and procedures (TTPs). This may be atypical behavior for a managed network and can be indicative of malware, exfiltration, or command and control.",['query'],"event.category:(network or network_traffic) and network.protocol:httpand (url.extension:(ps1 or rar) or url.path:(*.ps1 or *.rar)) andnot destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or""::1"" or ""FE80::/10"" or ""FF00::/8"" ) andsource.ip:( 10.0.0.0/8 or 172.16.0.0/12 or192.168.0.0/16 )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html', 'https://www.justice.gov/opa/press-release/file/1084361/download', 'https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml']","['Elastic', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/sip-provider-modification.html,SIP Provider Modificationedit,['Defense Evasion'],['TA0005'],['Subvert Trust Controls'],['T1553'],Identifies modifications to the registered Subject Interface Package (SIP) providers. SIP providers are used by the Windows cryptographic system to validate file signatures on the system. This may be an attempt to bypass signature validation checks or inject code into critical processes.,['eql'],"registry where event.type:""change"" and registry.path: (""HKLM\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType0\\CryptSIPDllPutSignedDataMsg\\{*}\\Dll"", ""HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\OID\\EncodingType0\\CryptSIPDllPutSignedDataMsg\\{*}\\Dll"", ""HKLM\\SOFTWARE\\Microsoft\\Cryptography\\Providers\\Trust\\FinalPolicy\\{*}\\$Dll"", ""HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\Providers\\Trust\\FinalPolicy\\{*}\\$Dll"" ) and registry.data.strings:""*.dll""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://github.com/mattifestation/PoCSubjectInterfacePackage'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/smb-windows-file-sharing-activity-to-the-internet.html,SMB (Windows File Sharing) Activity to the Internetedit,"['Initial Access', 'Exfiltration']","['TA0001', 'TA0010']","['Exploit Public-Facing Application', 'Exfiltration Over Alternative Protocol']","['T1190', 'T1048']","This rule detects network events that may indicate the use of Windows file sharing (also called SMB or CIFS) traffic to the Internet. SMB is commonly used within networks to share files, printers, and other system resources amongst trusted systems. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector or for data exfiltration.",['query'],"event.category:(network or network_traffic) and network.transport:tcpand (destination.port:(139 or 445) or event.dataset:zeek.smb) andsource.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or ""::1""or ""FE80::/10"" or ""FF00::/8"" )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Network', 'Threat Detection', 'Initial Access', 'Host']"
https://www.elastic.co/guide/en/security/7.16/smtp-on-port-26-tcp.html,SMTP on Port 26/TCPedit,"['Command and Control', 'Exfiltration']","['TA0011', 'TA0010']",['Exfiltration Over Alternative Protocol'],['T1048'],This rule detects events that may indicate use of SMTP on TCP port 26. This port is commonly used by several popular mail transfer agents to deconflict with the default SMTP port 25. This port has also been used by a malware family called BadPatch for command and control of Windows systems.,['query'],event.category:(network or network_traffic) and network.transport:tcpand (destination.port:26 or (event.dataset:zeek.smtp anddestination.port:26)),"['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']","['https://unit42.paloaltonetworks.com/unit42-badpatch/', 'https://isc.sans.edu/forums/diary/Next+up+whats+up+with+TCP+port+26/25564/']","['Elastic', 'Host', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/ssh-authorized-keys-file-modification.html,SSH Authorized Keys File Modificationedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],The Secure Shell (SSH) authorized_keys file specifies which users are allowed to log into a server using public key authentication. Adversaries may modify it to maintain persistence on a victim host by adding their own public key(s).,['query'],"event.category:file and event.type:(change or creation) andfile.name:(""authorized_keys"" or ""authorized_keys2"") and notprocess.executable:(/Library/Developer/CommandLineTools/usr/bin/git or/usr/local/Cellar/maven/*/libexec/bin/mvn or/Library/Java/JavaVirtualMachines/jdk*.jdk/Contents/Home/bin/java or/usr/bin/vim or /usr/local/Cellar/coreutils/*/bin/gcator /usr/bin/bsdtar or /usr/bin/nautilusor /usr/bin/scp or /usr/bin/touch or/var/lib/docker/*)","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/sunburst-command-and-control-activity.html,SUNBURST Command and Control Activityedit,"['Command and Control', 'Initial Access']","['TA0011', 'TA0001']","['Application Layer Protocol', 'Supply Chain Compromise']","['T1071', 'T1195']",The malware known as SUNBURST targets the SolarWinds Orion business software for command and control. This rule detects post-exploitation command and control activity of the SUNBURST backdoor.,['eql'],"network where event.type == ""protocol"" and network.protocol == ""http""and process.name : (""ConfigurationWizard.exe"",""NetFlowService.exe"",""NetflowDatabaseMaintenance.exe"",""SolarWinds.Administration.exe"",""SolarWinds.BusinessLayerHost.exe"",""SolarWinds.BusinessLayerHostx64.exe"",""SolarWinds.Collector.Service.exe"",""SolarwindsDiagnostics.exe"") and (http.request.body.content :""*/swip/Upload.ashx*"" and http.request.body.content : (""POST*"",""PUT*"")) or (http.request.body.content :(""*/swip/SystemDescription*"", ""*/swip/Events*"") andhttp.request.body.content : (""GET*"", ""HEAD*"")) and nothttp.request.body.content : ""*solarwinds.com*""",['logs-endpoint.events.*'],['https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Command and Control']"
https://www.elastic.co/guide/en/security/7.16/scheduled-task-created-by-a-windows-script.html,Scheduled Task Created by a Windows Scriptedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],"A scheduled task was created by a Windows script via cscript.exe, wscript.exe or powershell.exe. This can be abused by an adversary to establish persistence.",['eql'],"sequence by host.id with maxspan = 30s [library where dll.name :""taskschd.dll"" and process.name : (""cscript.exe"", ""wscript.exe"",""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"")] [registry whereregistry.path : ""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\*\\Actions""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/scheduled-tasks-at-command-enabled.html,Scheduled Tasks AT Command Enablededit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],"Identifies attempts to enable the Windows scheduled tasks AT command via the registry. Attackers may use this method to move laterally or persist locally. The AT command has been deprecated since Windows 8 and Windows Server 2012, but still exists for backwards compatibility.",['eql'],"registry where registry.path : ""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Schedule\\Configuration\\EnableAt"" andregistry.data.strings == ""1""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-scheduledjob'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/screensaver-plist-file-modified-by-unexpected-process.html,Screensaver Plist File Modified by Unexpected Processedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],Identifies when a screensaver plist file is modified by an unexpected process. An adversary can maintain persistence on a macOS endpoint by creating a malicious screensaver (.saver) file and configuring the screensaver plist file to execute code each time the screensaver is activated.,['eql'],"file where event.type != ""deletion"" and file.name:""com.apple.screensaver.*.plist"" and file.path : (""/Users/*/Library/Preferences/ByHost/*"", ""/Library/ManagedPreferences/*"", ""/System/Library/Preferences/*"" ) and /*Filter OS processes modifying screensaver plist files */ notprocess.executable : ( ""/usr/sbin/cfprefsd"",""/usr/libexec/xpcproxy"", ""/System/Library/CoreServices/ManagedClient.app/Contents/Resources/MCXCompositor"", ""/System/Library/CoreServices/ManagedClient.app/Contents/MacOS/ManagedClient"" )","['auditbeat-*', 'logs-endpoint.events.*']","['https://posts.specterops.io/saving-your-access-d562bf5bf90b', 'https://github.com/D00MFist/PersistentJXA']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/searching-for-saved-credentials-via-vaultcmd.html,Searching for Saved Credentials via VaultCmdedit,['Credential Access'],['TA0006'],['OS Credential Dumping'],['T1003'],"Windows Credential Manager allows you to create, view, or delete saved credentials for signing into websites, connected applications, and networks. An adversary may abuse this to list or dump credentials stored in the Credential Manager for saved usernames and passwords. This may also be performed in preparation of lateral movement.",['eql'],"process where event.type in (""start"", ""process_started"") and(process.pe.original_file_name:""vaultcmd.exe"" orprocess.name:""vaultcmd.exe"") and process.args:""/list*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16', 'https://rastamouse.me/blog/rdp-jump-boxes/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/security-software-discovery-using-wmic.html,Security Software Discovery using WMICedit,['Discovery'],['TA0007'],['Software Discovery'],['T1518'],Identifies the use of Windows Management Instrumentation Command (WMIC) to discover certain System Security Settings such as AntiVirus or Host Firewall details.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name:""wmic.exe"" or process.pe.original_file_name:""wmic.exe"")and process.args:""/namespace:\\\\root\\SecurityCenter2"" andprocess.args:""Get""","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/security-software-discovery-via-grep.html,Security Software Discovery via Grepedit,['Discovery'],['TA0007'],['Software Discovery'],['T1518'],"Identifies the use of the grep command to discover known third-party macOS and Linux security tools, such as Antivirus or Host Firewall details.",['eql'],"process where event.type == ""start"" and process.name : ""grep"" anduser.id != ""0"" and not process.parent.executable :""/Library/Application Support/*"" and process.args :(""Little Snitch*"", ""Avast*"", ""Avira*"",""ESET*"", ""BlockBlock*"", ""360Sec*"",""LuLu*"", ""KnockKnock*"", ""kav"", ""KIS"",""RTProtectionDaemon*"", ""Malware*"",""VShieldScanner*"", ""WebProtection*"",""webinspectord*"", ""McAfee*"", ""isecespd*"",""macmnsvc*"", ""masvc*"", ""kesl*"",""avscan*"", ""guard*"", ""rtvscand*"",""symcfgd*"", ""scmdaemon*"", ""symantec*"",""sophos*"", ""osquery*"", ""elastic-endpoint*"") and not (process.args : ""Avast"" and process.args : ""Passwords"")","['logs-endpoint.events.*', 'auditbeat-*']",N/A,"['Elastic', 'Host', 'macOS', 'Linux', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/sensitive-files-compression.html,Sensitive Files Compressionedit,"['Credential Access', 'Collection']","['TA0006', 'TA0009']","['Unsecured Credentials', 'Archive Collected Data']","['T1552', 'T1560']","Identifies the use of a compression utility to collect known files containing sensitive information, such as credentials and system configurations.",['query'],event.category:process and event.type:start and process.name:(zip ortar or gzip or hdiutil or 7z) and process.args: (/root/.ssh/id_rsa or /root/.ssh/id_rsa.pub or/root/.ssh/id_ed25519 or /root/.ssh/id_ed25519.pub or/root/.ssh/authorized_keys or /root/.ssh/authorized_keys2 or/root/.ssh/known_hosts or /root/.bash_history or/etc/hosts or /home/*/.ssh/id_rsa or/home/*/.ssh/id_rsa.pub or /home/*/.ssh/id_ed25519 or/home/*/.ssh/id_ed25519.pub or /home/*/.ssh/authorized_keys or/home/*/.ssh/authorized_keys2 or /home/*/.ssh/known_hosts or/home/*/.bash_history or /root/.aws/credentials or/root/.aws/config or /home/*/.aws/credentials or/home/*/.aws/config or /root/.docker/config.json or/home/*/.docker/config.json or /etc/group or /etc/passwdor /etc/shadow or /etc/gshadow ),"['auditbeat-*', 'logs-endpoint.events.*']",['https://www.trendmicro.com/en_ca/research/20/l/teamtnt-now-deploying-ddos-capable-irc-bot-tntbotinger.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Collection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/service-command-lateral-movement.html,Service Command Lateral Movementedit,"['Lateral Movement', 'Persistence', 'Execution']","['TA0008', 'TA0003', 'TA0002']","['Remote Services', 'Create or Modify System Process', 'System Services']","['T1021', 'T1543', 'T1569']","Identifies use of sc.exe to create, modify, or start services on remote hosts. This could be indicative of adversary lateral movement but will be noisy if commonly done by admins.",['eql'],"sequence by process.entity_id with maxspan = 1m [process whereevent.type in (""start"", ""process_started"") and (process.name :""sc.exe"" or process.pe.original_file_name : ""sc.exe"") andprocess.args : ""\\\\*"" and process.args : (""binPath=*"", ""binpath=*"")and process.args : (""create"", ""config"", ""failure"", ""start"")][network where process.name : ""sc.exe"" and destination.ip !=""127.0.0.1""]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/service-control-spawned-via-script-interpreter.html,Service Control Spawned via Script Interpreteredit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies Service Control (sc.exe) spawning from script interpreter processes to create, modify, or start services. This could be indicative of adversary lateral movement but will be noisy if commonly done by admins.",['eql'],"process where event.type == ""start"" and (process.name : ""sc.exe"" orprocess.pe.original_file_name == ""sc.exe"") and process.parent.name :(""cmd.exe"", ""wscript.exe"", ""rundll32.exe"", ""regsvr32.exe"",""wmic.exe"", ""mshta.exe"",""powershell.exe"", ""pwsh.exe"") andprocess.args:(""config"", ""create"", ""start"", ""delete"", ""stop"", ""pause"")and /* exclude SYSTEM SID - look for service creations by non-SYSTEMuser */ not user.id : ""S-1-5-18""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/setuid-setgid-bit-set-via-chmod.html,Setuid / Setgid Bit Set via chmodedit,"['Privilege Escalation', 'Persistence']","['TA0004', 'TA0003']",['Abuse Elevation Control Mechanism'],['T1548'],"An adversary may add the setuid or setgid bit to a file or directory in order to run a file with the privileges of the owning user or group. An adversary can take advantage of this to either do a shell escape or exploit a vulnerability in an application with the setuid or setgid bit to get code running in a different users context. Additionally, adversaries can use this mechanism on their own malware to make sure theyre able to execute in elevated contexts in the future.",['query'],"event.category:process AND event.type:(start OR process_started) ANDprocess.name:chmod AND process.args:(""+s"" OR ""u+s"" OR /4[0-9]{3}/ ORg+s OR /2[0-9]{3}/) AND NOT process.args: (/.*\/Applications\/VirtualBox.app\/.+/ OR/\/usr\/local\/lib\/python.+/ OR/\/var\/folders\/.+\/FP.*nstallHelper/ OR/\/Library\/Filesystems\/.+/ OR/\/usr\/lib\/virtualbox\/.+/ OR/\/Library\/Application.*/ OR ""/run/postgresql"" OR""/var/crash"" OR ""/var/run/postgresql"" OR/\/usr\/bin\/.+/ OR /\/usr\/local\/share\/.+/ OR/\/Applications\/.+/ OR /\/usr\/libexec\/.+/ OR""/var/metrics"" OR /\/var\/lib\/dpkg\/.+/ OR/\/run\/log\/journal\/.*/ OR\/Users\/*\/.minikube\/bin\/docker-machine-driver-hyperkit) AND NOT process.parent.executable: (/\/var\/lib\/docker\/.+/ OR ""/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service"" OR""/var/lib/dpkg/info/whoopsie.postinst"" )","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/shell-execution-via-apple-scripting.html,Shell Execution via Apple Scriptingedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies the execution of the shell process (sh) via scripting (JXA or AppleScript). Adversaries may use the doShellScript functionality in JXA or do shell script in AppleScript to execute system commands.,['eql'],"sequence by host.id with maxspan=5s [process where event.type in(""start"", ""process_started"", ""info"") and process.name == ""osascript""]by process.pid [process where event.type in (""start"",""process_started"") and process.name == ""sh"" and process.args == ""-c""]by process.parent.pid","['auditbeat-*', 'logs-endpoint.events.*']","['https://developer.apple.com/library/archive/technotes/tn2065/_index.html', 'https://objectivebythesea.com/v2/talks/OBTS_v2_Thomas.pdf']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/shortcut-file-written-or-modified-for-persistence.html,Shortcut File Written or Modified for Persistenceedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies files written to or modified in the startup folder by commonly abused processes. Adversaries may use this technique to maintain persistence.,['eql'],"file where event.type != ""deletion"" and user.domain != ""NTAUTHORITY"" and file.path :(""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\StartMenu\\Programs\\Startup\\*"",""C:\\ProgramData\\Microsoft\\Windows\\StartMenu\\Programs\\StartUp\\*"") and process.name : (""cmd.exe"",""powershell.exe"", ""wmic.exe"",""mshta.exe"", ""pwsh.exe"",""cscript.exe"", ""wscript.exe"",""regsvr32.exe"", ""RegAsm.exe"",""rundll32.exe"", ""EQNEDT32.EXE"",""WINWORD.EXE"", ""EXCEL.EXE"",""POWERPNT.EXE"", ""MSPUB.EXE"",""MSACCESS.EXE"", ""iexplore.exe"",""InstallUtil.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/softwareupdate-preferences-modification.html,SoftwareUpdate Preferences Modificationedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies changes to the SoftwareUpdate preferences using the built-in defaults command. Adversaries may abuse this in an attempt to disable security updates.,['query'],"event.category:process and event.type:(start or process_started) andprocess.name:defaults and process.args:(write and ""-bool"" and(com.apple.SoftwareUpdate or/Library/Preferences/com.apple.SoftwareUpdate.plist) and not (TRUE ortrue))","['auditbeat-*', 'logs-endpoint.events.*']",['https://blog.checkpoint.com/2017/07/13/osxdok-refuses-go-away-money/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/solarwinds-process-disabling-services-via-registry.html,SolarWinds Process Disabling Services via Registryedit,"['Defense Evasion', 'Initial Access']","['TA0005', 'TA0001']","['Impair Defenses', 'Supply Chain Compromise']","['T1562', 'T1195']",Identifies a SolarWinds binary modifying the start type of a service to be disabled. An adversary may abuse this technique to manipulate relevant security services.,['eql'],"registry where registry.path :""HKLM\\SYSTEM\\*ControlSet*\\Services\\*\\Start"" andregistry.data.strings == ""4"" and process.name : (""SolarWinds.BusinessLayerHost*.exe"", ""ConfigurationWizard*.exe"",""NetflowDatabaseMaintenance*.exe"", ""NetFlowService*.exe"",""SolarWinds.Administration*.exe"",""SolarWinds.Collector.Service*.exe"" ,""SolarwindsDiagnostics*.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/spike-in-aws-error-messages.html,Spike in AWS Error Messagesedit,[],[],[],[],"A machine learning job detected a significant spike in the rate of a particular error in the CloudTrail messages. Spikes in error messages may accompany attempts at privilege escalation, lateral movement, or discovery.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Cloud', 'AWS', 'ML']"
https://www.elastic.co/guide/en/security/7.16/spike-in-failed-logon-events.html,Spike in Failed Logon Eventsedit,[],[],[],[],"A machine learning job found an unusually large spike in authentication failure events. This can be due to password spraying, user enumeration or brute force activity and may be a precursor to account takeover or credentialed access.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Authentication', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/spike-in-firewall-denies.html,Spike in Firewall Deniesedit,[],[],[],[],"A machine learning job detected an unusually large spike in network traffic that was denied by network access control lists (ACLs) or firewall rules. Such a burst of denied traffic is usually caused by either 1) a mis-configured application or firewall or 2) suspicious or malicious activity. Unsuccessful attempts at network transit, in order to connect to command-and-control (C2), or engage in data exfiltration, may produce a burst of failed connections. This could also be due to unusually large amounts of reconnaissance or enumeration traffic. Denial-of-service attacks or traffic floods may also produce such a surge in traffic.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/spike-in-logon-events.html,Spike in Logon Eventsedit,[],[],[],[],"A machine learning job found an unusually large spike in successful authentication events. This can be due to password spraying, user enumeration or brute force activity.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Authentication', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/spike-in-logon-events-from-a-source-ip.html,Spike in Logon Events from a Source IPedit,[],[],[],[],"A machine learning job found an unusually large spike in successful authentication events from a particular source IP address. This can be due to password spraying, user enumeration or brute force activity.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Authentication', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/spike-in-network-traffic.html,Spike in Network Trafficedit,[],[],[],[],"A machine learning job detected an unusually large spike in network traffic. Such a burst of traffic, if not caused by a surge in business activity, can be due to suspicious or malicious activity. Large-scale data exfiltration may produce a burst of network traffic; this could also be due to unusually large amounts of reconnaissance or enumeration traffic. Denial-of-service attacks or traffic floods may also produce such a surge in traffic.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/spike-in-network-traffic-to-a-country.html,Spike in Network Traffic To a Countryedit,[],[],[],[],"A machine learning job detected an unusually large spike in network activity to one destination country in the network logs. This could be due to unusually large amounts of reconnaissance or enumeration traffic. Data exfiltration activity may also produce such a surge in traffic to a destination country which does not normally appear in network traffic or business work-flows. Malware instances and persistence mechanisms may communicate with command-and-control (C2) infrastructure in their country of origin, which may be an unusual destination country for the source network.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/startup-folder-persistence-via-unsigned-process.html,Startup Folder Persistence via Unsigned Processedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies files written or modified in the startup folder by unsigned processes. Adversaries may abuse this technique to maintain persistence in an environment.,['eql'],"sequence by host.id, process.entity_id with maxspan=5s [processwhere event.type in (""start"", ""process_started"") andprocess.code_signature.trusted == false and /* suspicious paths canbe added here */ process.executable : (""C:\\Users\\*.exe"",""C:\\ProgramData\\*.exe"",""C:\\Windows\\Temp\\*.exe"",""C:\\Windows\\Tasks\\*.exe"",""C:\\Intel\\*.exe"", ""C:\\PerfLogs\\*.exe"")] [file where event.type != ""deletion"" and user.domain != ""NTAUTHORITY"" and file.path :(""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\StartMenu\\Programs\\Startup\\*"",""C:\\ProgramData\\Microsoft\\Windows\\StartMenu\\Programs\\StartUp\\*"") ]",['logs-endpoint.events.*'],N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/startup-or-run-key-registry-modification.html,Startup or Run Key Registry Modificationedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],"Identifies run key or startup key registry modifications. In order to survive reboots and other system interrupts, attackers will modify run keys within the registry or leverage startup folder items as a form of persistence.",['eql'],"registry where registry.data.strings != null and registry.path : (/* Machine Hive */""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*"", ""HKLM\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Shell\\*"", /* Users Hive */""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*"",""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\\*"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*"",""HKEY_USERS\\*\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Shell\\*"" ) and /* add commonlegitimate changes without being too restrictive as this is one of themost abused AESPs */ not registry.data.strings : ""ctfmon.exe /n"" andnot (registry.value : ""Application Restart #*"" and process.name :""csrss.exe"") and user.id not in (""S-1-5-18"", ""S-1-5-19"", ""S-1-5-20"")and not registry.data.strings : (""?:\\Program Files\\*.exe"",""?:\\Program Files (x86)\\*.exe"") and not process.executable :(""?:\\Windows\\System32\\msiexec.exe"",""?:\\Windows\\SysWOW64\\msiexec.exe"") and not (process.name :""OneDriveSetup.exe"" and registry.value : (""Delete CachedStandalone Update Binary"", ""Delete Cached Update Binary"", ""amd64"",""Uninstall *"") and registry.data.strings :""?:\\Windows\\system32\\cmd.exe /q /c *\""?:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\*\"""")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/strace-process-activity.html,Strace Process Activityedit,[],[],[],[],Strace runs in a privileged context and can be used to escape restrictive environments by instantiating a shell in order to elevate privileges or move laterally.,['query'],event.category:process and event.type:(start or process_started) andprocess.name:strace,"['auditbeat-*', 'logs-endpoint.events.*']",['https://en.wikipedia.org/wiki/Strace'],"['Elastic', 'Host', 'Linux', 'Threat Detection']"
https://www.elastic.co/guide/en/security/7.16/sublime-plugin-or-application-script-modification.html,Sublime Plugin or Application Script Modificationedit,['Persistence'],['TA0003'],['Compromise Client Software Binary'],['T1554'],Adversaries may create or modify the Sublime application plugins or scripts to execute a malicious payload each time the Sublime application is started.,['eql'],"file where event.type in (""change"", ""creation"") and file.extension :""py"" and file.path : ( ""/Users/*/Library/ApplicationSupport/Sublime Text*/Packages/*.py"", ""/Applications/SublimeText.app/Contents/MacOS/sublime.py"" ) and not process.executable: ( ""/Applications/Sublime Text*.app/Contents/MacOS/SublimeText*"", ""/usr/local/Cellar/git/*/bin/git"",""/usr/libexec/xpcproxy"", ""/System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/Resources/DesktopServicesHelper"", ""/Applications/Sublime Text.app/Contents/MacOS/plugin_host"")","['auditbeat-*', 'logs-endpoint.events.*']",['https://posts.specterops.io/persistent-jxa-66e1c3cd1cf5'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/sudo-heap-based-buffer-overflow-attempt.html,Sudo Heap-Based Buffer Overflow Attemptedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Identifies the attempted use of a heap-based buffer overflow vulnerability for the Sudo binary in Unix-like systems (CVE-2021-3156). Successful exploitation allows an unprivileged user to escalate to the root user.,['threshold'],"event.category:process and event.type:start and process.name:(sudoor sudoedit) and process.args:(*\\ and (""-i"" or ""-s""))","['auditbeat-*', 'logs-endpoint.events.*']","['https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-3156', 'https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit', 'https://www.bleepingcomputer.com/news/security/latest-macos-big-sur-also-has-sudo-root-privilege-escalation-flaw', 'https://www.sudo.ws/alerts/unescape_overflow.html']","['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/sudoers-file-modification.html,Sudoers File Modificationedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],A sudoers file specifies the commands that users or groups can run and from which terminals. Adversaries can take advantage of these configurations to execute commands as other users or spawn processes with higher privileges.,['query'],event.category:file and event.type:change and file.path:(/etc/sudoers*or /private/etc/sudoers*),"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-.net-code-compilation.html,Suspicious .NET Code Compilationedit,['Defense Evasion'],['TA0005'],['Obfuscated Files or Information'],['T1027'],Identifies suspicious .NET code execution. connections.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : (""csc.exe"", ""vbc.exe"") and process.parent.name :(""wscript.exe"", ""mshta.exe"", ""cscript.exe"", ""wmic.exe"", ""svchost.exe"",""rundll32.exe"", ""cmstp.exe"", ""regsvr32.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-activity-reported-by-okta-user.html,Suspicious Activity Reported by Okta Useredit,"['Initial Access', 'Persistence', 'Privilege Escalation', 'Defense Evasion']","['TA0001', 'TA0003', 'TA0004', 'TA0005']","['Valid Accounts', 'Valid Accounts', 'Valid Accounts', 'Valid Accounts']","['T1078', 'T1078', 'T1078', 'T1078']","Detects when a user reports suspicious activity for their Okta account. These events should be investigated, as they can help security teams identify when an adversary is attempting to gain access to their network.",['query'],event.dataset:okta.system andevent.action:user.account.report_suspicious_activity_by_enduser,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/suspicious-automator-workflows-execution.html,Suspicious Automator Workflows Executionedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies the execution of the Automator Workflows process followed by a network connection from its XPC service. Adversaries may drop a custom workflow template that hosts malicious JavaScript for Automation (JXA) code as an alternative to using osascript.,['eql'],"sequence by host.id with maxspan=30s [process where event.type in(""start"", ""process_started"") and process.name == ""automator""][network where process.name:""com.apple.automator.runner""]","['auditbeat-*', 'logs-endpoint.events.*']",['https://posts.specterops.io/persistent-jxa-66e1c3cd1cf5'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-browser-child-process.html,Suspicious Browser Child Processedit,"['Execution', 'Initial Access']","['TA0002', 'TA0001']","['Exploitation for Client Execution', 'Drive-by Compromise']","['T1203', 'T1189']","Identifies the execution of a suspicious browser child process. Adversaries may gain access to a system through a user visiting a website over the normal course of browsing. With this technique, the users web browser is typically targeted for exploitation.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : (""Google Chrome"", ""Google Chrome Helper*"",""firefox"", ""Opera"", ""Safari"", ""com.apple.WebKit.WebContent"",""Microsoft Edge"") and process.name : (""sh"", ""bash"", ""dash"", ""ksh"",""tcsh"", ""zsh"", ""curl"", ""wget"", ""python*"", ""perl*"", ""php*"",""osascript"", ""pwsh"") and process.command_line != null and notprocess.args : ( ""/Library/ApplicationSupport/Microsoft/MAU*/MicrosoftAutoUpdate.app/Contents/MacOS/msupdate"", ""hw.model"",""IOPlatformExpertDevice"", ""/Volumes/Google Chrome/GoogleChrome.app/Contents/Frameworks/*/Resources/install.sh"", ""--defaults-torrc"", ""Chrome.app"", ""Framework.framework/Versions/*/Resources/keystone_promote_preflight.sh"",""/Users/*/Library/ApplicationSupport/Google/Chrome/recovery/*/ChromeRecovery"", ""$DISPLAY"",""GIO_LAUNCHED_DESKTOP_FILE_PID=$$"" )",['logs-endpoint.events.*'],"['https://objective-see.com/blog/blog_0x43.html', 'https://fr.slideshare.net/codeblue_jp/cb19-recent-apt-attack-on-crypto-exchange-employees-by-heungsoo-kang']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Initial Access', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-calendar-file-modification.html,Suspicious Calendar File Modificationedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],Identifies suspicious modifications of the calendar file by an unusual process. Adversaries may create a custom calendar notification procedure to execute a malicious program at a recurring interval to establish persistence.,['query'],event.category:file and event.action:modification andfile.path:/Users/*/Library/Calendars/*.calendar/Events/*.ics andprocess.executable: (* and not ( /System/Library/* or/System/Applications/Calendar.app/Contents/MacOS/* or/usr/libexec/xpcproxy or /sbin/launchd or/Applications/* ) ),"['logs-endpoint.events.*', 'auditbeat-*']","['https://labs.f-secure.com/blog/operationalising-calendar-alerts-persistence-on-macos', 'https://github.com/FSecureLABS/CalendarPersist', 'https://github.com/D00MFist/PersistentJXA/blob/master/CalendarPersist.js']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/suspicious-certutil-commands.html,Suspicious CertUtil Commandsedit,['Defense Evasion'],['TA0005'],['Deobfuscate/Decode Files or Information'],['T1140'],Identifies suspicious commands being used with certutil.exe. CertUtil is a native Windows component which is part of Certificate Services. CertUtil is often abused by attackers to live off the land for stealthier command and control or data exfiltration.,['eql'],"process where event.type == ""start"" and (process.name :""certutil.exe"" or process.pe.original_file_name == ""CertUtil.exe"") andprocess.args : (""?decode"", ""?encode"", ""?urlcache"", ""?verifyctl"",""?encodehex"", ""?decodehex"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://twitter.com/Moriarty_Meng/status/984380793383370752', 'https://twitter.com/egre55/status/1087685529016193025', 'https://www.sysadmins.lv/blog-en/certutil-tips-and-tricks-working-with-x509-file-format.aspx', 'https://docs.microsoft.com/en-us/archive/blogs/pki/basic-crl-checking-with-certutil']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-child-process-of-adobe-acrobat-reader-update-service.html,Suspicious Child Process of Adobe Acrobat Reader Update Serviceedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],"Detects attempts to exploit privilege escalation vulnerabilities related to the Adobe Acrobat Reader PrivilegedHelperTool responsible for installing updates. For more information, refer to CVE-2020-9615, CVE-2020-9614 and CVE-2020-9613 and verify that the impacted system is patched.",['query'],event.category:process and event.type:(start or process_started) andprocess.parent.name:com.adobe.ARMDC.SMJobBlessHelper anduser.name:root and not process.executable:(/Library/PrivilegedHelperTools/com.adobe.ARMDC.SMJobBlessHelper or/usr/bin/codesign or/private/var/folders/zz/*/T/download/ARMDCHammer or/usr/sbin/pkgutil or /usr/bin/shasum or/usr/bin/perl* or /usr/sbin/spctl or/usr/sbin/installer),"['auditbeat-*', 'logs-endpoint.events.*']",['https://rekken.github.io/2020/05/14/Security-Flaws-in-Adobe-Acrobat-Reader-Allow-Malicious-Program-to-Gain-Root-on-macOS-Silently/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-cmd-execution-via-wmi.html,Suspicious Cmd Execution via WMIedit,['Execution'],['TA0002'],['Windows Management Instrumentation'],['T1047'],Identifies suspicious command execution (cmd) via Windows Management Instrumentation (WMI) on a remote host. This could be indicative of adversary lateral movement.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""WmiPrvSE.exe"" and process.name : ""cmd.exe"" andprocess.args : ""\\\\127.0.0.1\\*"" and process.args : (""2>&1"", ""1>"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-dll-loaded-for-persistence-or-privilege-escalation.html,Suspicious DLL Loaded for Persistence or Privilege Escalationedit,"['Privilege Escalation', 'Persistence']","['TA0004', 'TA0003']","['Hijack Execution Flow', 'Hijack Execution Flow']","['T1574', 'T1574']",Identifies the loading of a non Microsoft signed DLL that is missing on a default Windows install (phantom DLL) or one that can be loaded from a different location by a native Windows process. This may be abused to persist or elevate privileges via privileged file write vulnerabilities.,['eql'],"library where dll.name : ( ""wlbsctrl.dll"", ""wbemcomn.dll"",""WptsExtensions.dll"", ""Tsmsisrv.dll"", ""TSVIPSrv.dll"",""Msfte.dll"", ""wow64log.dll"", ""WindowsCoreDeviceInfo.dll"",""Ualapi.dll"", ""wlanhlp.dll"", ""phoneinfo.dll"", ""EdgeGdi.dll"",""cdpsgshims.dll"", ""windowsperformancerecordercontrol.dll"",""diagtrack_win.dll"" ) and not (dll.code_signature.subject_name :(""Microsoft Windows"", ""Microsoft Corporation"") anddll.code_signature.status : ""trusted"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://itm4n.github.io/windows-dll-hijacking-clarified/', 'http://remoteawesomethoughts.blogspot.com/2019/05/windows-10-task-schedulerservice.html', 'https://googleprojectzero.blogspot.com/2018/04/windows-exploitation-tricks-exploiting.html', 'https://shellz.club/edgegdi-dll-for-persistence-and-lateral-movement/', 'https://windows-internals.com/faxing-your-way-to-system/', 'http://waleedassar.blogspot.com/2013/01/wow64logdll.html']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-emond-child-process.html,Suspicious Emond Child Processedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"Identifies the execution of a suspicious child process of the Event Monitor Daemon (emond). Adversaries may abuse this service by writing a rule to execute commands when a defined event occurs, such as system start up or user authentication.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""emond"" and process.name : ( ""bash"",""dash"", ""sh"", ""tcsh"", ""csh"", ""zsh"", ""ksh"", ""fish"",""Python"", ""python*"", ""perl*"", ""php*"", ""osascript"",""pwsh"", ""curl"", ""wget"", ""cp"", ""mv"", ""touch"", ""echo"",""base64"", ""launchctl"")",['logs-endpoint.events.*'],['https://www.xorrior.com/emond-persistence/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/suspicious-endpoint-security-parent-process.html,Suspicious Endpoint Security Parent Processedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],A suspicious Endpoint Security parent process was detected. This may indicate a process hollowing or other form of code injection.,['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.name : (""esensor.exe"", ""elastic-endpoint.exe"") andprocess.parent.executable != null and /* add FPs here */ notprocess.parent.executable : (""C:\\Program Files\\Elastic\\*"",""C:\\Windows\\System32\\services.exe"",""C:\\Windows\\System32\\WerFault*.exe"",""C:\\Windows\\System32\\wermgr.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-execution-short-program-name.html,Suspicious Execution - Short Program Nameedit,[],[],[],[],Identifies process execution with a single character process name. This is often done by adversaries while staging or executing temporary utilities.,['eql'],"process where event.type in (""start"", ""process_started"") andlength(process.name) > 0 and length(process.name) == 5 andhost.os.name == ""Windows"" and length(process.pe.original_file_name) >5","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-execution-from-a-mounted-device.html,Suspicious Execution from a Mounted Deviceedit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']","['Signed Binary Proxy Execution', 'Command and Scripting Interpreter']","['T1218', 'T1059']",Identifies when a script interpreter or signed binary is launched via a non-standard working directory. An attacker may use this technique to evade defenses.,['eql'],"process where event.type == ""start"" and process.executable : ""C:\\*""and (process.working_directory : ""?:\\"" and notprocess.working_directory: ""C:\\"") and process.parent.name :""explorer.exe"" and process.name : (""rundll32.exe"", ""mshta.exe"",""powershell.exe"", ""pwsh.exe"", ""cmd.exe"", ""regsvr32.exe"",""cscript.exe"", ""wscript.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/', 'https://www.volexity.com/blog/2021/05/27/suspected-apt29-operation-launches-election-fraud-themed-phishing-campaigns/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-execution-via-scheduled-task.html,Suspicious Execution via Scheduled Taskedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],Identifies execution of a suspicious program via scheduled tasks by looking at process lineage and command line usage.,['eql'],"process where event.type == ""start"" and /* Schedule servicecmdline on Win10+ */ process.parent.name : ""svchost.exe"" andprocess.parent.args : ""Schedule"" and /* add suspicious programshere */ process.pe.original_file_name in( ""cscript.exe"",""wscript.exe"", ""PowerShell.EXE"",""Cmd.Exe"", ""MSHTA.EXE"",""RUNDLL32.EXE"", ""REGSVR32.EXE"",""MSBuild.exe"", ""InstallUtil.exe"",""RegAsm.exe"", ""RegSvcs.exe"",""msxsl.exe"", ""CONTROL.EXE"",""EXPLORER.EXE"",""Microsoft.Workflow.Compiler.exe"",""msiexec.exe"" ) and /* addsuspicious paths here */ process.args : ( ""C:\\Users\\*"",""C:\\ProgramData\\*"", ""C:\\Windows\\Temp\\*"",""C:\\Windows\\Tasks\\*"", ""C:\\PerfLogs\\*"",""C:\\Intel\\*"", ""C:\\Windows\\Debug\\*"", ""C:\\HP\\*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/suspicious-explorer-child-process.html,Suspicious Explorer Child Processedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],Identifies a suspicious Windows explorer child process. Explorer.exe can be abused to launch malicious scripts or executables from a trusted parent process.,['eql'],"process where event.type in (""start"", ""process_started"") and (process.name : (""cscript.exe"", ""wscript.exe"", ""powershell.exe"",""rundll32.exe"", ""cmd.exe"", ""mshta.exe"", ""regsvr32.exe"") orprocess.pe.original_file_name in (""cscript.exe"", ""wscript.exe"",""PowerShell.EXE"", ""RUNDLL32.EXE"", ""Cmd.Exe"", ""MSHTA.EXE"",""REGSVR32.EXE"") ) and /* Explorer started via DCOM */process.parent.name : ""explorer.exe"" and process.parent.args :""-Embedding"" and not process.parent.args: ( /*Noisy CLSID_SeparateSingleProcessExplorerHost Explorer COM Class IDs*/ ""/factory,{5BD95610-9434-43C2-886C-57852CC8A120}"",""/factory,{ceff45ee-c862-41de-aee2-a022c81eda92}"" )","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/suspicious-hidden-child-process-of-launchd.html,Suspicious Hidden Child Process of Launchdedit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']","['Create or Modify System Process', 'Hide Artifacts']","['T1543', 'T1564']","Identifies the execution of a launchd child process with a hidden file. An adversary can establish persistence by installing a new logon item, launch agent, or daemon that executes upon login.",['query'],event.category:process and event.type:(start or process_started) andprocess.name:.* and process.parent.executable:/sbin/launchd,"['auditbeat-*', 'logs-endpoint.events.*']","['https://objective-see.com/blog/blog_0x61.html', 'https://www.intezer.com/blog/research/operation-electrorat-attacker-creates-fake-companies-to-drain-your-crypto-wallets/', 'https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-image-load-taskschd.dll-from-ms-office.html,Suspicious Image Load (taskschd.dll) from MS Officeedit,['Persistence'],['TA0003'],['Scheduled Task/Job'],['T1053'],Identifies a suspicious image load (taskschd.dll) from Microsoft Office processes. This behavior may indicate adversarial activity where a scheduled task is configured via Windows Component Object Model (COM). This technique can be used to configure persistence and evade monitoring by avoiding the usage of the traditional Windows binary (schtasks.exe) used to manage scheduled tasks.,['eql'],"library where process.name : (""WINWORD.EXE"", ""EXCEL.EXE"",""POWERPNT.EXE"", ""MSPUB.EXE"", ""MSACCESS.EXE"") and event.action :""load"" and event.category : ""library"" and dll.name :""taskschd.dll""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16', 'https://www.clearskysec.com/wp-content/uploads/2020/10/Operation-Quicksand.pdf']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/suspicious-imagepath-service-creation.html,Suspicious ImagePath Service Creationedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],Identifies the creation of a suspicious ImagePath value. This could be an indication of an adversary attempting to stealthily persist or escalate privileges through abnormal service creation.,['eql'],"registry where registry.path :""HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ImagePath"" and /* addsuspicious registry ImagePath values here */ registry.data.strings :(""%COMSPEC%*"", ""*\\.\\pipe\\*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/suspicious-jar-child-process.html,Suspicious JAR Child Processedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies suspicious child processes of a Java Archive (JAR) file. JAR files may be used to deliver malware in order to evade detection.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""java"" and process.name : (""sh"", ""bash"",""dash"", ""ksh"", ""tcsh"", ""zsh"", ""curl"", ""wget"") and process.args :""-jar"" and process.args : ""*.jar"" and /* Add any FP's here */ notprocess.executable : (""/Users/*/.sdkman/*"",""/Library/Java/JavaVirtualMachines/*"") and not process.args :(""/usr/local/*"", ""/Users/*/github.com/*"", ""/Users/*/src/*"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-ms-office-child-process.html,Suspicious MS Office Child Processedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies suspicious child processes of frequently targeted Microsoft Office applications (Word, PowerPoint, Excel). These child processes are often launched during exploitation of Office applications or from documents with malicious macros.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : (""eqnedt32.exe"", ""excel.exe"", ""fltldr.exe"",""msaccess.exe"", ""mspub.exe"", ""powerpnt.exe"", ""winword.exe"") andprocess.name : (""Microsoft.Workflow.Compiler.exe"", ""arp.exe"",""atbroker.exe"", ""bginfo.exe"", ""bitsadmin.exe"", ""cdb.exe"",""certutil.exe"", ""cmd.exe"", ""cmstp.exe"", ""control.exe"",""cscript.exe"", ""csi.exe"", ""dnx.exe"", ""dsget.exe"", ""dsquery.exe"",""forfiles.exe"", ""fsi.exe"", ""ftp.exe"", ""gpresult.exe"",""hostname.exe"", ""ieexec.exe"", ""iexpress.exe"", ""installutil.exe"",""ipconfig.exe"", ""mshta.exe"", ""msxsl.exe"",""nbtstat.exe"", ""net.exe"", ""net1.exe"", ""netsh.exe"", ""netstat.exe"",""nltest.exe"", ""odbcconf.exe"", ""ping.exe"",""powershell.exe"", ""pwsh.exe"", ""qprocess.exe"", ""quser.exe"",""qwinsta.exe"", ""rcsi.exe"", ""reg.exe"", ""regasm.exe"",""regsvcs.exe"", ""regsvr32.exe"", ""sc.exe"", ""schtasks.exe"",""systeminfo.exe"", ""tasklist.exe"", ""tracert.exe"", ""whoami.exe"",""wmic.exe"", ""wscript.exe"", ""xwizard.exe"", ""explorer.exe"",""rundll32.exe"", ""hh.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/suspicious-ms-outlook-child-process.html,Suspicious MS Outlook Child Processedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],Identifies suspicious child processes of Microsoft Outlook. These child processes are often associated with spear phishing activity.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""outlook.exe"" and process.name :(""Microsoft.Workflow.Compiler.exe"", ""arp.exe"", ""atbroker.exe"",""bginfo.exe"", ""bitsadmin.exe"", ""cdb.exe"",""certutil.exe"", ""cmd.exe"", ""cmstp.exe"", ""cscript.exe"", ""csi.exe"",""dnx.exe"", ""dsget.exe"", ""dsquery.exe"",""forfiles.exe"", ""fsi.exe"", ""ftp.exe"", ""gpresult.exe"", ""hostname.exe"",""ieexec.exe"", ""iexpress.exe"", ""installutil.exe"",""ipconfig.exe"", ""mshta.exe"", ""msxsl.exe"", ""nbtstat.exe"", ""net.exe"",""net1.exe"", ""netsh.exe"", ""netstat.exe"", ""nltest.exe"", ""odbcconf.exe"",""ping.exe"", ""powershell.exe"", ""pwsh.exe"",""qprocess.exe"", ""quser.exe"", ""qwinsta.exe"", ""rcsi.exe"", ""reg.exe"",""regasm.exe"", ""regsvcs.exe"", ""regsvr32.exe"",""sc.exe"", ""schtasks.exe"", ""systeminfo.exe"", ""tasklist.exe"",""tracert.exe"", ""whoami.exe"", ""wmic.exe"", ""wscript.exe"", ""xwizard.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/suspicious-managed-code-hosting-process.html,Suspicious Managed Code Hosting Processedit,['Defense Evasion'],['TA0005'],['Process Injection'],['T1055'],Identifies a suspicious managed code hosting process which could indicate code injection or other form of suspicious code execution.,['eql'],"sequence by process.entity_id with maxspan=5m [process whereevent.type == ""start"" and process.name : (""wscript.exe"",""cscript.exe"", ""mshta.exe"", ""wmic.exe"", ""regsvr32.exe"", ""svchost.exe"",""dllhost.exe"", ""cmstp.exe"")] [file where event.type != ""deletion"" andfile.name : (""wscript.exe.log"", ""cscript.exe"",""mshta.exe.log"", ""wmic.exe.log"",""svchost.exe.log"", ""dllhost.exe.log"",""cmstp.exe.log"", ""regsvr32.exe.log"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://web.archive.org/web/20230329154538/https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-pdf-reader-child-process.html,Suspicious PDF Reader Child Processedit,['Execution'],['TA0002'],['User Execution'],['T1204'],Identifies suspicious child processes of PDF reader applications. These child processes are often launched via exploitation of PDF applications or social engineering.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : (""AcroRd32.exe"",""Acrobat.exe"", ""FoxitPhantomPDF.exe"",""FoxitReader.exe"") and process.name : (""arp.exe"", ""dsquery.exe"",""dsget.exe"", ""gpresult.exe"", ""hostname.exe"", ""ipconfig.exe"",""nbtstat.exe"", ""net.exe"", ""net1.exe"", ""netsh.exe"",""netstat.exe"", ""nltest.exe"", ""ping.exe"", ""qprocess.exe"",""quser.exe"", ""qwinsta.exe"", ""reg.exe"", ""sc.exe"", ""systeminfo.exe"",""tasklist.exe"", ""tracert.exe"", ""whoami.exe"",""bginfo.exe"", ""cdb.exe"", ""cmstp.exe"", ""csi.exe"", ""dnx.exe"", ""fsi.exe"",""ieexec.exe"", ""iexpress.exe"", ""installutil.exe"",""Microsoft.Workflow.Compiler.exe"", ""msbuild.exe"", ""mshta.exe"",""msxsl.exe"", ""odbcconf.exe"", ""rcsi.exe"", ""regsvr32.exe"",""xwizard.exe"", ""atbroker.exe"", ""forfiles.exe"",""schtasks.exe"", ""regasm.exe"", ""regsvcs.exe"", ""cmd.exe"", ""cscript.exe"",""powershell.exe"", ""pwsh.exe"", ""wmic.exe"", ""wscript.exe"",""bitsadmin.exe"", ""certutil.exe"", ""ftp.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-portable-executable-encoded-in-powershell-script.html,Suspicious Portable Executable Encoded in Powershell Scriptedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],"This rule detects the presence of Portable Executables in a PowerShell Script by Looking for its encoded header. Attackers embed PEs into PowerShell Scripts for Injecting them into the memory, avoiding defenses by not writing to disk.,",['query'],"event.code:""4104"" and powershell.file.script_block_text : (TVqQAAMAAAAEAAAA )","['winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-powershell-engine-imageload.html,Suspicious PowerShell Engine ImageLoadedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],"Identifies the PowerShell engine being invoked by unexpected processes. Rather than executing PowerShell functionality with powershell.exe, some attackers do this to operate more stealthily.",['eql'],"library where dll.name : (""System.Management.Automation.ni.dll"",""System.Management.Automation.dll"") and /* add false positivesrelevant to your environment here */ not process.executable :(""C:\\Windows\\System32\\RemoteFXvGPUDisablement.exe"",""C:\\Windows\\System32\\sdiagnhost.exe"") and not process.executableregex~ """"""C:\\Program Files( \(x86\))?\\*\.exe"""""" and notprocess.name : ( ""Altaro.SubAgent.exe"", ""AppV_Manage.exe"",""azureadconnect.exe"", ""CcmExec.exe"", ""configsyncrun.exe"",""choco.exe"", ""ctxappvservice.exe"", ""DVLS.Console.exe"",""edgetransport.exe"", ""exsetup.exe"",""forefrontactivedirectoryconnector.exe"", ""InstallUtil.exe"",""JenkinsOnDesktop.exe"",""Microsoft.EnterpriseManagement.ServiceManager.UI.Console.exe"",""mmc.exe"", ""mscorsvw.exe"", ""msexchangedelivery.exe"",""msexchangefrontendtransport.exe"", ""msexchangehmworker.exe"",""msexchangesubmission.exe"", ""msiexec.exe"", ""MsiExec.exe"",""noderunner.exe"", ""NServiceBus.Host.exe"",""NServiceBus.Host32.exe"",""NServiceBus.Hosting.Azure.HostProcess.exe"", ""OuiGui.WPF.exe"",""powershell.exe"", ""powershell_ise.exe"", ""pwsh.exe"",""SCCMCliCtrWPF.exe"", ""ScriptEditor.exe"", ""ScriptRunner.exe"",""sdiagnhost.exe"", ""servermanager.exe"", ""setup100.exe"",""ServiceHub.VSDetouredHost.exe"", ""SPCAF.Client.exe"",""SPCAF.SettingsEditor.exe"", ""SQLPS.exe"",""telemetryservice.exe"", ""UMWorkerProcess.exe"", ""w3wp.exe"",""wsmprovhost.exe"" )","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-powershell-script.html,Suspicious Powershell Scriptedit,[],[],[],[],"A machine learning job detected a PowerShell script with unusual data characteristics, such as obfuscation, that may be a characteristic of malicious PowerShell script text blocks.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/suspicious-print-spooler-file-deletion.html,Suspicious Print Spooler File Deletionedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Detects deletion of print driver files by an unusual process. This may indicate a clean up attempt post successful privilege escalation via Print Spooler service related vulnerabilities.,['eql'],"file where event.type : ""deletion"" and not process.name :(""spoolsv.exe"", ""dllhost.exe"", ""explorer.exe"") and file.path :""?:\\Windows\\System32\\spool\\drivers\\x64\\3\\*.dll""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527', 'https://github.com/afwu/PrintNightmare']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-print-spooler-point-and-print-dll.html,Suspicious Print Spooler Point and Print DLLedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Detects attempts to exploit a privilege escalation vulnerability (CVE-2020-1030) related to the print spooler service. Exploitation involves chaining multiple primitives to load an arbitrary DLL into the print spooler process running as SYSTEM.,['eql'],"sequence by host.id with maxspan=30s [registry where registry.path :""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Print\\Printers\\*\\SpoolDirectory"" andregistry.data.strings :""C:\\Windows\\System32\\spool\\drivers\\x64\\4""] [registry whereregistry.path : ""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Print\\Printers\\*\\CopyFiles\\Payload\\Module""and registry.data.strings :""C:\\Windows\\System32\\spool\\drivers\\x64\\4\\*""]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.accenture.com/us-en/blogs/cyber-defense/discovering-exploiting-shutting-down-dangerous-windows-print-spooler-vulnerability', 'https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Privilege%20Escalation/privesc_sysmon_cve_20201030_spooler.evtx', 'https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-1030']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-printspooler-spl-file-created.html,Suspicious PrintSpooler SPL File Creatededit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Detects attempts to exploit privilege escalation vulnerabilities related to the Print Spooler service including CVE-2020-1048 and CVE-2020-1337. .,['eql'],"file where event.type != ""deletion"" and file.extension : ""spl"" andfile.path : ""?:\\Windows\\System32\\spool\\PRINTERS\\*"" and notprocess.name : (""spoolsv.exe"",""printfilterpipelinesvc.exe"",""PrintIsolationHost.exe"", ""splwow64.exe"",""msiexec.exe"", ""poqexec.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://safebreach.com/Post/How-we-bypassed-CVE-2020-1048-Patch-and-got-CVE-2020-1337'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-printspooler-service-executable-file-creation.html,Suspicious PrintSpooler Service Executable File Creationedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],"Detects attempts to exploit privilege escalation vulnerabilities related to the Print Spooler service. For more information refer to the following CVEs - CVE-2020-1048, CVE-2020-1337 and CVE-2020-1300 and verify that the impacted system is patched.",['eql'],"file where event.type != ""deletion"" and process.name : ""spoolsv.exe""and file.extension : (""exe"", ""dll"") and not file.path :(""?:\\Windows\\System32\\spool\\*"", ""?:\\Windows\\Temp\\*"",""?:\\Users\\*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://voidsec.com/cve-2020-1337-printdemon-is-dead-long-live-printdemon/', 'https://www.thezdi.com/blog/2020/7/8/cve-2020-1300-remote-code-execution-through-microsoft-windows-cab-files']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/suspicious-process-access-via-direct-system-call.html,Suspicious Process Access via Direct System Calledit,['Defense Evasion'],['TA0005'],['Process Injection'],['T1055'],Identifies suspicious process access events from unknown memory region. Endpoint security solutions usually hook userland Windows APIs in order to decide if the code that is being executed is malicious or not. Its possible to bypass hooked functions by writing malicious functions that call syscalls directly.,['eql'],"process where event.code == ""10"" andlength(winlog.event_data.CallTrace) > 0 and /* Sysmon CallTracestarting with unknown memory module instead of ntdll which hostWindows NT Syscalls */ not winlog.event_data.CallTrace :(""?:\\WINDOWS\\SYSTEM32\\ntdll.dll*"",""?:\\WINDOWS\\SysWOW64\\ntdll.dll*"")","['winlogbeat-*', 'logs-windows.*']","['https://twitter.com/SBousseaden/status/1278013896440324096', 'https://www.ired.team/offensive-security/defense-evasion/using-syscalls-directly-from-visual-studio-to-bypass-avs-edrs']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-process-execution-via-renamed-psexec-executable.html,Suspicious Process Execution via Renamed PsExec Executableedit,['Execution'],['TA0002'],['System Services'],['T1569'],"Identifies suspicious psexec activity which is executing from the psexec service that has been renamed, possibly to evade detection.",['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.pe.original_file_name : ""psexesvc.exe"" and not process.name :""PSEXESVC.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-process-from-conhost.html,Suspicious Process from Conhostedit,['Defense Evasion'],['TA0005'],['Process Injection'],['T1055'],Identifies a suspicious Conhost child process which may be an indication of code injection activity.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""conhost.exe"" and not process.executable :(""?:\\Windows\\splwow64.exe"", ""?:\\Windows\\System32\\WerFault.exe"",""?:\\Windows\\System32\\conhost.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://modexp.wordpress.com/2018/09/12/process-injection-user-data/', 'https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Defense%20Evasion/evasion_codeinj_odzhan_conhost_sysmon_10_1.evtx']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-rdp-activex-client-loaded.html,Suspicious RDP ActiveX Client Loadededit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],"Identifies suspicious Image Loading of the Remote Desktop Services ActiveX Client (mstscax), this may indicate the presence of RDP lateral movement capability.",['eql'],"library where dll.name : ""mstscax.dll"" and /* depending on noise inyour env add here extra paths */ process.executable : (""C:\\Windows\\*"", ""C:\\Users\\Public\\*"",""C:\\Users\\Default\\*"", ""C:\\Intel\\*"", ""C:\\PerfLogs\\*"",""C:\\ProgramData\\*"", ""\\Device\\Mup\\*"", ""\\\\*"" ) and/* add here FPs */ not process.executable :(""C:\\Windows\\System32\\mstsc.exe"",""C:\\Windows\\SysWOW64\\mstsc.exe"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",['https://posts.specterops.io/revisiting-remote-desktop-lateral-movement-8fb905cb46c3'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/suspicious-script-object-execution.html,Suspicious Script Object Executionedit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies scrobj.dll loaded into unusual Microsoft processes. This usually means a malicious scriptlet is being executed in the target process.,['eql'],"sequence by process.entity_id with maxspan=2m [process whereevent.type == ""start"" and (process.code_signature.subject_name in(""Microsoft Corporation"", ""Microsoft Windows"") andprocess.code_signature.trusted == true) and notprocess.executable : ( ""?:\\Windows\\System32\\cscript.exe"",""?:\\Windows\\SysWOW64\\cscript.exe"", ""?:\\Program Files(x86)\\Internet Explorer\\iexplore.exe"", ""?:\\ProgramFiles\\Internet Explorer\\iexplore.exe"", ""?:\\Windows\\SystemApps\\Microsoft.MicrosoftEdge_*\\MicrosoftEdge.exe"",""?:\\Windows\\system32\\msiexec.exe"",""?:\\Windows\\SysWOW64\\msiexec.exe"",""?:\\Windows\\System32\\smartscreen.exe"",""?:\\Windows\\system32\\taskhostw.exe"",""?:\\windows\\system32\\inetsrv\\w3wp.exe"",""?:\\windows\\SysWOW64\\inetsrv\\w3wp.exe"",""?:\\Windows\\system32\\wscript.exe"",""?:\\Windows\\SysWOW64\\wscript.exe"",""?:\\Windows\\system32\\mobsync.exe"",""?:\\Windows\\SysWOW64\\mobsync.exe"",""?:\\Windows\\System32\\cmd.exe"",""?:\\Windows\\SysWOW64\\cmd.exe"")] [library where event.type ==""start"" and dll.name : ""scrobj.dll""]",['logs-endpoint.events.*'],N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-solarwinds-child-process.html,Suspicious SolarWinds Child Processedit,"['Execution', 'Initial Access']","['TA0002', 'TA0001']","['Native API', 'Supply Chain Compromise']","['T1106', 'T1195']","A suspicious SolarWinds child process was detected, which may indicate an attempt to execute malicious programs.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name: (""SolarWinds.BusinessLayerHost.exe"",""SolarWinds.BusinessLayerHostx64.exe"") and not process.name : (""APMServiceControl*.exe"", ""ExportToPDFCmd*.Exe"",""SolarWinds.Credentials.Orion.WebApi*.exe"",""SolarWinds.Orion.Topology.Calculator*.exe"", ""Database-Maint.exe"", ""SolarWinds.Orion.ApiPoller.Service.exe"",""WerFault.exe"", ""WerMgr.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html', 'https://github.com/fireeye/sunburst_countermeasures/blob/main/rules/SUNBURST/hxioc/SOLARWINDS%20SUSPICIOUS%20CHILD%20PROCESSES%20(METHODOLOGY).ioc']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-startup-shell-folder-modification.html,Suspicious Startup Shell Folder Modificationedit,['Persistence'],['TA0003'],['Boot or Logon Autostart Execution'],['T1547'],Identifies suspicious startup shell folder modifications to change the default Startup directory in order to bypass detections monitoring file creation in the Windows Startup folder.,['eql'],"registry where registry.path : (""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserShell Folders\\Common Startup"",""HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellFolders\\Common Startup"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\\Startup"", ""HKEY_USERS\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\Startup"" ) and registry.data.strings != null and/* Normal Startup Folder Paths */ not registry.data.strings : (""C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup"",""%ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup"",""%USERPROFILE%\\AppData\\Roaming\\Microsoft\\Windows\\StartMenu\\Programs\\Startup"",""C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\StartMenu\\Programs\\Startup"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/suspicious-wmi-image-load-from-ms-office.html,Suspicious WMI Image Load from MS Officeedit,['Execution'],['TA0002'],['Windows Management Instrumentation'],['T1047'],Identifies a suspicious image load (wmiutils.dll) from Microsoft Office processes. This behavior may indicate adversarial activity where child processes are spawned via Windows Management Instrumentation (WMI). This technique can be used to execute code and evade traditional parent/child processes spawned from Microsoft Office products.,['eql'],"library where process.name : (""WINWORD.EXE"", ""EXCEL.EXE"",""POWERPNT.EXE"", ""MSPUB.EXE"", ""MSACCESS.EXE"") and event.action :""load"" and event.category : ""library"" and dll.name :""wmiutils.dll""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/suspicious-wmic-xsl-script-execution.html,Suspicious WMIC XSL Script Executionedit,['Defense Evasion'],['TA0005'],['XSL Script Processing'],['T1220'],Identifies WMIC whitelisting bypass techniques by alerting on suspicious execution of scripts. When WMIC loads scripting libraries it may be indicative of a whitelist bypass.,['eql'],"sequence by process.entity_id with maxspan = 2m [process whereevent.type in (""start"", ""process_started"") and (process.name :""WMIC.exe"" or process.pe.original_file_name : ""wmic.exe"") andprocess.args : (""format*:*"", ""/format*:*"", ""*-format*:*"") and notprocess.command_line : ""* /format:table *""] [library where event.type== ""start"" and dll.name : (""jscript.dll"", ""vbscript.dll"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-werfault-child-process.html,Suspicious WerFault Child Processedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],"A suspicious WerFault child process was detected, which may indicate an attempt to run unnoticed. Verify process details such as command line, network connections, file writes and parent process details as well.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""WerFault.exe"" and not process.name :(""cofire.exe"", ""psr.exe"",""VsJITDebugger.exe"", ""TTTracer.exe"",""rundll32.exe"", ""LogiOptionsMgr.exe"") and notprocess.args : (""/LOADSAVEDWINDOWS"", ""/restore"",""RestartByRestartManager*"", ""--restarted"",""createdump"", ""dontsend"",""/watson"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.hexacorn.com/blog/2019/09/19/silentprocessexit-quick-look-under-the-hood/', 'https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Persistence/persistence_SilentProcessExit_ImageHijack_sysmon_13_1.evtx', 'https://web.archive.org/web/20230530011556/https://blog.menasec.net/2021/01/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-zoom-child-process.html,Suspicious Zoom Child Processedit,['Defense Evasion'],['TA0005'],['Masquerading'],['T1036'],"A suspicious Zoom child process was detected, which may indicate an attempt to run unnoticed. Verify process details such as command line, network connections, file writes and associated file signature details as well.",['eql'],"process where event.type in (""start"", ""process_started"", ""info"") andprocess.parent.name : ""Zoom.exe"" and process.name : (""cmd.exe"",""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/suspicious-macos-ms-office-child-process.html,Suspicious macOS MS Office Child Processedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies suspicious child processes of frequently targeted Microsoft Office applications (Word, PowerPoint, and Excel). These child processes are often launched during exploitation of Office applications or by documents with malicious macros.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name:(""Microsoft Word"", ""Microsoft PowerPoint"",""Microsoft Excel"") and process.name: ( ""bash"", ""dash"",""sh"", ""tcsh"", ""csh"", ""zsh"", ""ksh"", ""fish"",""python*"", ""perl*"", ""php*"", ""osascript"", ""pwsh"",""curl"", ""wget"", ""cp"", ""mv"", ""base64"", ""launchctl"") and /* noisy false positives related to product version discoveryand office errors reporting */ not process.args: (""ProductVersion"", ""hw.model"", ""ioreg"",""ProductName"", ""ProductUserVisibleVersion"",""ProductBuildVersion"", ""/Library/ApplicationSupport/Microsoft/MERP*/Microsoft ErrorReporting.app/Contents/MacOS/Microsoft Error Reporting"" )",['logs-endpoint.events.*'],['https://blog.malwarebytes.com/cybercrime/2017/02/microsoft-office-macro-malware-targets-macs/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/svchost-spawning-cmd.html,Svchost spawning Cmdedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies a suspicious parent child process relationship with cmd.exe descending from svchost.exe,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""svchost.exe"" and process.name : ""cmd.exe"" andnot (process.pe.original_file_name == ""Cmd.Exe"" and process.args :""?:\\Program Files\\Npcap\\CheckStatus.bat??"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/system-log-file-deletion.html,System Log File Deletionedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Identifies the deletion of sensitive Linux system logs. This may indicate an attempt to evade detection or destroy forensic evidence on a system.,['eql'],"file where event.type == ""deletion"" and file.path : (""/var/run/utmp"", ""/var/log/wtmp"", ""/var/log/btmp"",""/var/log/lastlog"", ""/var/log/faillog"", ""/var/log/syslog"",""/var/log/messages"", ""/var/log/secure"", ""/var/log/auth.log"")","['auditbeat-*', 'logs-endpoint.events.*']",['https://www.fireeye.com/blog/threat-research/2020/11/live-off-the-land-an-overview-of-unc1945.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/system-shells-via-services.html,System Shells via Servicesedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],Windows services typically run as SYSTEM and can be used as a privilege escalation opportunity. Malware or penetration testers may run a shell as a service to gain SYSTEM permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""services.exe"" and process.name : (""cmd.exe"",""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"") and /* Thirdparty FP's */ not process.args : ""NVDisplay.ContainerLocalSystem""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/systemkey-access-via-command-line.html,SystemKey Access via Command Lineedit,['Credential Access'],['TA0006'],['Credentials from Password Stores'],['T1555'],"Keychains are the built-in way for macOS to keep track of users' passwords and credentials for many services and features, including Wi-Fi and website passwords, secure notes, certificates, and Kerberos. Adversaries may collect the keychain storage data from a system to acquire credentials.",['query'],"event.category:process and event.type:(start or process_started) andprocess.args:""/private/var/db/SystemKey""","['auditbeat-*', 'logs-endpoint.events.*']",['https://github.com/AlessandroZ/LaZagne/blob/master/Mac/lazagne/softwares/system/chainbreaker.py'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/tcc-bypass-via-mounted-apfs-snapshot-access.html,TCC Bypass via Mounted APFS Snapshot Accessedit,['Defense Evasion'],['TA0005'],['Direct Volume Access'],['T1006'],"Identifies the use of the mount_apfs command to mount the entire file system through Apple File System (APFS) snapshots as read-only and with the noowners flag set. This action enables the adversary to access almost any file in the file system, including all user data and files protected by Apples privacy framework (TCC).",['query'],event.category : process and event.type : (start or process_started)and process.name : mount_apfs and process.args :(/System/Volumes/Data and noowners),"['auditbeat-*', 'logs-endpoint.events.*']",['https://theevilbit.github.io/posts/cve_2020_9771/'],"['Elastic', 'Host', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/tampering-of-bash-command-line-history.html,Tampering of Bash Command-Line Historyedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Adversaries may attempt to clear or disable the Bash command-line history in an attempt to evade detection or forensic investigations.,['eql'],"process where event.type in (""start"", ""process_started"") and ((process.args : (""rm"", ""echo"") and process.args : ("".bash_history"",""/root/.bash_history"", ""/home/*/.bash_history"")) or (process.name :""history"" and process.args : ""-c"") or (process.args : ""export"" andprocess.args : (""HISTFILE=/dev/null"", ""HISTFILESIZE=0"")) or(process.args : ""unset"" and process.args : ""HISTFILE"") or(process.args : ""set"" and process.args : ""history"" and process.args :""+o"") )","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/telnet-port-activity.html,Telnet Port Activityedit,"['Command and Control', 'Lateral Movement', 'Initial Access']","['TA0011', 'TA0008', 'TA0001']","['Remote Services', 'Exploit Public-Facing Application']","['T1021', 'T1190']","This rule detects network events that may indicate the use of Telnet traffic. Telnet is commonly used by system administrators to remotely control older or embedded systems using the command line shell. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector. As a plain-text protocol, it may also expose usernames and passwords to anyone capable of observing the traffic.",['query'],event.category:(network or network_traffic) and network.transport:tcpand destination.port:23,"['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/third-party-backup-files-deleted-via-unexpected-process.html,Third-party Backup Files Deleted via Unexpected Processedit,['Impact'],['TA0040'],['Inhibit System Recovery'],['T1490'],"Identifies the deletion of backup files, saved using third-party software, by a process outside of the backup suite. Adversaries may delete Backup files to ensure that recovery from a Ransomware attack is less likely.",['eql'],"file where event.type == ""deletion"" and ( /* Veeam Related BackupFiles */ (file.extension : (""VBK"", ""VIB"", ""VBM"") and notprocess.executable : (""?:\\Windows\\Veeam\\Backup\\*"",""?:\\Program Files\\Veeam\\Backup and Replication\\*"",""?:\\Program Files (x86)\\Veeam\\Backup and Replication\\*"")) or /*Veritas Backup Exec Related Backup File */ (file.extension : ""BKF""and not process.executable : (""?:\\Program Files\\Veritas\\BackupExec\\*"", ""?:\\Program Files(x86)\\Veritas\\Backup Exec\\*"")) )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.advintel.io/post/backup-removal-solutions-from-conti-ransomware-with-love'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/threat-detected-by-okta-threatinsight.html,Threat Detected by Okta ThreatInsightedit,[],[],[],[],"Detects when Okta ThreatInsight identifies a request from a malicious IP address. Investigating requests from IP addresses identified as malicious by Okta ThreatInsight can help security teams monitor for and respond to credential based attacks against their organization, such as brute force and password spraying attacks.",['query'],event.dataset:okta.system and event.action:security.threat.detected,"['filebeat-*', 'logs-okta*']","['https://developer.okta.com/docs/reference/api/system-log/', 'https://developer.okta.com/docs/reference/api/event-types/']","['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/threat-intel-filebeat-module-indicator-match.html,Threat Intel Filebeat Module Indicator Matchedit,[],[],[],[],This rule is triggered when indicators from the Threat Intel Filebeat module has a match against local file or network observations.,['threat_match'],file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:*or url.full:* or registry.path:*,"['auditbeat-*', 'endgame-*', 'filebeat-*', 'logs-*', 'packetbeat-*', 'winlogbeat-*']",['/guide/en/beats/filebeat/current/filebeat-module-threatintel.html'],"['Elastic', 'Windows', 'Elastic Endgame', 'Network', 'Continuous Monitoring', 'SecOps', 'Monitoring']"
https://www.elastic.co/guide/en/security/7.16/timestomping-using-touch-command.html,Timestomping using Touch Commandedit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],"Timestomping is an anti-forensics technique which is used to modify the timestamps of a file, often to mimic files that are in the same folder.",['eql'],"process where event.type == ""start"" and process.name : ""touch"" anduser.id != ""0"" and process.args : (""-r"", ""-t"", ""-a*"",""-m*"") and notprocess.args : (""/usr/lib/go-*/bin/go"", ""/usr/lib/dracut/dracut-functions.sh"", ""/tmp/KSInstallAction.*/m/.patch/*"")","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-attempt-via-elevated-com-internet-explorer-add-on-installer.html,UAC Bypass Attempt via Elevated COM Internet Explorer Add-On Installeredit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies User Account Control (UAC) bypass attempts by abusing an elevated COM Interface to launch a malicious program. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.executable : ""C:\\*\\AppData\\*\\Temp\\IDC*.tmp\\*.exe"" andprocess.parent.name : ""ieinstal.exe"" and process.parent.args :""-Embedding"" /* uncomment once in winlogbeat */ /* and not(process.code_signature.subject_name == ""Microsoft Corporation"" andprocess.code_signature.trusted == true) */","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://swapcontext.blogspot.com/2020/11/uac-bypasses-from-comautoapprovallist.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-attempt-via-privileged-ifileoperation-com-interface.html,UAC Bypass Attempt via Privileged IFileOperation COM Interfaceedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies attempts to bypass User Account Control (UAC) via DLL side-loading. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.,['eql'],"file where event.type : ""change"" and process.name : ""dllhost.exe"" and/* Known modules names side loaded into process running with high orsystem integrity level for UAC Bypass, update here for new modules */file.name : (""wow64log.dll"", ""comctl32.dll"", ""DismCore.dll"",""OskSupport.dll"", ""duser.dll"", ""Accessibility.ni.dll"") and /* has noimpact on rule logic just to avoid OS install related FPs */ notfile.path : (""C:\\Windows\\SoftwareDistribution\\*"",""C:\\Windows\\WinSxS\\*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://github.com/hfiref0x/UACME'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-attempt-via-windows-directory-masquerading.html,UAC Bypass Attempt via Windows Directory Masqueradingedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies an attempt to bypass User Account Control (UAC) by masquerading as a Microsoft trusted Windows directory. Attackers may bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.args : (""C:\\Windows \\system32\\*.exe"", ""C:\\Windows\\SysWOW64\\*.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://medium.com/tenable-techblog/uac-bypass-by-mocking-trusted-directories-24a96675f6e'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-attempt-with-ieditionupgrademanager-elevated-com-interface.html,UAC Bypass Attempt with IEditionUpgradeManager Elevated COM Interfaceedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies attempts to bypass User Account Control (UAC) by abusing an elevated COM Interface to launch a rogue Windows ClipUp program. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""Clipup.exe"" and not process.executable :""C:\\Windows\\System32\\ClipUp.exe"" and process.parent.name :""dllhost.exe"" and /* CLSID of the Elevated COM InterfaceIEditionUpgradeManager */ process.parent.args :""/Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://github.com/hfiref0x/UACME'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-via-diskcleanup-scheduled-task-hijack.html,UAC Bypass via DiskCleanup Scheduled Task Hijackedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies User Account Control (UAC) bypass via hijacking DiskCleanup Scheduled Task. Attackers bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type == ""start"" and process.args : ""/autoclean""and process.args : ""/d"" and not process.executable :(""C:\\Windows\\System32\\cleanmgr.exe"",""C:\\Windows\\SysWOW64\\cleanmgr.exe"",""C:\\Windows\\System32\\taskhostw.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-via-icmluautil-elevated-com-interface.html,UAC Bypass via ICMLuaUtil Elevated COM Interfaceedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies User Account Control (UAC) bypass attempts via the ICMLuaUtil Elevated COM interface. Attackers may attempt to bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name == ""dllhost.exe"" and process.parent.args in(""/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}"",""/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}"") andprocess.pe.original_file_name != ""WerFault.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/uac-bypass-via-windows-firewall-snap-in-hijack.html,UAC Bypass via Windows Firewall Snap-In Hijackedit,['Privilege Escalation'],['TA0004'],['Abuse Elevation Control Mechanism'],['T1548'],Identifies attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in. Attackers bypass UAC to stealthily execute code with elevated permissions.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name == ""mmc.exe"" and /*process.Ext.token.integrity_level_name == ""high"" can be added infuture for tuning */ /* args of the Windows Firewall SnapIn */process.parent.args == ""WF.msc"" and process.name != ""WerFault.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://github.com/AzAgarampur/byeintegrity-uac'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/unauthorized-access-to-an-okta-application.html,Unauthorized Access to an Okta Applicationedit,"['Initial Access', 'Defense Evasion', 'Persistence', 'Privilege Escalation']","['TA0001', 'TA0005', 'TA0003', 'TA0004']",['Valid Accounts'],['T1078'],Identifies when an unauthorized access attempt is made by a user for an Okta application.,['query'],event.dataset:okta.system andevent.action:app.generic.unauth_app_access_attempt,"['filebeat-*', 'logs-okta*']",N/A,"['Elastic', 'Identity', 'Okta', 'Continuous Monitoring', 'SecOps', 'Identity and Access']"
https://www.elastic.co/guide/en/security/7.16/uncommon-registry-persistence-change.html,Uncommon Registry Persistence Changeedit,"['Persistence', 'Defense Evasion']","['TA0003', 'TA0005']","['Boot or Logon Autostart Execution', 'Modify Registry']","['T1547', 'T1112']",Detects changes to registry persistence keys that are uncommonly used or modified by legitimate programs. This could be an indication of an adversarys attempt to persist in a stealthy manner.,['eql'],"registry where /* uncomment once stablelength(registry.data.strings) > 0 and */ registry.path : (""HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\*"",""HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Terminal Server\\Install\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Runonce\\*"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\Load"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\Run"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Windows\\IconServiceLib"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Shell"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Shell"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\AppSetup"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Taskman"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Userinit"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\VmApplet"", ""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*"", ""HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Shell"", ""HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logoff\\Script"", ""HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logon\\Script"", ""HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script"", ""HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Startup\\Script"", ""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\*"", ""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Shell"", ""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logoff\\Script"", ""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Logon\\Script"", ""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Shutdown\\Script"",""HKEY_USERS\\*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\Scripts\\Startup\\Script"", ""HKLM\\SOFTWARE\\Microsoft\\ActiveSetup\\Installed Components\\*\\ShellComponent"",""HKLM\\SOFTWARE\\Microsoft\\Windows CEServices\\AutoStartOnConnect\\MicrosoftActiveSync"",""HKLM\\SOFTWARE\\Microsoft\\Windows CEServices\\AutoStartOnDisconnect\\MicrosoftActiveSync"",""HKLM\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath"",""HKLM\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Exec"",""HKLM\\SOFTWARE\\Microsoft\\Internet Explorer\\Extensions\\*\\Script"",""HKLM\\SOFTWARE\\Microsoft\\Command Processor\\Autorun"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Ctf\\LangBarAddin\\*\\FilePath"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\InternetExplorer\\Extensions\\*\\Exec"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\InternetExplorer\\Extensions\\*\\Script"",""HKEY_USERS\\*\\SOFTWARE\\Microsoft\\Command Processor\\Autorun"",""HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image FileExecution Options\\*\\VerifierDlls"",""HKLM\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\GpExtensions\\*\\DllName"",""HKLM\\SYSTEM\\ControlSet*\\Control\\SafeBoot\\AlternateShell"",""HKLM\\SYSTEM\\ControlSet*\\Control\\TerminalServer\\Wds\\rdpwd\\StartupPrograms"",""HKLM\\SYSTEM\\ControlSet*\\Control\\TerminalServer\\WinStations\\RDP-Tcp\\InitialProgram"",""HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\BootExecute"",""HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\SetupExecute"",""HKLM\\SYSTEM\\ControlSet*\\Control\\Session Manager\\Execute"",""HKLM\\SYSTEM\\ControlSet*\\Control\\SessionManager\\S0InitialCommand"",""HKLM\\SYSTEM\\ControlSet*\\Control\\ServiceControlManagerExtension"",""HKLM\\SYSTEM\\ControlSet*\\Control\\BootVerificationProgram\\ImagePath"", ""HKLM\\SYSTEM\\Setup\\CmdLine"",""HKEY_USERS\\*\\Environment\\UserInitMprLogonScript"") and notregistry.data.strings : (""C:\\Windows\\system32\\userinit.exe"",""cmd.exe"", ""C:\\Program Files (x86)\\*.exe"",""C:\\Program Files\\*.exe"") and not (process.name : ""rundll32.exe""and registry.path : ""*\\Software\\Microsoft\\InternetExplorer\\Extensions\\*\\Script"") and not process.executable :(""C:\\Windows\\System32\\msiexec.exe"",""C:\\Windows\\SysWOW64\\msiexec.exe"",""C:\\ProgramData\\Microsoft\\WindowsDefender\\Platform\\*\\MsMpEng.exe"",""C:\\Program Files\\*.exe"", ""C:\\ProgramFiles (x86)\\*.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.microsoftpressstore.com/articles/article.aspx?p=2762082&seqNum=2'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/unexpected-child-process-of-macos-screensaver-engine.html,Unexpected Child Process of macOS Screensaver Engineedit,['Persistence'],['TA0003'],['Event Triggered Execution'],['T1546'],"Identifies when a child process is spawned by the screensaver engine process, which is consistent with an attackers malicious payload being executed after the screensaver activated on the endpoint. An adversary can maintain persistence on a macOS endpoint by creating a malicious screensaver (.saver) file and configuring the screensaver plist file to execute code each time the screensaver is activated.",['eql'],"process where event.type == ""start"" and process.parent.name ==""ScreenSaverEngine""","['auditbeat-*', 'logs-endpoint.events.*']","['https://posts.specterops.io/saving-your-access-d562bf5bf90b', 'https://github.com/D00MFist/PersistentJXA']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/unusual-aws-command-for-a-user.html,Unusual AWS Command for a Useredit,[],[],[],[],"A machine learning job detected an AWS API command that, while not inherently suspicious or abnormal, is being made by a user context that does not normally use the command. This can be the result of compromised credentials or keys as someone uses a valid account to persist, move laterally, or exfiltrate data.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Cloud', 'AWS', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-child-process-from-a-system-virtual-process.html,Unusual Child Process from a System Virtual Processedit,['Defense Evasion'],['TA0005'],['Process Injection'],['T1055'],"Identifies a suspicious child process of the Windows virtual system process, which could indicate code injection.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.pid == 4 and not process.executable : (""Registry"",""MemCompression"", ""?:\\Windows\\System32\\smss.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-child-process-of-dns.exe.html,Unusual Child Process of dns.exeedit,['Initial Access'],['TA0001'],['External Remote Services'],['T1133'],"Identifies an unexpected process spawning from dns.exe, the process responsible for Windows DNS server services, which may indicate activity related to remote code execution or other forms of exploitation.",['eql'],"process where event.type == ""start"" and process.parent.name :""dns.exe"" and not process.name : ""conhost.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/', 'https://msrc-blog.microsoft.com/2020/07/14/july-2020-security-update-cve-2020-1350-vulnerability-in-windows-domain-name-system-dns-server/', 'https://github.com/maxpl0it/CVE-2020-1350-DoS']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/unusual-child-processes-of-rundll32.html,Unusual Child Processes of RunDLL32edit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies child processes of unusual instances of RunDLL32 where the command line parameters were suspicious. Misuse of RunDLL32 could indicate malicious activity.,['eql'],"sequence with maxspan=1h [process where event.type in (""start"",""process_started"") and (process.name : ""rundll32.exe"" orprocess.pe.original_file_name == ""RUNDLL32.EXE"") andprocess.args_count == 1 ] by process.entity_id [process whereevent.type in (""start"", ""process_started"") and process.parent.name :""rundll32.exe"" ] by process.parent.entity_id","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-city-for-an-aws-command.html,Unusual City For an AWS Commandedit,[],[],[],[],"A machine learning job detected AWS command activity that, while not inherently suspicious or abnormal, is sourcing from a geolocation (city) that is unusual for the command. This can be the result of compromised credentials or keys being used by a threat actor in a different geography than the authorized user(s).",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Cloud', 'AWS', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-country-for-an-aws-command.html,Unusual Country For an AWS Commandedit,[],[],[],[],"A machine learning job detected AWS command activity that, while not inherently suspicious or abnormal, is sourcing from a geolocation (country) that is unusual for the command. This can be the result of compromised credentials or keys being used by a threat actor in a different geography than the authorized user(s).",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Cloud', 'AWS', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-dns-activity.html,Unusual DNS Activityedit,[],[],[],[],"A machine learning job detected a rare and unusual DNS query that indicate network activity with unusual DNS domains. This can be due to initial access, persistence, command-and-control, or exfiltration activity. For example, when a user clicks on a link in a phishing email or opens a malicious document, a request may be sent to download and run a payload from an uncommon domain. When malware is already running, it may send requests to an uncommon DNS domain the malware uses for command-and-control communication.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-executable-file-creation-by-a-system-critical-process.html,Unusual Executable File Creation by a System Critical Processedit,['Defense Evasion'],['TA0005'],['Exploitation for Defense Evasion'],['T1211'],"Identifies an unexpected executable file being created or modified by a Windows system critical process, which may indicate activity related to remote code execution or other forms of exploitation.",['eql'],"file where event.type != ""deletion"" and file.extension : (""exe"",""dll"") and process.name : (""smss.exe"",""autochk.exe"", ""csrss.exe"",""wininit.exe"", ""services.exe"",""lsass.exe"", ""winlogon.exe"",""userinit.exe"", ""LogonUI.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-file-creation-alternate-data-stream.html,Unusual File Creation - Alternate Data Streamedit,['Defense Evasion'],['TA0005'],['Hide Artifacts'],['T1564'],Identifies suspicious creation of Alternate Data Streams on highly targeted files. This is uncommon for legitimate files and sometimes done by adversaries to hide malware.,['eql'],"file where event.type == ""creation"" and file.path : ""C:\\*:*"" andnot file.path : ""C:\\*:zone.identifier*"" and file.extension : (""pdf"", ""dll"", ""png"", ""exe"", ""dat"",""com"", ""bat"", ""cmd"", ""sys"", ""vbs"",""ps1"", ""hta"", ""txt"", ""vbe"", ""js"", ""wsh"",""docx"", ""doc"", ""xlsx"", ""xls"", ""pptx"",""ppt"", ""rtf"", ""gif"", ""jpg"", ""png"",""bmp"", ""img"", ""iso"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-file-modification-by-dns.exe.html,Unusual File Modification by dns.exeedit,['Initial Access'],['TA0001'],['External Remote Services'],['T1133'],"Identifies an unexpected file being modified by dns.exe, the process responsible for Windows DNS Server services, which may indicate activity related to remote code execution or other forms of exploitation.",['eql'],"file where process.name : ""dns.exe"" and event.type in (""creation"",""deletion"", ""change"") and not file.name : ""dns.log""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/', 'https://msrc-blog.microsoft.com/2020/07/14/july-2020-security-update-cve-2020-1350-vulnerability-in-windows-domain-name-system-dns-server/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/unusual-hour-for-a-user-to-logon.html,Unusual Hour for a User to Logonedit,[],[],[],[],"A machine learning job detected a user logging in at a time of day that is unusual for the user. This can be due to credentialed access via a compromised account when the user and the threat actor are in different time zones. In addition, unauthorized user activity often takes place during non-business hours.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Authentication', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-network-activity.html,Unusual Linux Network Activityedit,[],[],[],[],"Identifies Linux processes that do not usually use the network but have unexpected network activity, which can indicate command-and-control, lateral movement, persistence, or data exfiltration activity. A process with unusual network activity can denote process exploitation or injection, where the process is used to run persistence mechanisms that allow a malicious actor remote access or control of the host, data exfiltration, and execution of unauthorized network applications.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-network-connection-discovery.html,Unusual Linux Network Connection Discoveryedit,['Discovery'],['TA0007'],['System Network Connections Discovery'],['T1049'],Looks for commands related to system network connection discovery from an unusual user context. This can be due to uncommon troubleshooting activity or due to a compromised account. A compromised account may be used by a threat actor to engage in system network connection discovery in order to increase their understanding of connected services and systems. This information may be used to shape follow-up behaviors such as lateral movement or additional discovery.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-network-port-activity.html,Unusual Linux Network Port Activityedit,[],[],[],[],"Identifies unusual destination port activity that can indicate command-and-control, persistence mechanism, or data exfiltration activity. Rarely used destination port activity is generally unusual in Linux fleets, and can indicate unauthorized access or threat actor activity.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-network-service.html,Unusual Linux Network Serviceedit,[],[],[],[],"Identifies unusual listening ports on Linux instances that can indicate execution of unauthorized services, backdoors, or persistence mechanisms.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-process-calling-the-metadata-service.html,Unusual Linux Process Calling the Metadata Serviceedit,[],[],[],[],Looks for anomalous access to the metadata service by an unusual process. The metadata service may be targeted in order to harvest credentials or user data scripts containing secrets.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-process-discovery-activity.html,Unusual Linux Process Discovery Activityedit,['Discovery'],['TA0007'],['Process Discovery'],['T1057'],Looks for commands related to system process discovery from an unusual user context. This can be due to uncommon troubleshooting activity or due to a compromised account. A compromised account may be used by a threat actor to engage in system process discovery in order to increase their understanding of software applications running on a target host or network. This may be a precursor to selection of a persistence mechanism or a method of privilege elevation.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-system-information-discovery-activity.html,Unusual Linux System Information Discovery Activityedit,['Discovery'],['TA0007'],['System Information Discovery'],['T1082'],Looks for commands related to system information discovery from an unusual user context. This can be due to uncommon troubleshooting activity or due to a compromised account. A compromised account may be used to engage in system information discovery in order to gather detailed information about system configuration and software versions. This may be a precursor to selection of a persistence mechanism or a method of privilege elevation.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-system-network-configuration-discovery.html,Unusual Linux System Network Configuration Discoveryedit,['Discovery'],['TA0007'],['System Network Configuration Discovery'],['T1016'],Looks for commands related to system network configuration discovery from an unusual user context. This can be due to uncommon troubleshooting activity or due to a compromised account. A compromised account may be used by a threat actor to engage in system network configuration discovery in order to increase their understanding of connected networks and hosts. This information may be used to shape follow-up behaviors such as lateral movement or additional discovery.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-system-owner-or-user-discovery-activity.html,Unusual Linux System Owner or User Discovery Activityedit,['Discovery'],['TA0007'],['System Owner/User Discovery'],['T1033'],"Looks for commands related to system user or owner discovery from an unusual user context. This can be due to uncommon troubleshooting activity or due to a compromised account. A compromised account may be used to engage in system owner or user discovery in order to identify currently active or primary users of a system. This may be a precursor to additional discovery, credential dumping or privilege elevation activity.",['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-user-calling-the-metadata-service.html,Unusual Linux User Calling the Metadata Serviceedit,[],[],[],[],Looks for anomalous access to the cloud platform metadata service by an unusual user. The metadata service may be targeted in order to harvest credentials or user data scripts containing secrets.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-username.html,Unusual Linux Usernameedit,[],[],[],[],"A machine learning job detected activity for a username that is not normally active, which can indicate unauthorized changes, activity by unauthorized users, lateral movement, or compromised credentials. In many organizations, new usernames are not often created apart from specific types of system activities, such as creating new accounts for new employees. These user accounts quickly become active and routine. Events from rarely used usernames can point to suspicious activity. Additionally, automated Linux fleets tend to see activity from rarely used usernames only when personnel log in to make authorized or unauthorized changes, or threat actors have acquired credentials and log in for malicious purposes. Unusual usernames can also indicate pivoting, where compromised credentials are used to try and move laterally from one host to another.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-linux-web-activity.html,Unusual Linux Web Activityedit,[],[],[],[],"A machine learning job detected an unusual web URL request from a Linux host, which can indicate malware delivery and execution. Wget and cURL are commonly used by Linux programs to download code and data. Most of the time, their usage is entirely normal. Generally, because they use a list of URLs, they repeatedly download from the same locations. However, Wget and cURL are sometimes used to deliver Linux exploit payloads, and threat actors use these tools to download additional software and code. For these reasons, unusual URLs can indicate unauthorized downloads or threat activity.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-login-activity.html,Unusual Login Activityedit,[],[],[],[],Identifies an unusually high number of authentication attempts.,['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-network-activity-from-a-windows-system-binary.html,Unusual Network Activity from a Windows System Binaryedit,['Defense Evasion'],['TA0005'],['Trusted Developer Utilities Proxy Execution'],['T1127'],Identifies network activity from unexpected system applications. This may indicate adversarial activity as these applications are often leveraged by adversaries to execute code and evade detection.,['eql'],"sequence by process.entity_id with maxspan=5m [process whereevent.type in (""start"", ""process_started"") and /* knownapplocker bypasses */ (process.name : ""bginfo.exe"" orprocess.name : ""cdb.exe"" or process.name : ""control.exe"" orprocess.name : ""cmstp.exe"" or process.name : ""csi.exe"" orprocess.name : ""dnx.exe"" or process.name : ""fsi.exe"" orprocess.name : ""ieexec.exe"" or process.name : ""iexpress.exe"" orprocess.name : ""installutil.exe"" or process.name :""Microsoft.Workflow.Compiler.exe"" or process.name :""MSBuild.exe"" or process.name : ""msdt.exe"" or process.name: ""mshta.exe"" or process.name : ""msiexec.exe"" orprocess.name : ""msxsl.exe"" or process.name : ""odbcconf.exe"" orprocess.name : ""rcsi.exe"" or process.name : ""regsvr32.exe"" orprocess.name : ""xwizard.exe"")] [network where (process.name :""bginfo.exe"" or process.name : ""cdb.exe"" or process.name :""control.exe"" or process.name : ""cmstp.exe"" orprocess.name : ""csi.exe"" or process.name : ""dnx.exe"" orprocess.name : ""fsi.exe"" or process.name : ""ieexec.exe"" orprocess.name : ""iexpress.exe"" or process.name :""installutil.exe"" or process.name :""Microsoft.Workflow.Compiler.exe"" or process.name :""MSBuild.exe"" or process.name : ""msdt.exe"" or process.name: ""mshta.exe"" or process.name : ""msiexec.exe"" orprocess.name : ""msxsl.exe"" or process.name : ""odbcconf.exe"" orprocess.name : ""rcsi.exe"" or process.name : ""regsvr32.exe"" orprocess.name : ""xwizard.exe"")]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-network-connection-via-dllhost.html,Unusual Network Connection via DllHostedit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies unusual instances of dllhost.exe making outbound network connections. This may indicate adversarial Command and Control activity.,['eql'],"sequence by host.id, process.entity_id with maxspan=1m [processwhere event.type in (""start"", ""process_started"") and process.name :""dllhost.exe"" and process.args_count == 1] [network whereprocess.name : ""dllhost.exe"" and not cidrmatch(destination.ip,""10.0.0.0/8"", ""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"",""192.0.0.0/24"", ""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"",""192.0.0.10/32"", ""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"",""192.31.196.0/24"", ""192.52.193.0/24"", ""192.168.0.0/16"",""192.88.99.0/24"", ""224.0.0.0/4"", ""100.64.0.0/10"",""192.175.48.0/24"", ""198.18.0.0/15"", ""198.51.100.0/24"",""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"", ""FE80::/10"", ""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/', 'https://www.volexity.com/blog/2021/05/27/suspected-apt29-operation-launches-election-fraud-themed-phishing-campaigns/', 'https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-network-connection-via-rundll32.html,Unusual Network Connection via RunDLL32edit,['Defense Evasion'],['TA0005'],['Signed Binary Proxy Execution'],['T1218'],Identifies unusual instances of rundll32.exe making outbound network connections. This may indicate adversarial Command and Control activity.,['eql'],"sequence by host.id, process.entity_id with maxspan=1m [processwhere event.type in (""start"", ""process_started"") and process.name :""rundll32.exe"" and process.args_count == 1] [network whereprocess.name : ""rundll32.exe"" and not cidrmatch(destination.ip,""10.0.0.0/8"", ""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"",""192.0.0.0/24"", ""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"",""192.0.0.10/32"", ""192.0.0.170/32"", ""192.0.0.171/32"",""192.0.2.0/24"", ""192.31.196.0/24"", ""192.52.193.0/24"",""192.168.0.0/16"", ""192.88.99.0/24"", ""224.0.0.0/4"",""100.64.0.0/10"", ""192.175.48.0/24"",""198.18.0.0/15"", ""198.51.100.0/24"",""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"", ""FE80::/10"",""FF00::/8"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-network-destination-domain-name.html,Unusual Network Destination Domain Nameedit,[],[],[],[],"A machine learning job detected an unusual network destination domain name. This can be due to initial access, persistence, command-and-control, or exfiltration activity. For example, when a user clicks on a link in a phishing email or opens a malicious document, a request may be sent to download and run a payload from an uncommon web server name. When malware is already running, it may send requests to an uncommon DNS domain the malware uses for command-and-control communication.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-parent-process-for-cmd.exe.html,Unusual Parent Process for cmd.exeedit,['Execution'],['TA0002'],['Command and Scripting Interpreter'],['T1059'],Identifies a suspicious parent child process relationship with cmd.exe descending from an unusual process.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""cmd.exe"" and process.parent.name : (""lsass.exe"",""csrss.exe"", ""epad.exe"",""regsvr32.exe"", ""dllhost.exe"",""LogonUI.exe"", ""wermgr.exe"",""spoolsv.exe"", ""jucheck.exe"",""jusched.exe"", ""ctfmon.exe"",""taskhostw.exe"", ""GoogleUpdate.exe"",""sppsvc.exe"", ""sihost.exe"",""slui.exe"", ""SIHClient.exe"",""SearchIndexer.exe"",""SearchProtocolHost.exe"",""FlashPlayerUpdateService.exe"",""WerFault.exe"", ""WUDFHost.exe"",""unsecapp.exe"", ""wlanext.exe"" )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Execution']"
https://www.elastic.co/guide/en/security/7.16/unusual-parent-child-relationship.html,Unusual Parent-Child Relationshipedit,['Privilege Escalation'],['TA0004'],['Process Injection'],['T1055'],Identifies Windows programs run from unexpected parent processes. This could indicate masquerading or other strange activity on a system.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name != null and ( /* suspicious parent processes*/ (process.name:""autochk.exe"" and notprocess.parent.name:""smss.exe"") or(process.name:(""fontdrvhost.exe"", ""dwm.exe"") and notprocess.parent.name:(""wininit.exe"", ""winlogon.exe"")) or(process.name:(""consent.exe"", ""RuntimeBroker.exe"", ""TiWorker.exe"") andnot process.parent.name:""svchost.exe"") or(process.name:""SearchIndexer.exe"" and notprocess.parent.name:""services.exe"") or(process.name:""SearchProtocolHost.exe"" and notprocess.parent.name:(""SearchIndexer.exe"", ""dllhost.exe"")) or(process.name:""dllhost.exe"" and notprocess.parent.name:(""services.exe"", ""svchost.exe"")) or(process.name:""smss.exe"" and not process.parent.name:(""System"",""smss.exe"")) or (process.name:""csrss.exe"" and notprocess.parent.name:(""smss.exe"", ""svchost.exe"")) or(process.name:""wininit.exe"" and not process.parent.name:""smss.exe"") or(process.name:""winlogon.exe"" and not process.parent.name:""smss.exe"")or (process.name:(""lsass.exe"", ""LsaIso.exe"") and notprocess.parent.name:""wininit.exe"") or (process.name:""LogonUI.exe""and not process.parent.name:(""wininit.exe"", ""winlogon.exe"")) or(process.name:""services.exe"" and notprocess.parent.name:""wininit.exe"") or (process.name:""svchost.exe""and not process.parent.name:(""MsMpEng.exe"", ""services.exe"")) or(process.name:""spoolsv.exe"" and notprocess.parent.name:""services.exe"") or (process.name:""taskhost.exe""and not process.parent.name:(""services.exe"", ""svchost.exe"")) or(process.name:""taskhostw.exe"" and notprocess.parent.name:(""services.exe"", ""svchost.exe"")) or(process.name:""userinit.exe"" and not process.parent.name:(""dwm.exe"",""winlogon.exe"")) or (process.name:(""wmiprvse.exe"",""wsmprovhost.exe"", ""winrshost.exe"") and notprocess.parent.name:""svchost.exe"") or /* suspicious child processes*/ (process.parent.name:(""SearchProtocolHost.exe"", ""taskhost.exe"",""csrss.exe"") and not process.name:(""werfault.exe"", ""wermgr.exe"",""WerFaultSecure.exe"")) or (process.parent.name:""autochk.exe"" andnot process.name:(""chkdsk.exe"", ""doskey.exe"", ""WerFault.exe"")) or(process.parent.name:""smss.exe"" and not process.name:(""autochk.exe"",""smss.exe"", ""csrss.exe"", ""wininit.exe"", ""winlogon.exe"", ""setupcl.exe"",""WerFault.exe"")) or (process.parent.name:""wermgr.exe"" and notprocess.name:(""WerFaultSecure.exe"", ""wermgr.exe"", ""WerFault.exe"")) or(process.parent.name:""conhost.exe"" and notprocess.name:(""mscorsvw.exe"", ""wermgr.exe"", ""WerFault.exe"",""WerFaultSecure.exe"")) )","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://github.com/sbousseaden/Slides/blob/master/Hunting%20MindMaps/PNG/Windows%20Processes%20TH.map.png', 'https://www.andreafortuna.org/2017/06/15/standard-windows-processes-a-brief-reference/']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/unusual-persistence-via-services-registry.html,Unusual Persistence via Services Registryedit,['Persistence'],['TA0003'],['Create or Modify System Process'],['T1543'],"Identifies processes modifying the services registry key directly, instead of through the expected Windows APIs. This could be an indication of an adversary attempting to stealthily persist through abnormal service creation or modification of an existing service.",['eql'],"registry where registry.path :(""HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ServiceDLL"",""HKLM\\SYSTEM\\ControlSet*\\Services\\*\\ImagePath"") and notregistry.data.strings : (""?:\\windows\\system32\\Drivers\\*.sys"",""\\SystemRoot\\System32\\drivers\\*.sys"",""\\??\\?:\\Windows\\system32\\Drivers\\*.SYS"",""system32\\DRIVERS\\USBSTOR"") and not (process.name :""procexp??.exe"" and registry.data.strings : ""?:\\*\\procexp*.sys"") andnot process.executable : (""?:\\Program Files\\*.exe"",""?:\\Program Files (x86)\\*.exe"",""?:\\Windows\\System32\\svchost.exe"",""?:\\Windows\\winsxs\\*\\TiWorker.exe"",""?:\\Windows\\System32\\drvinst.exe"",""?:\\Windows\\System32\\services.exe"",""?:\\Windows\\System32\\msiexec.exe"",""?:\\Windows\\System32\\regsvr32.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/unusual-print-spooler-child-process.html,Unusual Print Spooler Child Processedit,['Privilege Escalation'],['TA0004'],['Exploitation for Privilege Escalation'],['T1068'],Detects unusual Print Spooler service (spoolsv.exe) child processes. This may indicate an attempt to exploit privilege escalation vulnerabilities related to the Printing Service on Windows.,['eql'],"process where event.type == ""start"" and process.parent.name :""spoolsv.exe"" and user.id : ""S-1-5-18"" and /* exclusions for FPcontrol below */ not process.name : (""splwow64.exe"",""PDFCreator.exe"", ""acrodist.exe"", ""spoolsv.exe"", ""msiexec.exe"",""route.exe"", ""WerFault.exe"") and not process.command_line :""*\\WINDOWS\\system32\\spool\\DRIVERS*"" and not (process.name :""net.exe"" and process.command_line : (""*stop*"", ""*start*"")) and not(process.name : (""cmd.exe"", ""powershell.exe"") and process.command_line: (""*.spl*"", ""*\\program files*"", ""*route add*"")) and not(process.name : ""netsh.exe"" and process.command_line : (""*addportopening*"", ""*rule name*"")) and not (process.name : ""regsvr32.exe""and process.command_line : ""*PrintConfig.dll*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527', 'https://github.com/afwu/PrintNightmare']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/unusual-process-execution-temp.html,Unusual Process Execution - Tempedit,[],[],[],[],Identifies processes running in a temporary folder. This is sometimes done by adversaries to hide malware.,['query'],event.category:process and event.type:(start or process_started) andprocess.working_directory:/tmp,"['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection']"
https://www.elastic.co/guide/en/security/7.16/unusual-process-execution-path-alternate-data-stream.html,Unusual Process Execution Path - Alternate Data Streamedit,['Defense Evasion'],['TA0005'],['Hide Artifacts'],['T1564'],Identifies processes running from an Alternate Data Stream. This is uncommon for legitimate processes and sometimes done by adversaries to hide malware.,['eql'],"process where event.type == ""start"" and process.args : ""?:\\*:*"" andprocess.args_count == 1","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-process-for-a-linux-host.html,Unusual Process For a Linux Hostedit,[],[],[],[],"Identifies rare processes that do not usually run on individual hosts, which can indicate execution of unauthorized services, malware, or persistence mechanisms. Processes are considered rare when they only run occasionally as compared with other processes running on the host.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-process-for-a-windows-host.html,Unusual Process For a Windows Hostedit,[],[],[],[],"Identifies rare processes that do not usually run on individual hosts, which can indicate execution of unauthorized services, malware, or persistence mechanisms. Processes are considered rare when they only run occasionally as compared with other processes running on the host.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-process-network-connection.html,Unusual Process Network Connectionedit,['Defense Evasion'],['TA0005'],['Trusted Developer Utilities Proxy Execution'],['T1127'],Identifies network activity from unexpected system applications. This may indicate adversarial activity as these applications are often leveraged by adversaries to execute code and evade detection.,['eql'],"sequence by process.entity_id [process where (process.name :""Microsoft.Workflow.Compiler.exe"" or process.name :""bginfo.exe"" or process.name : ""cdb.exe"" orprocess.name : ""cmstp.exe"" or process.name :""csi.exe"" or process.name : ""dnx.exe"" orprocess.name : ""fsi.exe"" or process.name :""ieexec.exe"" or process.name : ""iexpress.exe"" orprocess.name : ""odbcconf.exe"" or process.name :""rcsi.exe"" or process.name : ""xwizard.exe"") andevent.type == ""start""] [network where (process.name :""Microsoft.Workflow.Compiler.exe"" or process.name :""bginfo.exe"" or process.name : ""cdb.exe"" orprocess.name : ""cmstp.exe"" or process.name :""csi.exe"" or process.name : ""dnx.exe"" orprocess.name : ""fsi.exe"" or process.name :""ieexec.exe"" or process.name : ""iexpress.exe"" orprocess.name : ""odbcconf.exe"" or process.name :""rcsi.exe"" or process.name : ""xwizard.exe"")]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/unusual-service-host-child-process-childless-service.html,Unusual Service Host Child Process - Childless Serviceedit,"['Privilege Escalation', 'Defense Evasion']","['TA0004', 'TA0005']","['Process Injection', 'Process Injection']","['T1055', 'T1055']",Identifies unusual child processes of Service Host (svchost.exe) that traditionally do not spawn any child processes. This may indicate a code injection or an equivalent form of exploitation.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""svchost.exe"" and /* based on svchostservice arguments -s svcname where the service is known to bechildless */ process.parent.args :(""WdiSystemHost"",""LicenseManager"",""StorSvc"",""CDPSvc"",""cdbhsvc"",""BthAvctpSvc"",""SstpSvc"",""WdiServiceHost"",""imgsvc"",""TrkWks"",""WpnService"",""IKEEXT"",""PolicyAgent"",""CryptSvc"",""netprofm"",""ProfSvc"",""StateRepository"",""camsvc"",""LanmanWorkstation"",""NlaSvc"",""EventLog"",""hidserv"",""DisplayEnhancementService"",""ShellHWDetection"", ""AppHostSvc"",""fhsvc"",""CscService"",""PushToInstall"") and/* unknown FPs can be added here */ not process.name :(""WerFault.exe"",""WerFaultSecure.exe"",""wermgr.exe"")","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion', 'Privilege Escalation']"
https://www.elastic.co/guide/en/security/7.16/unusual-source-ip-for-a-user-to-logon-from.html,Unusual Source IP for a User to Logon fromedit,[],[],[],[],A machine learning job detected a user logging in from an IP address that is unusual for the user. This can be due to credentialed access via a compromised account when the user and the threat actor are in different locations. An unusual source IP address for a username could also be due to lateral movement when a compromised account is used to pivot between hosts.,['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Authentication', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-sudo-activity.html,Unusual Sudo Activityedit,"['Defense Evasion', 'Privilege Escalation']","['TA0005', 'TA0004']","['Abuse Elevation Control Mechanism', 'Abuse Elevation Control Mechanism']","['T1548', 'T1548']",Looks for sudo activity from an unusual user context. An unusual sudo user could be due to troubleshooting activity or it could be a sign of credentialed access via compromised accounts.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-web-request.html,Unusual Web Requestedit,[],[],[],[],"A machine learning job detected a rare and unusual URL that indicates unusual web browsing activity. This can be due to initial access, persistence, command-and-control, or exfiltration activity. For example, in a strategic web compromise or watering hole attack, when a trusted website is compromised to target a particular sector or organization, targeted users may receive emails with uncommon URLs for trusted websites. These URLs can be used to download and run a payload. When malware is already running, it may send requests to uncommon URLs on trusted websites the malware uses for command-and-control communication. When rare URLs are observed being requested for a local web server by a remote source, these can be due to web scanning, enumeration or attack traffic, or they can be due to bots and web scrapers which are part of common Internet background traffic.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-web-user-agent.html,Unusual Web User Agentedit,[],[],[],[],"A machine learning job detected a rare and unusual user agent indicating web browsing activity by an unusual process other than a web browser. This can be due to persistence, command-and-control, or exfiltration activity. Uncommon user agents coming from remote sources to local destinations are often the result of scanners, bots, and web scrapers, which are part of common Internet background traffic. Much of this is noise, but more targeted attacks on websites using tools like Burp or SQLmap can sometimes be discovered by spotting uncommon user agents. Uncommon user agents in traffic from local sources to remote destinations can be any number of things, including harmless programs like weather monitoring or stock-trading programs. However, uncommon user agents from local sources can also be due to malware or scanning activity.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Network', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-network-activity.html,Unusual Windows Network Activityedit,[],[],[],[],"Identifies Windows processes that do not usually use the network but have unexpected network activity, which can indicate command-and-control, lateral movement, persistence, or data exfiltration activity. A process with unusual network activity can denote process exploitation or injection, where the process is used to run persistence mechanisms that allow a malicious actor remote access or control of the host, data exfiltration, and execution of unauthorized network applications.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-path-activity.html,Unusual Windows Path Activityedit,[],[],[],[],"Identifies processes started from atypical folders in the file system, which might indicate malware execution or persistence mechanisms. In corporate Windows environments, software installation is centrally managed and it is unusual for programs to be executed from user or temporary directories. Processes executed from these locations can denote that a user downloaded software directly from the Internet or a malicious script or macro executed malware.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-process-calling-the-metadata-service.html,Unusual Windows Process Calling the Metadata Serviceedit,[],[],[],[],Looks for anomalous access to the metadata service by an unusual process. The metadata service may be targeted in order to harvest credentials or user data scripts containing secrets.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-remote-user.html,Unusual Windows Remote Useredit,[],[],[],[],"A machine learning job detected an unusual remote desktop protocol (RDP) username, which can indicate account takeover or credentialed persistence using compromised accounts. RDP attacks, such as BlueKeep, also tend to use unusual usernames.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-service.html,Unusual Windows Serviceedit,[],[],[],[],"A machine learning job detected an unusual Windows service, This can indicate execution of unauthorized services, malware, or persistence mechanisms. In corporate Windows environments, hosts do not generally run many rare or unique services. This job helps detect malware and persistence mechanisms that have been installed and run as a service.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-user-calling-the-metadata-service.html,Unusual Windows User Calling the Metadata Serviceedit,[],[],[],[],Looks for anomalous access to the cloud platform metadata service by an unusual user. The metadata service may be targeted in order to harvest credentials or user data scripts containing secrets.,['machine_learning'],N/A,N/A,N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-user-privilege-elevation-activity.html,Unusual Windows User Privilege Elevation Activityedit,[],[],[],[],"A machine learning job detected an unusual user context switch, using the runas command or similar techniques, which can indicate account takeover or privilege escalation using compromised accounts. Privilege elevation using tools like runas are more commonly used by domain and network administrators than by regular Windows users.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/unusual-windows-username.html,Unusual Windows Usernameedit,[],[],[],[],"A machine learning job detected activity for a username that is not normally active, which can indicate unauthorized changes, activity by unauthorized users, lateral movement, or compromised credentials. In many organizations, new usernames are not often created apart from specific types of system activities, such as creating new accounts for new employees. These user accounts quickly become active and routine. Events from rarely used usernames can point to suspicious activity. Additionally, automated Linux fleets tend to see activity from rarely used usernames only when personnel log in to make authorized or unauthorized changes, or threat actors have acquired credentials and log in for malicious purposes. Unusual usernames can also indicate pivoting, where compromised credentials are used to try and move laterally from one host to another.",['machine_learning'],N/A,N/A,['/guide/en/security/current/prebuilt-ml-jobs.html'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'ML']"
https://www.elastic.co/guide/en/security/7.16/user-account-creation.html,User Account Creationedit,['Persistence'],['TA0003'],['Create Account'],['T1136'],Identifies attempts to create new local users. This is sometimes done by attackers to increase access to a system or domain.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : (""net.exe"", ""net1.exe"") and not process.parent.name :""net.exe"" and (process.args : ""user"" and process.args : (""/ad"",""/add""))","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/user-added-as-owner-for-azure-application.html,User Added as Owner for Azure Applicationedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],Identifies when a user is added as an owner for an Azure application. An adversary may add a user account as an owner for an Azure application in order to grant additional permissions and modify the applications configuration using another account.,['query'],"event.dataset:azure.auditlogs and azure.auditlogs.operation_name:""Addowner to application"" and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",N/A,"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/user-added-as-owner-for-azure-service-principal.html,User Added as Owner for Azure Service Principaledit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies when a user is added as an owner for an Azure service principal. The service principal object defines what the application can do in the specific tenant, who can access the application, and what resources the app can access. A service principal object is created when an application is given permission to access resources in a tenant. An adversary may add a user account as an owner for a service principal and use that account in order to define what an application can do in the Azure AD tenant.",['query'],"event.dataset:azure.auditlogs and azure.auditlogs.operation_name:""Addowner to service principal"" and event.outcome:(Success or success)","['filebeat-*', 'logs-azure*']",['https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals'],"['Elastic', 'Cloud', 'Azure', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/user-added-to-privileged-group-in-active-directory.html,User Added to Privileged Group in Active Directoryedit,['Persistence'],['TA0003'],['Account Manipulation'],['T1098'],"Identifies a user being added to a privileged group in Active Directory. Privileged accounts and groups in Active Directory are those to which powerful rights, privileges, and permissions are granted that allow them to perform nearly any action in Active Directory and on domain-joined systems.",['eql'],"iam where event.action == ""added-member-to-group"" and group.name :(""Admin*"", ""Local Administrators"",""Domain Admins"", ""Enterprise Admins"",""Backup Admins"", ""Schema Admins"",""DnsAdmins"", ""Exchange Organization Administrators"")","['winlogbeat-*', 'logs-windows.*']",['https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-b\u200bprivileged-accounts-and-groups-in-active-directory'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/vnc-virtual-network-computing-from-the-internet.html,VNC (Virtual Network Computing) from the Internetedit,"['Command and Control', 'Initial Access']","['TA0011', 'TA0001']","['Remote Access Software', 'Exploit Public-Facing Application']","['T1219', 'T1190']","This rule detects network events that may indicate the use of VNC traffic from the Internet. VNC is commonly used by system administrators to remotely control a system for maintenance or to use shared resources. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector.",['query'],"event.category:(network or network_traffic) and network.transport:tcpand destination.port >= 5800 and destination.port <= 5810 and notsource.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or172.16.0.0/12 or 192.0.0.0/24 or 192.0.0.0/29 or192.0.0.8/32 or 192.0.0.9/32 or 192.0.0.10/32 or192.0.0.170/32 or 192.0.0.171/32 or 192.0.2.0/24 or192.31.196.0/24 or 192.52.193.0/24 or 192.168.0.0/16 or192.88.99.0/24 or 224.0.0.0/4 or 100.64.0.0/10 or192.175.48.0/24 or 198.18.0.0/15 or 198.51.100.0/24 or203.0.113.0/24 or 240.0.0.0/4 or ""::1"" or ""FE80::/10"" or""FF00::/8"" ) and destination.ip:( 10.0.0.0/8 or172.16.0.0/12 or 192.168.0.0/16 )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/vnc-virtual-network-computing-to-the-internet.html,VNC (Virtual Network Computing) to the Internetedit,['Command and Control'],['TA0011'],['Remote Access Software'],['T1219'],"This rule detects network events that may indicate the use of VNC traffic to the Internet. VNC is commonly used by system administrators to remotely control a system for maintenance or to use shared resources. It should almost never be directly exposed to the Internet, as it is frequently targeted and exploited by threat actors as an initial access or backdoor vector.",['query'],"event.category:(network or network_traffic) and network.transport:tcpand destination.port >= 5800 and destination.port <= 5810 andsource.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or192.0.0.0/29 or 192.0.0.8/32 or 192.0.0.9/32 or192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or192.0.2.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or192.168.0.0/16 or 192.88.99.0/24 or 224.0.0.0/4 or100.64.0.0/10 or 192.175.48.0/24 or 198.18.0.0/15 or198.51.100.0/24 or 203.0.113.0/24 or 240.0.0.0/4 or ""::1""or ""FE80::/10"" or ""FF00::/8"" )","['auditbeat-*', 'filebeat-*', 'packetbeat-*', 'logs-endpoint.events.*']",['https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml'],"['Elastic', 'Host', 'Network', 'Threat Detection', 'Command and Control', 'Host']"
https://www.elastic.co/guide/en/security/7.16/virtual-machine-fingerprinting.html,Virtual Machine Fingerprintingedit,['Discovery'],['TA0007'],['System Information Discovery'],['T1082'],An adversary may attempt to get detailed information about the operating system and hardware. This rule identifies common locations used to discover virtual machine hardware by a non-root user. This technique has been used by the Pupy RAT and other malware.,['query'],"event.category:process and event.type:(start or process_started) andprocess.args:(""/sys/class/dmi/id/bios_version"" or""/sys/class/dmi/id/product_name"" or""/sys/class/dmi/id/chassis_vendor"" or""/proc/scsi/scsi"" or ""/proc/ide/hd0/model"") and notuser.name:root","['auditbeat-*', 'logs-endpoint.events.*']",N/A,"['Elastic', 'Host', 'Linux', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/virtual-machine-fingerprinting-via-grep.html,Virtual Machine Fingerprinting via Grepedit,['Discovery'],['TA0007'],['System Information Discovery'],['T1082'],An adversary may attempt to get detailed information about the operating system and hardware. This rule identifies common locations used to discover virtual machine hardware by a non-root user. This technique has been used by the Pupy RAT and other malware.,['eql'],"process where event.type == ""start"" and process.name in (""grep"",""egrep"") and user.id != ""0"" and process.args : (""parallels*"",""vmware*"", ""virtualbox*"") and process.args : ""Manufacturer*"" and notprocess.parent.executable in(""/Applications/Docker.app/Contents/MacOS/Docker"",""/usr/libexec/kcare/virt-what"")","['auditbeat-*', 'logs-endpoint.events.*']",['https://objective-see.com/blog/blog_0x4F.html'],"['Elastic', 'Host', 'macOS', 'Linux', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/virtual-private-network-connection-attempt.html,Virtual Private Network Connection Attemptedit,['Lateral Movement'],['TA0008'],['Remote Services'],['T1021'],Identifies the execution of macOS built-in commands to connect to an existing Virtual Private Network (VPN).,['eql'],"process where event.type in (""start"", ""process_started"") and ((process.name : ""networksetup"" and process.args :""-connectpppoeservice"") or (process.name : ""scutil"" andprocess.args : ""--nc"" and process.args : ""start"") or (process.name: ""osascript"" and process.command_line : ""osascript*set VPN toservice*"") )","['auditbeat-*', 'logs-endpoint.events.*']","['https://github.com/rapid7/metasploit-framework/blob/master/modules/post/osx/manage/vpn.rb', 'https://www.unix.com/man-page/osx/8/networksetup/', 'https://superuser.com/questions/358513/start-configured-vpn-from-command-line-osx']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/volume-shadow-copy-deleted-or-resized-via-vssadmin.html,Volume Shadow Copy Deleted or Resized via VssAdminedit,['Impact'],['TA0040'],['Inhibit System Recovery'],['T1490'],Identifies use of vssadmin.exe for shadow copy deletion or resizing on endpoints. This commonly occurs in tandem with ransomware or other destructive attacks.,['eql'],"process where event.type in (""start"", ""process_started"") andevent.action == ""start"" and (process.name : ""vssadmin.exe"" orprocess.pe.original_file_name == ""VSSADMIN.EXE"") and process.args in(""delete"", ""resize"") and process.args : ""shadows*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/volume-shadow-copy-deletion-via-powershell.html,Volume Shadow Copy Deletion via PowerShelledit,['Impact'],['TA0040'],['Inhibit System Recovery'],['T1490'],Identifies the use of the Win32_ShadowCopy class and related cmdlets to achieve shadow copy deletion. This commonly occurs in tandem with ransomware or other destructive attacks.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : (""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"")and process.args : (""*Get-WmiObject*"", ""*gwmi*"", ""*Get-CimInstance*"", ""*gcim*"") and process.args : (""*Win32_ShadowCopy*"")and process.args : (""*.Delete()*"", ""*Remove-WmiObject*"", ""*rwmi*"",""*Remove-CimInstance*"", ""*rcim*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']","['https://docs.microsoft.com/en-us/previous-versions/windows/desktop/vsswmi/win32-shadowcopy', 'https://powershell.one/wmi/root/cimv2/win32_shadowcopy', 'https://www.fortinet.com/blog/threat-research/stomping-shadow-copies-a-second-look-into-deletion-methods']","['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/volume-shadow-copy-deletion-via-wmic.html,Volume Shadow Copy Deletion via WMICedit,['Impact'],['TA0040'],['Inhibit System Recovery'],['T1490'],Identifies use of wmic.exe for shadow copy deletion on endpoints. This commonly occurs in tandem with ransomware or other destructive attacks.,['eql'],"process where event.type in (""start"", ""process_started"") and(process.name : ""WMIC.exe"" or process.pe.original_file_name ==""wmic.exe"") and process.args : ""delete"" and process.args :""shadowcopy""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Impact']"
https://www.elastic.co/guide/en/security/7.16/wmi-incoming-lateral-movement.html,WMI Incoming Lateral Movementedit,"['Lateral Movement', 'Execution']","['TA0008', 'TA0002']",['Windows Management Instrumentation'],['T1047'],"Identifies processes executed via Windows Management Instrumentation (WMI) on a remote host. This could be indicative of adversary lateral movement, but could be noisy if administrators use WMI to remotely manage hosts.",['eql'],"sequence by host.id with maxspan = 2s /* Accepted Incoming RPCconnection by Winmgmt service */ [network where process.name :""svchost.exe"" and network.direction : (""incoming"", ""ingress"") andsource.address != ""127.0.0.1"" and source.address != ""::1"" andsource.port >= 49152 and destination.port >= 49152 ] /* ExcludingCommon FPs Nessus and SCCM */ [process where event.type in(""start"", ""process_started"") and process.parent.name : ""WmiPrvSE.exe""and not process.args : (""C:\\windows\\temp\\nessus_*.txt"",""C:\\windows\\TEMP\\nessus_*.TMP"",""C:\\Windows\\CCM\\SystemTemp\\*"",""C:\\Windows\\CCMCache\\*"",""C:\\CCM\\Cache\\*"") ]","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Lateral Movement']"
https://www.elastic.co/guide/en/security/7.16/web-application-suspicious-activity-no-user-agent.html,Web Application Suspicious Activity: No User Agentedit,[],[],[],[],A request to a web application server contained no identifying user agent string.,['query'],url.path:*,"['apm--transaction', 'traces-apm*']",['https://en.wikipedia.org/wiki/User_agent'],"['Elastic', 'APM']"
https://www.elastic.co/guide/en/security/7.16/web-application-suspicious-activity-post-request-declined.html,Web Application Suspicious Activity: POST Request Declinededit,[],[],[],[],"A POST request to a web application returned a 403 response, which indicates the web application declined to process the request because the action requested was not allowed.",['query'],http.response.status_code:403 and http.request.method:post,"['apm--transaction', 'traces-apm*']",['https://en.wikipedia.org/wiki/HTTP_403'],"['Elastic', 'APM']"
https://www.elastic.co/guide/en/security/7.16/web-application-suspicious-activity-unauthorized-method.html,Web Application Suspicious Activity: Unauthorized Methodedit,[],[],[],[],"A request to a web application returned a 405 response, which indicates the web application declined to process the request because the HTTP method is not allowed for the resource.",['query'],http.response.status_code:405,"['apm--transaction', 'traces-apm*']",['https://en.wikipedia.org/wiki/HTTP_405'],"['Elastic', 'APM']"
https://www.elastic.co/guide/en/security/7.16/web-application-suspicious-activity-sqlmap-user-agent.html,Web Application Suspicious Activity: sqlmap User Agentedit,[],[],[],[],"This is an example of how to detect an unwanted web client user agent. This search matches the user agent for sqlmap 1.3.11, which is a popular FOSS tool for testing web applications for SQL injection vulnerabilities.",['query'],"user_agent.original:""sqlmap/1.3.11#stable (http://sqlmap.org)""","['apm--transaction', 'traces-apm*']",['http://sqlmap.org/'],"['Elastic', 'APM']"
https://www.elastic.co/guide/en/security/7.16/webproxy-settings-modification.html,WebProxy Settings Modificationedit,['Credential Access'],['TA0006'],['Steal Web Session Cookie'],['T1539'],Identifies the use of the built-in networksetup command to configure webproxy settings. This may indicate an attempt to hijack web browser traffic for credential access via traffic sniffing or redirection.,['query'],"event.category : process and event.type : start and process.name :networksetup and process.args : ((""-setwebproxy"" or""-setsecurewebproxy"" or ""-setautoproxyurl"") and not (Bluetooth oroff)) and not process.parent.executable :(""/Library/PrivilegedHelperTools/com.80pct.FreedomHelper"" or""/Applications/FiddlerEverywhere.app/Contents/Resources/app/out/WebServer/Fiddler.WebUi"" or""/usr/libexec/xpcproxy"")","['auditbeat-*', 'logs-endpoint.events.*']","['https://unit42.paloaltonetworks.com/mac-malware-steals-cryptocurrency-exchanges-cookies/', 'https://objectivebythesea.com/v2/talks/OBTS_v2_Zohar.pdf']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Credential Access']"
https://www.elastic.co/guide/en/security/7.16/webserver-access-logs-deleted.html,WebServer Access Logs Deletededit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Identifies the deletion of WebServer access logs. This may indicate an attempt to evade detection or destroy forensic evidence on a system.,['eql'],"file where event.type == ""deletion"" and file.path :(""C:\\inetpub\\logs\\LogFiles\\*.log"",""/var/log/apache*/access.log"",""/etc/httpd/logs/access_log"",""/var/log/httpd/access_log"",""/var/www/*/logs/access.log"")","['auditbeat-*', 'winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Linux', 'Windows', 'macOS', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/webshell-detection-script-process-child-of-common-web-processes.html,Webshell Detection: Script Process Child of Common Web Processesedit,"['Persistence', 'Initial Access']","['TA0003', 'TA0001']","['Server Software Component', 'Exploit Public-Facing Application']","['T1505', 'T1190']","Identifies suspicious commands executed via a web server, which may suggest a vulnerability and remote shell access.",['eql'],"process where event.type == ""start"" and process.parent.name :(""w3wp.exe"", ""httpd.exe"", ""nginx.exe"", ""php.exe"", ""php-cgi.exe"",""tomcat.exe"") and process.name : (""cmd.exe"", ""cscript.exe"",""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"", ""wmic.exe"",""wscript.exe"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.microsoft.com/security/blog/2020/02/04/ghost-in-the-shell-investigating-web-shell-attacks/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Persistence']"
https://www.elastic.co/guide/en/security/7.16/whitespace-padding-in-process-command-line.html,Whitespace Padding in Process Command Lineedit,['Defense Evasion'],['TA0005'],[],[],Identifies process execution events where the command line value contains a long sequence of whitespace characters or multiple occurrences of contiguous whitespace. Attackers may attempt to evade signature-based detections by padding their malicious command with unnecessary whitespace characters. These observations should be investigated for malicious behavior.,['eql'],"process where event.type in (""start"", ""process_started"") andprocess.command_line regex "".*[ ]{20,}.*"" or /* this will matchon 3 or more separate occurrences of 5+ contiguous whitespacecharacters */ process.command_line regex "".*(.*[ ]{5,}[^ ]*){3,}.*""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://twitter.com/JohnLaTwC/status/1419251082736201737'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/whoami-process-activity.html,Whoami Process Activityedit,['Discovery'],['TA0007'],['System Owner/User Discovery'],['T1033'],"Identifies use of whoami.exe which displays user, group, and privileges information for the user who is currently logged on to the local system.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.name : ""whoami.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/windows-cryptoapi-spoofing-vulnerability-cve-2020-0601-curveball.html,Windows CryptoAPI Spoofing Vulnerability (CVE-2020-0601 - CurveBall)edit,['Defense Evasion'],['TA0005'],['Subvert Trust Controls'],['T1553'],"A spoofing vulnerability exists in the way Windows CryptoAPI (Crypt32.dll) validates Elliptic Curve Cryptography (ECC) certificates. An attacker could exploit the vulnerability by using a spoofed code-signing certificate to sign a malicious executable, making it appear the file was from a trusted, legitimate source.",['query'],"event.provider:""Microsoft-Windows-Audit-CVE"" andmessage:""[CVE-2020-0601]""","['winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/windows-defender-disabled-via-registry-modification.html,Windows Defender Disabled via Registry Modificationedit,['Defense Evasion'],['TA0005'],['Impair Defenses'],['T1562'],Identifies modifications to the Windows Defender registry settings to disable the service or set the service to be started manually.,['eql'],"registry where event.type in (""creation"", ""change"") and((registry.path:""HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsDefender\\DisableAntiSpyware"" and registry.data.strings:""1"") or(registry.path:""HKLM\\System\\ControlSet*\\Services\\WinDefend\\Start""and registry.data.strings in (""3"", ""4"")))","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://thedfirreport.com/2020/12/13/defender-control/'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/windows-defender-exclusions-added-via-powershell.html,Windows Defender Exclusions Added via PowerShelledit,"['Defense Evasion', 'Execution']","['TA0005', 'TA0002']","['Impair Defenses', 'Command and Scripting Interpreter']","['T1562', 'T1059']",Identifies modifications to the Windows Defender configuration settings using PowerShell to add exclusions at the folder directory or process level.,['eql'],"process where event.type == ""start"" and (process.name :(""powershell.exe"", ""pwsh.exe"", ""powershell_ise.exe"") orprocess.pe.original_file_name in (""powershell.exe"", ""pwsh.dll"",""powershell_ise.exe"")) and process.args : (""*Add-MpPreference*-Exclusion*"", ""*Set-MpPreference*-Exclusion*"")","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",['https://www.bitdefender.com/files/News/CaseStudies/study/400/Bitdefender-PR-Whitepaper-MosaicLoader-creat5540-en-EN.pdf'],"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/windows-event-logs-cleared.html,Windows Event Logs Clearededit,['Defense Evasion'],['TA0005'],['Indicator Removal on Host'],['T1070'],Identifies attempts to clear Windows event log stores. This is often done by attackers in an attempt to evade detection or destroy forensic evidence on a system.,['query'],"event.action:(""audit-log-cleared"" or ""Log clear"")","['winlogbeat-*', 'logs-windows.*', 'logs-system.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Defense Evasion']"
https://www.elastic.co/guide/en/security/7.16/windows-network-enumeration.html,Windows Network Enumerationedit,['Discovery'],['TA0007'],['Remote System Discovery'],['T1018'],Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool.,['eql'],"process where event.type in (""start"", ""process_started"") and((process.name : ""net.exe"" or process.pe.original_file_name ==""net.exe"") or ((process.name : ""net1.exe"" orprocess.pe.original_file_name == ""net1.exe"") and notprocess.parent.name : ""net.exe"")) and (process.args : ""view"" or(process.args : ""time"" and process.args : ""\\\\*"")) /* expand whenancestry is available and not descendant of [process whereevent.type == (""start"", ""process_started"") and process.name :""cmd.exe"" and ((process.parent.name :""userinit.exe"") or (process.parent.name :""gpscript.exe"") or (process.parent.name :""explorer.exe"" and process.args :""C:\\*\\Start Menu\\Programs\\Startup\\*.bat*""))] */","['logs-endpoint.events.*', 'winlogbeat-*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Discovery']"
https://www.elastic.co/guide/en/security/7.16/windows-script-executing-powershell.html,Windows Script Executing PowerShelledit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],"Identifies a PowerShell process launched by either cscript.exe or wscript.exe. Observing Windows scripting processes executing a PowerShell script, may be indicative of malicious activity.",['eql'],"process where event.type in (""start"", ""process_started"") andprocess.parent.name : (""cscript.exe"", ""wscript.exe"") and process.name: ""powershell.exe""","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/windows-script-interpreter-executing-process-via-wmi.html,Windows Script Interpreter Executing Process via WMIedit,['Initial Access'],['TA0001'],['Phishing'],['T1566'],Identifies use of the built-in Windows script interpreters (cscript.exe or wscript.exe) being used to execute a process via Windows Management Instrumentation (WMI). This may be indicative of malicious activity.,['eql'],"sequence by host.id with maxspan = 5s [library where dll.name :""wmiutils.dll"" and process.name : (""wscript.exe"", ""cscript.exe"")][process where event.type in (""start"", ""process_started"") andprocess.parent.name : ""wmiprvse.exe"" and user.domain != ""NTAUTHORITY"" and (process.pe.original_file_name : (""cscript.exe"", ""wscript.exe"", ""PowerShell.EXE"",""Cmd.Exe"", ""MSHTA.EXE"", ""RUNDLL32.EXE"",""REGSVR32.EXE"", ""MSBuild.exe"", ""InstallUtil.exe"",""RegAsm.exe"", ""RegSvcs.exe"", ""msxsl.exe"",""CONTROL.EXE"", ""EXPLORER.EXE"",""Microsoft.Workflow.Compiler.exe"", ""msiexec.exe"" )or process.executable : (""C:\\Users\\*.exe"",""C:\\ProgramData\\*.exe"") ) ]","['winlogbeat-*', 'logs-endpoint.events.*', 'logs-windows.*']",N/A,"['Elastic', 'Host', 'Windows', 'Threat Detection', 'Initial Access']"
https://www.elastic.co/guide/en/security/7.16/zoom-meeting-with-no-passcode.html,Zoom Meeting with no Passcodeedit,['Initial Access'],['TA0001'],['Exploit Public-Facing Application'],['T1190'],"This rule identifies Zoom meetings that are created without a passcode. Meetings without a passcode are susceptible to Zoombombing. Zoombombing is carried out by taking advantage of Zoom sessions that are not protected with a passcode. Zoombombing refers to the unwanted, disruptive intrusion, generally by Internet trolls and hackers, into a video conference call. In a typical Zoombombing incident, a teleconferencing session is hijacked by the insertion of material that is lewd, obscene, racist, or antisemitic in nature, typically resulting of the shutdown of the session.",['query'],event.type:creation and event.module:zoom andevent.dataset:zoom.webhook and event.action:meeting.created and notzoom.meeting.password:*,['filebeat-*'],"['https://blog.zoom.us/a-message-to-our-users/', 'https://www.fbi.gov/contact-us/field-offices/boston/news/press-releases/fbi-warns-of-teleconferencing-and-online-classroom-hijacking-during-covid-19-pandemic']","['Elastic', 'Application', 'Communication', 'Zoom', 'Continuous Monitoring', 'SecOps', 'Configuration Audit']"
https://www.elastic.co/guide/en/security/7.16/macos-installer-spawns-network-event.html,macOS Installer Spawns Network Eventedit,"['Execution', 'Command and Control']","['TA0002', 'TA0011']","['Command and Scripting Interpreter', 'Application Layer Protocol']","['T1059', 'T1071']",Identifies when the built in macOS Installer program generates a network event after attempting to install a .pkg file. This activity has been observed being leveraged by malware.,['eql'],"sequence by process.entity_id with maxspan=1m [process whereevent.type == ""start"" and host.os.family == ""macos"" andprocess.parent.executable in (""/usr/sbin/installer"",""/System/Library/CoreServices/Installer.app/Contents/MacOS/Installer"")] [network where not cidrmatch(destination.ip, ""10.0.0.0/8"",""127.0.0.0/8"", ""169.254.0.0/16"", ""172.16.0.0/12"", ""192.0.0.0/24"",""192.0.0.0/29"", ""192.0.0.8/32"", ""192.0.0.9/32"", ""192.0.0.10/32"",""192.0.0.170/32"", ""192.0.0.171/32"", ""192.0.2.0/24"", ""192.31.196.0/24"",""192.52.193.0/24"", ""192.168.0.0/16"", ""192.88.99.0/24"", ""224.0.0.0/4"",""100.64.0.0/10"", ""192.175.48.0/24"", ""198.18.0.0/15"",""198.51.100.0/24"", ""203.0.113.0/24"", ""240.0.0.0/4"", ""::1"",""FE80::/10"", ""FF00::/8"")]",['logs-endpoint.events.*'],"['https://redcanary.com/blog/clipping-silver-sparrows-wings', 'https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml']","['Elastic', 'Host', 'macOS', 'Threat Detection', 'Execution']"
