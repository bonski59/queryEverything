title: Metasploit reverse shell injection in SQL Server
description: Detects scenarios where an attacker inject a payload into SQL Server in order to obtain a remote shell.
references:
- https://www.offensive-security.com/metasploit-unleashed/payloads-mssql/#
tags:
- attack.execution
- attack.t1059.003
author: mdecrevoisier
status: experimental
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    #Version: 2  # applies to ID 4688 where parent process name is available starting Windows 10 / Server 2016 and higher
    ParentProcessName|endswith: '\sqlservr.exe'
    NewProcessName|endswith:
      - \cmd.exe
      - \powershell.exe
      - \pwsh.exe # PowerShell v6
    CommandLine|contains|all:
      - cmd
      - echo
    CommandLine|contains:
      - /c
      - -c
  condition: selection
falsepositives:
- none
level: high